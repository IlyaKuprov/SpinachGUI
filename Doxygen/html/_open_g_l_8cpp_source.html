<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Spinach GUI: Z:/SpinachGUI/GUI/3D Engine/OpenGL.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>Z:/SpinachGUI/GUI/3D Engine/OpenGL.cpp</h1>  </div>
</div>
<div class="contents">
<a href="_open_g_l_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &quot;../StdAfx.h&quot;</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include &lt;windows.h&gt;</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &quot;<a class="code" href="_open_g_l_8h.html">OpenGL.h</a>&quot;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &quot;../MainForm.h&quot;</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">/**</span>
<a name="l00008"></a>00008 <span class="comment">*\file OpenGL.cpp</span>
<a name="l00009"></a>00009 <span class="comment">*/</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="preprocessor">#pragma region Namespaces</span>
<a name="l00012"></a>00012 <span class="preprocessor"></span><span class="keyword">using namespace </span>std;
<a name="l00013"></a>00013 <span class="keyword">using namespace </span>System::IO;
<a name="l00014"></a>00014 <span class="keyword">using namespace </span>System::Windows::Forms;
<a name="l00015"></a>00015 <span class="preprocessor">#pragma endregion</span>
<a name="l00016"></a>00016 <span class="preprocessor"></span>
<a name="l00017"></a>00017 <span class="preprocessor">#pragma region Definitions</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span><span class="comment">//Definitions</span>
<a name="l00019"></a><a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">00019</a> <span class="preprocessor">#define MainICollection  SystemModel-&gt;InteractionCollection</span>
<a name="l00020"></a><a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">00020</a> <span class="preprocessor"></span><span class="preprocessor">#define MainCollection  SystemModel-&gt;AtomCollection</span>
<a name="l00021"></a><a class="code" href="_open_g_l_8cpp.html#af637d148c7b4f533fe2b0ab4705ceb46">00021</a> <span class="preprocessor"></span><span class="preprocessor">#define epsilo std::numeric_limits&lt;double&gt;::epsilon()</span>
<a name="l00022"></a><a class="code" href="_open_g_l_8cpp.html#a3b1858e50e58ec0e37a32e4aa23347e4">00022</a> <span class="preprocessor"></span><span class="preprocessor">#define fun(alpha,factor,check) check?alpha*factor:(alpha-alpha*factor)/(1.0f-alpha*factor)</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span><span class="preprocessor">#pragma endregion</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span>
<a name="l00025"></a>00025 <span class="comment"></span>
<a name="l00026"></a>00026 <span class="comment">///// Initialization, reset and Update/////</span>
<a name="l00027"></a>00027 <span class="comment"></span><span class="preprocessor">#pragma region Initialization, reset and Update</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00029"></a>00029 <span class="comment">/**</span>
<a name="l00030"></a>00030 <span class="comment">* @brief Constructor of COpenGL.</span>
<a name="l00031"></a>00031 <span class="comment">* @param parentForm The parent winodws form that the opengl will bind. </span>
<a name="l00032"></a>00032 <span class="comment">* @param origin The origin point where the OpenGL panel will lie. </span>
<a name="l00033"></a>00033 <span class="comment">* @param iWidth Width of OpenGL panel.</span>
<a name="l00034"></a>00034 <span class="comment">* @param iHeight Heigh of OpenGL panel.</span>
<a name="l00035"></a>00035 <span class="comment">*/</span>
<a name="l00036"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a93f5b3040613ee1251260976c18eab52">00036</a> <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a93f5b3040613ee1251260976c18eab52" title="Constructor of COpenGL.">OpenGLForm::COpenGL::COpenGL</a>(Form ^ parentForm, System::Drawing::Point origin, GLsizei iWidth, GLsizei iHeight)
<a name="l00037"></a>00037 {
<a name="l00038"></a>00038         <span class="comment">//Initialization for function members</span>
<a name="l00039"></a>00039     <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a9cd907838c4fbe6b254818e17e7bf8f8" title="Current system model.">SystemModel</a>=((<a class="code" href="class_spinach_g_u_i_1_1_main_form.html" title="Summary for MainForm.">SpinachGUI::MainForm</a>^)parentForm)-&gt;SystemModel;
<a name="l00040"></a>00040         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a904cf12aa0803e2da3a727cdb68392c4" title="Related to MainForm of Application.">mainForm</a>=((<a class="code" href="class_spinach_g_u_i_1_1_main_form.html" title="Summary for MainForm.">SpinachGUI::MainForm</a>^)parentForm);
<a name="l00041"></a>00041         this-&gt;Location= origin;
<a name="l00042"></a>00042         this-&gt;Height = iHeight;
<a name="l00043"></a>00043         this-&gt;Width = iWidth;
<a name="l00044"></a>00044         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a53bce1efc6e7517c8bbce3538a1066f7">mWidth</a>=iWidth;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc3d9b1f8036a70a3312fabf2337805" title="Width and Height of the OpenGL Window.">mHeight</a>=iHeight;
<a name="l00045"></a>00045 
<a name="l00046"></a>00046         <span class="comment">//ArcBall initialization</span>
<a name="l00047"></a>00047         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#abe65d93638e760b31401f9bbe9505def" title="Margins for the Arcball algorithm.">ArcMargin</a>=<span class="keyword">gcnew</span> <a class="code" href="_arc_ball_8h.html#ae900011610fb7ea371bdf273bef4ebac" title="&amp;quot;Inherited&amp;quot; types">Point2fT</a>();
<a name="l00048"></a>00048         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#abe65d93638e760b31401f9bbe9505def" title="Margins for the Arcball algorithm.">ArcMargin</a>-&gt;X=(GLfloat)(-0.05*<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a53bce1efc6e7517c8bbce3538a1066f7">mWidth</a>);<span class="comment">// For 10% margin-no arcball, 5% each side</span>
<a name="l00049"></a>00049         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#abe65d93638e760b31401f9bbe9505def" title="Margins for the Arcball algorithm.">ArcMargin</a>-&gt;Y=(GLfloat)(-0.05*<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc3d9b1f8036a70a3312fabf2337805" title="Width and Height of the OpenGL Window.">mHeight</a>);
<a name="l00050"></a>00050         <a class="code" href="class_arc_ball.html">ArcBall</a>=<span class="keyword">gcnew</span> <a class="code" href="_arc_ball_8h.html#ae146eae7ae3d2907e2997bb6a6201358">ArcBallT</a>((GLfloat)iWidth+2*<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#abe65d93638e760b31401f9bbe9505def" title="Margins for the Arcball algorithm.">ArcMargin</a>-&gt;X,(GLfloat) iHeight+2*<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#abe65d93638e760b31401f9bbe9505def" title="Margins for the Arcball algorithm.">ArcMargin</a>-&gt;Y);
<a name="l00051"></a>00051 
<a name="l00052"></a>00052         <span class="comment">//Initialization of cubegrid for Metaballs</span>
<a name="l00053"></a>00053         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a54ea8233ca3aa9b851137cce9eba2e87" title="Cube grid for use from metaballs object.">cubeGrid</a>=<span class="keyword">new</span> <a class="code" href="class_c_u_b_e___g_r_i_d.html">CUBE_GRID</a>();
<a name="l00054"></a>00054 
<a name="l00055"></a>00055         <span class="comment">//Initalization od resolution parameters</span>
<a name="l00056"></a>00056         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ab71e341d370590f578bfb2b9156fb21a" title="Flag for using low resolution during rotation.">LowRes</a>=<span class="keyword">false</span>;
<a name="l00057"></a>00057         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a9458a706c34bb3e65cddc4a9c6e3a6f6" title="Flag used for context menu showing.">focused</a>=<span class="keyword">false</span>;
<a name="l00058"></a>00058         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a5878dec3ebcc9f1f745335e62735c4cc" title="Number of quad used for spheres.">Spherediv</a>=15;
<a name="l00059"></a>00059 
<a name="l00060"></a>00060         <span class="comment">//Initialization of FPS counter</span>
<a name="l00061"></a>00061         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a67bc0706cfe86758cb6b0afd9a3b4802" title="Time of last redraw.">last_update</a> = GetTickCount()/1000.0; <span class="comment">// setup time of day with initial value</span>
<a name="l00062"></a>00062         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ab18dfb6dba5051a167a0f84fd8848550" title="Number of times through display loop since redraw.">loop_count</a> = 0;
<a name="l00063"></a>00063 
<a name="l00064"></a>00064         <span class="comment">//Colors construction</span>
<a name="l00065"></a>00065         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a5d9b97f6a464282954c7a4d858abb2b7">CScolor</a>=<span class="keyword">new</span> <span class="keywordtype">double</span>[3];
<a name="l00066"></a>00066         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a17fb59ac4d6ef32a53d0fecf2e7dc6cc">HCcolor</a>=<span class="keyword">new</span> <span class="keywordtype">double</span>[3];
<a name="l00067"></a>00067         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#af51a221898a9ac610830c56110ededfd">GTcolor</a>=<span class="keyword">new</span> <span class="keywordtype">double</span>[3];
<a name="l00068"></a>00068         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a80217ae357b897a5bae6d1821bb68f56">CBcolor</a>=<span class="keyword">new</span> <span class="keywordtype">double</span>[3];
<a name="l00069"></a>00069         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a068b18861200cc701d3ad19e0424ee59" title="RGB Matrices for the color of interaction kind.">JCcolor</a>=<span class="keyword">new</span> <span class="keywordtype">double</span>[6];
<a name="l00070"></a>00070         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ae225fe838d6e93271a0f14604d0f74c5">ECcolor</a>=<span class="keyword">new</span> <span class="keywordtype">double</span>[6];
<a name="l00071"></a>00071         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a2dbe60a3b6d57cbfa1b939b45a41870a">QCcolor</a>=<span class="keyword">new</span> <span class="keywordtype">double</span>[3];
<a name="l00072"></a>00072         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a00dd073770344c298e61f4bc233346f0" title="RGB Matrices for the color of interaction kind.">ZFcolor</a>=<span class="keyword">new</span> <span class="keywordtype">double</span>[3];
<a name="l00073"></a>00073         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a59338162d14cc3c1179d6c90290ce450" title="RGB Matrix for the color.">BackgroundColor</a>= <span class="keyword">new</span> <span class="keywordtype">double</span>[3];
<a name="l00074"></a>00074 
<a name="l00075"></a>00075         <span class="comment">//Matrix for Rotations</span>
<a name="l00076"></a>00076         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>=<span class="keyword">gcnew</span> <a class="code" href="_arc_ball_8h.html#af874e5d888243751a46f28028f87167f" title="A Single precision floating point 4 by 4 matrix.">Matrix4fT</a>();
<a name="l00077"></a>00077         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a07e1ebf14aaebe563443d2923e6b4d61">LastRot</a>=<span class="keyword">gcnew</span> <a class="code" href="_arc_ball_8h.html#af72d393e65ee87690bb81d055661f3b7" title="A Single precision floating point 3 by 3 matrix.">Matrix3fT</a>();
<a name="l00078"></a>00078     <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>=<span class="keyword">gcnew</span> <a class="code" href="_arc_ball_8h.html#af72d393e65ee87690bb81d055661f3b7" title="A Single precision floating point 3 by 3 matrix.">Matrix3fT</a>();
<a name="l00079"></a>00079         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6047be0a1d94c1951881b54d4934774c" title="Current Mouse pointer coordinates.">MousePt</a>=<span class="keyword">gcnew</span> <a class="code" href="_arc_ball_8h.html#ae900011610fb7ea371bdf273bef4ebac" title="&amp;quot;Inherited&amp;quot; types">Point2fT</a>();
<a name="l00080"></a>00080         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a700170133b4fb855f3e86cd187d0d6a6" title="Current matrix for transformation used for migration to OpenGL format.">TransformMat</a>=<span class="keyword">new</span> GLfloat[16];
<a name="l00081"></a>00081         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a618b7a88f81f17620fa6f35658713830" title="Matrix for saving current frame in travelling.">SaveMat</a>=<span class="keyword">new</span> GLfloat[16];
<a name="l00082"></a>00082 
<a name="l00083"></a>00083         <span class="comment">//Set defaults          </span>
<a name="l00084"></a>00084         this-&gt;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ae2c69eda86a678c4636a1ab4e89f3c91">Reset</a>();
<a name="l00085"></a>00085         this-&gt;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a30ba78422f28b4ce56e5408c8e3f78a6">Home</a>();
<a name="l00086"></a>00086 
<a name="l00087"></a>00087         <span class="comment">//Initialization of cubegrid for Metaballs</span>
<a name="l00088"></a>00088         this-&gt;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a780db12637b2756c1d9de939998cadff">Init_Metaballs</a>();
<a name="l00089"></a>00089 
<a name="l00090"></a>00090         <span class="comment">//Setup the Event handlers</span>
<a name="l00091"></a>00091         this-&gt;MouseEnter += <span class="keyword">gcnew</span> System::EventHandler(<span class="keyword">this</span>,&amp;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aea8f06c9be3254700bbff00c9155039e" title="Used for focus of the OpenGL panel when context menu closes.">OpenGLForm::COpenGL::OnMouseEnter</a>);
<a name="l00092"></a>00092         this-&gt;MouseLeave += <span class="keyword">gcnew</span> System::EventHandler(<span class="keyword">this</span>,&amp;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a03617be335007b1b445475d0b5316e2d" title="Used for unfocus of the OpenGL panel when context menu opens.">OpenGLForm::COpenGL::OnMouseLeave</a>);
<a name="l00093"></a>00093         this-&gt;MouseMove += <span class="keyword">gcnew</span> System::Windows::Forms::MouseEventHandler(<span class="keyword">this</span>,&amp;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#abbc977e84098903b10a5e5884dacb257" title="When the mouse move inside the OpenGL panel.">OpenGLForm::COpenGL::OnMouseMove</a>);
<a name="l00094"></a>00094         this-&gt;MouseDown += <span class="keyword">gcnew</span> System::Windows::Forms::MouseEventHandler(<span class="keyword">this</span>,&amp;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a84908477a9382e961bbe2e8434a51e4c" title="When a mouse button is down but not yet up.">OpenGLForm::COpenGL::OnMouseDown</a>);
<a name="l00095"></a>00095         this-&gt;MouseUp += <span class="keyword">gcnew</span> System::Windows::Forms::MouseEventHandler(<span class="keyword">this</span>,&amp;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a1659288e97079ed5c8bca7ed6092764e" title="When a mouse button is up after down.">OpenGLForm::COpenGL::OnMouseUp</a>);
<a name="l00096"></a>00096         this-&gt;MouseWheel += <span class="keyword">gcnew</span> System::Windows::Forms::MouseEventHandler(<span class="keyword">this</span>,&amp;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aa4e3269ebac6026328e8ae6d7a78a187" title="For handling the wheel rotation of the mouse and used for zooming of the model.">OpenGLForm::COpenGL::OnMouseWheel</a>);
<a name="l00097"></a>00097         this-&gt;KeyDown+=<span class="keyword">gcnew</span> System::Windows::Forms::KeyEventHandler(<span class="keyword">this</span>,&amp;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6f16d5a949cf392f9beb3992b91c4ff0" title="Delete the selected atom in OpneGL panel.">OpenGLForm::COpenGL::Del_KeyDown</a>);
<a name="l00098"></a>00098 
<a name="l00099"></a>00099         <span class="comment">// Create as a child of the specified parent and make OpenGL compliant (no clipping)</span>
<a name="l00100"></a>00100         this-&gt;CreateParams-&gt;Style = WS_CHILD | WS_VISIBLE | WS_CLIPSIBLINGS | WS_CLIPCHILDREN | WS_DISABLED;
<a name="l00101"></a>00101 
<a name="l00102"></a>00102         <span class="comment">// Create the actual window</span>
<a name="l00103"></a>00103         this-&gt;Parent = parentForm;      
<a name="l00104"></a>00104         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a12341750588558dacd3daf1b8408a6ef" title="For OpenGL window panel.">m_hDC</a> = GetDC((HWND)this-&gt;Handle.ToPointer());
<a name="l00105"></a>00105 
<a name="l00106"></a>00106         <span class="keywordflow">if</span>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a12341750588558dacd3daf1b8408a6ef" title="For OpenGL window panel.">m_hDC</a>)
<a name="l00107"></a>00107                 {      
<a name="l00108"></a>00108                 wglMakeCurrent(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a12341750588558dacd3daf1b8408a6ef" title="For OpenGL window panel.">m_hDC</a>, NULL);
<a name="l00109"></a>00109                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#af67305a63bf493e87a223cffe49f8c91" title="Setting Pixel Format for OpenGL.">MySetPixelFormat</a>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a12341750588558dacd3daf1b8408a6ef" title="For OpenGL window panel.">m_hDC</a>);
<a name="l00110"></a>00110                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a965de1dd6551873a8812cf19accbd94a" title="Setting Forn Format for OpenGL.">MySetFontFormat</a>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a12341750588558dacd3daf1b8408a6ef" title="For OpenGL window panel.">m_hDC</a>);
<a name="l00111"></a>00111                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a3ac1de9424a99c228fb52551396b9116" title="Resize the OpenGL panel.">ReSizeGLScene</a>(iWidth, iHeight);
<a name="l00112"></a>00112                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aca74db3d732ca1158b1c2f104813770c" title="Initialization of parameters of OpenGL.">InitGL</a>();
<a name="l00113"></a>00113                 }
<a name="l00114"></a>00114 
<a name="l00115"></a>00115                 
<a name="l00116"></a>00116 }
<a name="l00117"></a>00117 <span class="comment"></span>
<a name="l00118"></a>00118 <span class="comment">/**</span>
<a name="l00119"></a>00119 <span class="comment">* @brief Build of Display list for fast Rendering.</span>
<a name="l00120"></a>00120 <span class="comment">*/</span>
<a name="l00121"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a1c646517d2e8bdcff223af6f3427a1bd">00121</a> System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a1c646517d2e8bdcff223af6f3427a1bd" title="Build of Display list for fast Rendering.">OpenGLForm::COpenGL:: BuildDisplayLists</a>(System::Void)
<a name="l00122"></a>00122 {
<a name="l00123"></a>00123         <span class="comment">//----sphere list</span>
<a name="l00124"></a>00124   <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aba422d8f28cd045e5dbd268b33f1d8fa" title="Non Default sphere for Call list.">MySphere</a> =glGenLists(15);
<a name="l00125"></a>00125   glNewList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aba422d8f28cd045e5dbd268b33f1d8fa" title="Non Default sphere for Call list.">MySphere</a>,GL_COMPILE);
<a name="l00126"></a>00126   <span class="comment">// counters for drawing the vertices in 3D space</span>
<a name="l00127"></a>00127   <span class="comment">// calculate PI using the asin trig function</span>
<a name="l00128"></a>00128   <span class="keywordtype">int</span> m = 15, p = 15;
<a name="l00129"></a>00129   <span class="keywordtype">float</span> pi = asin(1.0)*2;
<a name="l00130"></a>00130   <span class="keywordtype">float</span> rad = 1.0;
<a name="l00131"></a>00131   glBegin(GL_QUADS);
<a name="l00132"></a>00132   <span class="comment">// for each of the latitude lines</span>
<a name="l00133"></a>00133   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> a = 0; a != m; a++) {
<a name="l00134"></a>00134         <span class="comment">// for each of the longitude intersections with a latitude line</span>
<a name="l00135"></a>00135     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c = 0; c != p; c++) {
<a name="l00136"></a>00136 
<a name="l00137"></a>00137       <span class="comment">/* for every set of 4 vertices, first calculate the texture coords for materials</span>
<a name="l00138"></a>00138 <span class="comment">                 then calculate the normals so that lighting is applied correctly to the shape</span>
<a name="l00139"></a>00139 <span class="comment">                 and lastly calculate where to put each vertex based on the radius of the sphere</span>
<a name="l00140"></a>00140 <span class="comment">                 the vertices are calculated clockwise as each corner of the quad */</span>
<a name="l00141"></a>00141           <span class="comment">// 1st vertex of the quad</span>
<a name="l00142"></a>00142           glTexCoord2f(-a*1.0f/m, -c/(p+1.0f));
<a name="l00143"></a>00143           glNormal3f(cos(2*pi/m*a)*cos(pi/p*c-pi/2), sin(2*pi/m*a)*cos(pi/p*c-pi/2),
<a name="l00144"></a>00144                                  sin(pi/p*c-pi/2));
<a name="l00145"></a>00145           glVertex3f(cos(2*pi/m*a)*cos(pi/p*c-pi/2)*rad,
<a name="l00146"></a>00146                                  sin(2*pi/m*a)*cos(pi/p*c-pi/2)*rad,sin(pi/p*c-pi/2)*rad);
<a name="l00147"></a>00147           <span class="comment">// 2nd vertex of the quad</span>
<a name="l00148"></a>00148           glTexCoord2f(-(a+1.0f)/m, -c/(p+1.0f));
<a name="l00149"></a>00149           glNormal3f(cos(2*pi/m*(a+1))*cos(pi/p*c-pi/2), sin(2*pi/m*(a+1))*cos(pi/p*c-pi/2),
<a name="l00150"></a>00150                                  sin(pi/p*c-pi/2));
<a name="l00151"></a>00151           glVertex3f(cos(2*pi/m*(a+1))*cos(pi/p*c-pi/2)*rad, sin(2*pi/m*(a+1))*cos(pi/p*c-pi/2)*rad,
<a name="l00152"></a>00152                                  sin(pi/p*c-pi/2)*rad);
<a name="l00153"></a>00153           <span class="comment">// 3rd vertex of the quad</span>
<a name="l00154"></a>00154           glTexCoord2f(-a*1.0f/m, -(c+1.0f)/(p+1.0f));
<a name="l00155"></a>00155           glNormal3f(cos(2*pi/m*(a+1))*cos(pi/p*(c+1)-pi/2), sin(2*pi/m*(a+1))*cos(pi/p*(c+1)-pi/2),
<a name="l00156"></a>00156                                  sin(pi/p*(c+1)-pi/2));
<a name="l00157"></a>00157 
<a name="l00158"></a>00158           glVertex3f(cos(2*pi/m*(a+1))*cos(pi/p*(c+1)-pi/2)*rad, sin(2*pi/m*(a+1))*cos(pi/p*(c+1)-pi/2)*rad,
<a name="l00159"></a>00159                                  sin(pi/p*(c+1)-pi/2)*rad);
<a name="l00160"></a>00160           <span class="comment">// 4th and last vertex of the quad</span>
<a name="l00161"></a>00161           glTexCoord2f(-(a+1.0f)/m, -(c+1.0f)/(p+1.0f));
<a name="l00162"></a>00162           glNormal3f(cos(2*pi/m*a)*cos(pi/p*(c+1)-pi/2), sin(2*pi/m*a)*cos(pi/p*(c+1)-pi/2),
<a name="l00163"></a>00163                                  sin(pi/p*(c+1)-pi/2));
<a name="l00164"></a>00164           glVertex3f(cos(2*pi/m*a)*cos(pi/p*(c+1)-pi/2)*rad, sin(2*pi/m*a)*cos(pi/p*(c+1)-pi/2)*rad,
<a name="l00165"></a>00165                                  sin(pi/p*(c+1)-pi/2)*rad);
<a name="l00166"></a>00166         }<span class="comment">//c</span>
<a name="l00167"></a>00167   }<span class="comment">//a</span>
<a name="l00168"></a>00168   <span class="comment">// end the openGL definition of the shape</span>
<a name="l00169"></a>00169   glEnd();
<a name="l00170"></a>00170   glEndList();
<a name="l00171"></a>00171 
<a name="l00172"></a>00172  
<a name="l00173"></a>00173 
<a name="l00174"></a>00174   <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a368cb340baf71ed4692e561f0a692b18" title="Sphere with high Resolution for Call list.">SphereHighRes</a>=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aba422d8f28cd045e5dbd268b33f1d8fa" title="Non Default sphere for Call list.">MySphere</a>+2;
<a name="l00175"></a>00175   glNewList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a368cb340baf71ed4692e561f0a692b18" title="Sphere with high Resolution for Call list.">SphereHighRes</a>,GL_COMPILE);
<a name="l00176"></a>00176   gluQuadricDrawStyle(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>, GLU_FILL);
<a name="l00177"></a>00177   gluQuadricNormals(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>, GLU_SMOOTH );
<a name="l00178"></a>00178   gluSphere(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,1.0,15,15);
<a name="l00179"></a>00179   glEndList();
<a name="l00180"></a>00180 
<a name="l00181"></a>00181   <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a8c8b656575b35919a95692d6f22d2382" title="Sphere with low Resolution for Call list.">SphereLowRes</a>=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aba422d8f28cd045e5dbd268b33f1d8fa" title="Non Default sphere for Call list.">MySphere</a>+3;
<a name="l00182"></a>00182   gluQuadricDrawStyle(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>, GLU_FILL);
<a name="l00183"></a>00183   gluQuadricNormals(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>, GLU_SMOOTH );
<a name="l00184"></a>00184   glNewList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a8c8b656575b35919a95692d6f22d2382" title="Sphere with low Resolution for Call list.">SphereLowRes</a>,GL_COMPILE);
<a name="l00185"></a>00185   gluSphere(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,1.0,12,12);
<a name="l00186"></a>00186   glEndList();
<a name="l00187"></a>00187 
<a name="l00188"></a>00188   <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7deebfbc439113126d7980a6a5231560" title="Selected Sphere with high Resolution for Call list.">SelectedSphereHighRes</a>=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aba422d8f28cd045e5dbd268b33f1d8fa" title="Non Default sphere for Call list.">MySphere</a>+4;
<a name="l00189"></a>00189   glNewList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7deebfbc439113126d7980a6a5231560" title="Selected Sphere with high Resolution for Call list.">SelectedSphereHighRes</a>,GL_COMPILE);
<a name="l00190"></a>00190   gluQuadricDrawStyle(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>, GLU_FILL);
<a name="l00191"></a>00191   gluQuadricNormals(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>, GLU_SMOOTH );
<a name="l00192"></a>00192   gluSphere(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,1.0,25,25);
<a name="l00193"></a>00193   glEndList();
<a name="l00194"></a>00194 
<a name="l00195"></a>00195   <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a30122f7a0e8a1087a6104fd2c1ef114f" title="Selected Sphere with low Resolution for Call list.">SelectedSphereLowRes</a>=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aba422d8f28cd045e5dbd268b33f1d8fa" title="Non Default sphere for Call list.">MySphere</a>+5;
<a name="l00196"></a>00196   glNewList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a30122f7a0e8a1087a6104fd2c1ef114f" title="Selected Sphere with low Resolution for Call list.">SelectedSphereLowRes</a>,GL_COMPILE);
<a name="l00197"></a>00197   gluQuadricDrawStyle(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>, GLU_FILL);
<a name="l00198"></a>00198   gluQuadricNormals(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>, GLU_SMOOTH );
<a name="l00199"></a>00199   gluSphere(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,1.0,22,22);
<a name="l00200"></a>00200   glEndList();
<a name="l00201"></a>00201 
<a name="l00202"></a>00202   <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aa62170c7e877d0c6a05637b70f2c89f6" title="Wired Sphere with high Resolution for Call list.">WiredSphereLowRes</a>=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aba422d8f28cd045e5dbd268b33f1d8fa" title="Non Default sphere for Call list.">MySphere</a>+6;
<a name="l00203"></a>00203   glNewList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aa62170c7e877d0c6a05637b70f2c89f6" title="Wired Sphere with high Resolution for Call list.">WiredSphereLowRes</a>,GL_COMPILE);
<a name="l00204"></a>00204   gluQuadricDrawStyle(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>, GLU_LINE);
<a name="l00205"></a>00205   gluQuadricNormals(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>, GLU_SMOOTH );
<a name="l00206"></a>00206   gluSphere(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,1.0,22,22);
<a name="l00207"></a>00207   glEndList();
<a name="l00208"></a>00208 
<a name="l00209"></a>00209   <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a34348d047f8c3f1be810d93183983481" title="Wired Sphere with low Resolution for Call list.">WiredSphereHighRes</a>=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aba422d8f28cd045e5dbd268b33f1d8fa" title="Non Default sphere for Call list.">MySphere</a>+7;
<a name="l00210"></a>00210   glNewList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a34348d047f8c3f1be810d93183983481" title="Wired Sphere with low Resolution for Call list.">WiredSphereHighRes</a>,GL_COMPILE);
<a name="l00211"></a>00211   gluQuadricDrawStyle(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>, GLU_LINE);
<a name="l00212"></a>00212   gluQuadricNormals(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>, GLU_SMOOTH );
<a name="l00213"></a>00213   gluSphere(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,1.0,25,25);
<a name="l00214"></a>00214   glEndList();
<a name="l00215"></a>00215     
<a name="l00216"></a>00216   <span class="keywordtype">float</span> cylindersize=0.03f;
<a name="l00217"></a>00217   <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aeb7fd954835139436d3d236eb1faae3f" title="Cylinder with high Resolution for Call list.">CylinderHighRes</a>=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aba422d8f28cd045e5dbd268b33f1d8fa" title="Non Default sphere for Call list.">MySphere</a>+8;
<a name="l00218"></a>00218   glNewList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aeb7fd954835139436d3d236eb1faae3f" title="Cylinder with high Resolution for Call list.">CylinderHighRes</a>,GL_COMPILE);
<a name="l00219"></a>00219   gluQuadricDrawStyle(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>, GLU_FILL);
<a name="l00220"></a>00220   gluQuadricNormals(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>, GLU_SMOOTH );
<a name="l00221"></a>00221   gluCylinder(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,cylindersize,cylindersize,1.0,15,15);
<a name="l00222"></a>00222   glEnd();
<a name="l00223"></a>00223   glEndList();
<a name="l00224"></a>00224 
<a name="l00225"></a>00225   <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a58b1f3c4ddcabb1ecad737d1b0ec8ee4" title="Cylinder with low Resolution for Call list.">CylinderLowRes</a>=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aba422d8f28cd045e5dbd268b33f1d8fa" title="Non Default sphere for Call list.">MySphere</a>+9;
<a name="l00226"></a>00226   glNewList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a58b1f3c4ddcabb1ecad737d1b0ec8ee4" title="Cylinder with low Resolution for Call list.">CylinderLowRes</a>,GL_COMPILE);
<a name="l00227"></a>00227   gluQuadricDrawStyle(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>, GLU_FILL);
<a name="l00228"></a>00228   gluQuadricNormals(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>, GLU_SMOOTH );
<a name="l00229"></a>00229   gluCylinder(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,cylindersize,cylindersize,1.0,12,12);
<a name="l00230"></a>00230   glEndList();
<a name="l00231"></a>00231 
<a name="l00232"></a>00232   cylindersize+=0.005f;
<a name="l00233"></a>00233   <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aab3df0cf966ad05fc94eb69385c9daa0" title="Cylinder with bases with high Resolution for Call list.">FullCylinderHighRes</a>=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aba422d8f28cd045e5dbd268b33f1d8fa" title="Non Default sphere for Call list.">MySphere</a>+10;
<a name="l00234"></a>00234   glNewList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aab3df0cf966ad05fc94eb69385c9daa0" title="Cylinder with bases with high Resolution for Call list.">FullCylinderHighRes</a>,GL_COMPILE);
<a name="l00235"></a>00235   gluQuadricDrawStyle(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>, GLU_FILL);
<a name="l00236"></a>00236   gluQuadricNormals(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>, GLU_SMOOTH );
<a name="l00237"></a>00237   gluCylinder(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,cylindersize,cylindersize,0.15,15,15);
<a name="l00238"></a>00238   glRotatef(180, 1,0,0);
<a name="l00239"></a>00239   gluDisk(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,0.0,cylindersize,15,15);
<a name="l00240"></a>00240   glRotatef(180, 1,0,0); 
<a name="l00241"></a>00241   glTranslatef(0.0f, 0.0f, 0.15f); 
<a name="l00242"></a>00242   gluDisk(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,0.0,cylindersize,15,15);
<a name="l00243"></a>00243   glEndList();
<a name="l00244"></a>00244 
<a name="l00245"></a>00245   <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a35476e4bb57870e9301c2ed1e37e8fd5" title="Cylinder with bases with low Resolution for Call list.">FullCylinderLowRes</a>=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aba422d8f28cd045e5dbd268b33f1d8fa" title="Non Default sphere for Call list.">MySphere</a>+11;
<a name="l00246"></a>00246   glNewList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a35476e4bb57870e9301c2ed1e37e8fd5" title="Cylinder with bases with low Resolution for Call list.">FullCylinderLowRes</a>,GL_COMPILE);
<a name="l00247"></a>00247   gluQuadricDrawStyle(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>, GLU_FILL);
<a name="l00248"></a>00248   gluQuadricNormals(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>, GLU_SMOOTH );
<a name="l00249"></a>00249   gluCylinder(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,cylindersize,cylindersize,0.15,12,12);
<a name="l00250"></a>00250   glRotatef(180, 1,0,0);
<a name="l00251"></a>00251   gluDisk(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,0.0,cylindersize,12,12);
<a name="l00252"></a>00252   glRotatef(180, 1,0,0); 
<a name="l00253"></a>00253   glTranslatef(0.0f, 0.0f, 0.15f); 
<a name="l00254"></a>00254   gluDisk(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,0.0,cylindersize,12,12);
<a name="l00255"></a>00255   glEndList();
<a name="l00256"></a>00256 
<a name="l00257"></a>00257 
<a name="l00258"></a>00258   <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ae374f7085c1e2595ce154bfdc1b9a916" title="Rendering navigation axes for Call list.">Navigation</a>=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aba422d8f28cd045e5dbd268b33f1d8fa" title="Non Default sphere for Call list.">MySphere</a>+12;
<a name="l00259"></a>00259   glNewList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ae374f7085c1e2595ce154bfdc1b9a916" title="Rendering navigation axes for Call list.">Navigation</a>,GL_COMPILE);
<a name="l00260"></a>00260   <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ab5bbb674e0e4ea78f14ae0868a245e4d" title="Render of navigation axes in the edge fo the window.">Render_Navigation</a>();
<a name="l00261"></a>00261   glEndList();
<a name="l00262"></a>00262 
<a name="l00263"></a>00263 }
<a name="l00264"></a>00264 <span class="comment"></span>
<a name="l00265"></a>00265 <span class="comment">/**</span>
<a name="l00266"></a>00266 <span class="comment">* @brief  Destructor of COpenGL.</span>
<a name="l00267"></a>00267 <span class="comment">*/</span>
<a name="l00268"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#af2eb3f4e9bb5a8275d5d7ca9194d78bf">00268</a> <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#af2eb3f4e9bb5a8275d5d7ca9194d78bf" title="Destructor of COpenGL.">OpenGLForm::COpenGL::~COpenGL</a>(System::Void)
<a name="l00269"></a>00269 {
<a name="l00270"></a>00270         this-&gt;DestroyHandle();
<a name="l00271"></a>00271         gluDeleteQuadric(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>);
<a name="l00272"></a>00272 }
<a name="l00273"></a>00273 <span class="comment"></span>
<a name="l00274"></a>00274 <span class="comment">/**</span>
<a name="l00275"></a>00275 <span class="comment">* @brief Resetting viewing parameters, colors, flags.</span>
<a name="l00276"></a>00276 <span class="comment">*/</span>
<a name="l00277"></a>00277 System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ae2c69eda86a678c4636a1ab4e89f3c91">OpenGLForm::COpenGL::Reset</a>()
<a name="l00278"></a>00278 {       
<a name="l00279"></a>00279         <span class="comment">//Default Background, view and select</span>
<a name="l00280"></a>00280         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a59338162d14cc3c1179d6c90290ce450" title="RGB Matrix for the color.">BackgroundColor</a>[0]=1.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a59338162d14cc3c1179d6c90290ce450" title="RGB Matrix for the color.">BackgroundColor</a>[1]=1.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a59338162d14cc3c1179d6c90290ce450" title="RGB Matrix for the color.">BackgroundColor</a>[2]=1.0f;
<a name="l00281"></a>00281         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a735447373bdfe5ed0fda746aaeaa5f72" title="Flag for showing navigation axes.">AxesFlag</a>=<span class="keyword">true</span>;
<a name="l00282"></a>00282         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aea9bc7ab4d1f1cb9f91b2fa4fd9d7d28" title="Flag for showing ID of all atoms.">AtomIDFlag</a>=<span class="keyword">false</span>;
<a name="l00283"></a>00283         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a0f0330d51c3dd60a65da76dc533d177e" title="Flag for selecting atoms.">SelectFlag</a>=<span class="keyword">true</span>;
<a name="l00284"></a>00284         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#af7ffeb4b7690dfecb95daab57165b9c0" title="Flag for showing interaction axes.">EigenAxesFlag</a>=<span class="keyword">true</span>;
<a name="l00285"></a>00285         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ac4a2747b4541ead35bf992447bedeec9" title="Flag for showing interaction ellipsoids.">EigenEllipsoidsFlag</a>=<span class="keyword">true</span>;
<a name="l00286"></a>00286         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a0f9cb0f634625db9ac37118d7314a044" title="Flag for showing the interaction of the selected atom.">SelectedAtomsInteractionsFlag</a>=<span class="keyword">true</span>;
<a name="l00287"></a>00287         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ab7c488998482ef56d60f94fbddbd0879" title="Flag for stero viewing.">stereoview</a>=<span class="keyword">false</span>;
<a name="l00288"></a>00288         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a44b9634d3a01e26c244d965f1eb9a0f1" title="Flag for showing current reference frame axis of interaction.">ReferenceFrameAxesFlag</a>=<span class="keyword">false</span>;
<a name="l00289"></a>00289 
<a name="l00290"></a>00290         <span class="comment">//Default trackbars flags and values</span>
<a name="l00291"></a>00291         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#afa59a811285e41674e9f16ea7b6f77ba">CSFlag</a>=<span class="keyword">true</span>;
<a name="l00292"></a>00292         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a228adfdf34ef201300550f0f5467e446">HCFlag</a>=<span class="keyword">true</span>;
<a name="l00293"></a>00293         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a13624261209264386df1cde404b1ed6e">GTFlag</a>=<span class="keyword">true</span>;
<a name="l00294"></a>00294         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7fd00e0dce38f247c53b463fb332a364" title="Flags for showing kind of interactions.">CBFlag</a>=<span class="keyword">true</span>;
<a name="l00295"></a>00295         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a38fcd62b067631ddbf9a246de902a60d">JCFlag</a>=<span class="keyword">true</span>;
<a name="l00296"></a>00296         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a69af08bcff645c3c07ea407f00094553">DCFlag</a>=<span class="keyword">true</span>;
<a name="l00297"></a>00297         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aa548f39ed75164d87e04034e809ec70e">QCFlag</a>=<span class="keyword">true</span>;
<a name="l00298"></a>00298         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aa88a55e4dc4b4150121add8c84bda00d">ECFlag</a>=<span class="keyword">true</span>;
<a name="l00299"></a>00299         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a5d940879e95fc2974a27fb24d55bce89" title="Flags for showing kind of interactions.">ZFFlag</a>=<span class="keyword">true</span>;
<a name="l00300"></a>00300         <span class="comment">//</span>
<a name="l00301"></a>00301         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a655fb8e18d522e43daec2256cfee5937">CSfactor</a>=1.0;
<a name="l00302"></a>00302         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#afe34ce939edd9ed01b8df562629ab40b">HCfactor</a>=1.0;
<a name="l00303"></a>00303         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a022a3a713d0801b7427cabca634a3ec3">GTfactor</a>=1.0;
<a name="l00304"></a>00304         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a8235a35f4031b6695623c3cfe403f73e" title="Multiplication factor for the size of ellipsoids.">CBfactor</a>=0.5f;
<a name="l00305"></a>00305         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ae47a6e56f51e049425e77348cf087b5a" title="Final multiplication factor for the size of ellipsoids.">CBfinfactor</a>=1.6f;
<a name="l00306"></a>00306         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a1782f41a5c8ffb35aa6704dfb68d9f21">JCfactor</a>=0.5;
<a name="l00307"></a>00307         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#af054791eff9432418c16d48cd8453023">QCfactor</a>=1.0;
<a name="l00308"></a>00308         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a9c0396e7c649b1fc08390be9d045c20f">ECfactor</a>=0.5;
<a name="l00309"></a>00309         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a1e7566b011cd74b57ad1f52d4dc0b09e" title="Multiplication factor for the size of ellipsoids.">ZFfactor</a>=1.0;
<a name="l00310"></a>00310 
<a name="l00311"></a>00311         <span class="comment">//MinX=MinY=MinZ=100000;</span>
<a name="l00312"></a>00312         <span class="comment">//MaxX=MaxY=MaxZ=-100000;</span>
<a name="l00313"></a>00313 
<a name="l00314"></a>00314         <span class="comment">//Default Minima and maxima trackbar</span>
<a name="l00315"></a>00315 <span class="comment">//      MinCS=MinAC=MinGT=MinCB=MinJC=MinDC=MinQC=MinEC=MinZF=100000;</span>
<a name="l00316"></a>00316 <span class="comment">//      MaxCS=MaxAC=MaxGT=MaxCB=MaxJC=MaxDC=MaxQC=MaxEC=MaxZF=-100000;</span>
<a name="l00317"></a>00317 
<a name="l00318"></a>00318         <span class="comment">//Default colors</span>
<a name="l00319"></a>00319         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a5d9b97f6a464282954c7a4d858abb2b7">CScolor</a>[0]=0.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a5d9b97f6a464282954c7a4d858abb2b7">CScolor</a>[1]=0.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a5d9b97f6a464282954c7a4d858abb2b7">CScolor</a>[2]=0.9f;  <span class="comment">//Blue</span>
<a name="l00320"></a>00320         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a17fb59ac4d6ef32a53d0fecf2e7dc6cc">HCcolor</a>[0]=1.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a17fb59ac4d6ef32a53d0fecf2e7dc6cc">HCcolor</a>[1]=0.5f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a17fb59ac4d6ef32a53d0fecf2e7dc6cc">HCcolor</a>[2]=0.25f; <span class="comment">//Oramge</span>
<a name="l00321"></a>00321         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#af51a221898a9ac610830c56110ededfd">GTcolor</a>[0]=1.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#af51a221898a9ac610830c56110ededfd">GTcolor</a>[1]=0.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#af51a221898a9ac610830c56110ededfd">GTcolor</a>[2]=0.0f;  <span class="comment">//Red</span>
<a name="l00322"></a>00322         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a80217ae357b897a5bae6d1821bb68f56">CBcolor</a>[0]=0.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a80217ae357b897a5bae6d1821bb68f56">CBcolor</a>[1]=0.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a80217ae357b897a5bae6d1821bb68f56">CBcolor</a>[2]=0.0f;  <span class="comment">//Black</span>
<a name="l00323"></a>00323         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a2dbe60a3b6d57cbfa1b939b45a41870a">QCcolor</a>[0]=0.25f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a2dbe60a3b6d57cbfa1b939b45a41870a">QCcolor</a>[1]=0.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a2dbe60a3b6d57cbfa1b939b45a41870a">QCcolor</a>[2]=0.25f;<span class="comment">//Purple </span>
<a name="l00324"></a>00324         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a00dd073770344c298e61f4bc233346f0" title="RGB Matrices for the color of interaction kind.">ZFcolor</a>[0]=0.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a00dd073770344c298e61f4bc233346f0" title="RGB Matrices for the color of interaction kind.">ZFcolor</a>[1]=0.5f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a00dd073770344c298e61f4bc233346f0" title="RGB Matrices for the color of interaction kind.">ZFcolor</a>[2]=0.25f; <span class="comment">//Green</span>
<a name="l00325"></a>00325 
<a name="l00326"></a>00326         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ae225fe838d6e93271a0f14604d0f74c5">ECcolor</a>[0]=1.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ae225fe838d6e93271a0f14604d0f74c5">ECcolor</a>[1]=0.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ae225fe838d6e93271a0f14604d0f74c5">ECcolor</a>[2]=0.0f; <span class="comment">//Red to--</span>
<a name="l00327"></a>00327         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ae225fe838d6e93271a0f14604d0f74c5">ECcolor</a>[3]=0.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ae225fe838d6e93271a0f14604d0f74c5">ECcolor</a>[4]=0.5f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ae225fe838d6e93271a0f14604d0f74c5">ECcolor</a>[5]=0.25f;<span class="comment">//Green</span>
<a name="l00328"></a>00328         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a068b18861200cc701d3ad19e0424ee59" title="RGB Matrices for the color of interaction kind.">JCcolor</a>[0]=0.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a068b18861200cc701d3ad19e0424ee59" title="RGB Matrices for the color of interaction kind.">JCcolor</a>[1]=0.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a068b18861200cc701d3ad19e0424ee59" title="RGB Matrices for the color of interaction kind.">JCcolor</a>[2]=0.9f; <span class="comment">//Blue to--</span>
<a name="l00329"></a>00329         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a068b18861200cc701d3ad19e0424ee59" title="RGB Matrices for the color of interaction kind.">JCcolor</a>[3]=1.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a068b18861200cc701d3ad19e0424ee59" title="RGB Matrices for the color of interaction kind.">JCcolor</a>[4]=0.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a068b18861200cc701d3ad19e0424ee59" title="RGB Matrices for the color of interaction kind.">JCcolor</a>[5]=0.0f; <span class="comment">//Red</span>
<a name="l00330"></a>00330 
<a name="l00331"></a>00331 
<a name="l00332"></a>00332 }
<a name="l00333"></a>00333 <span class="comment"></span>
<a name="l00334"></a>00334 <span class="comment">/**</span>
<a name="l00335"></a>00335 <span class="comment">* @brief Setting 3D system at original rotation, origin, zoom.</span>
<a name="l00336"></a>00336 <span class="comment">*/</span>
<a name="l00337"></a>00337 System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a30ba78422f28b4ce56e5408c8e3f78a6">OpenGLForm::COpenGL::Home</a>()
<a name="l00338"></a>00338 {
<a name="l00339"></a>00339         <span class="comment">//Set the transformation matrix to origin</span>
<a name="l00340"></a>00340         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XX=1.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XY=0.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XZ=0.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XW=0.0f;
<a name="l00341"></a>00341         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YX=0.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YY=1.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YZ=0.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YW=0.0f;
<a name="l00342"></a>00342         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZX=0.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZY=0.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZZ=1.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZW=0.0f;
<a name="l00343"></a>00343         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;TX=0.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;TY=0.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;TZ=0.0f;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;TW=1.0f;
<a name="l00344"></a>00344         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aeab1376cc77c0a6a9923941d9348781a" title="Converts Matrix4fT form to C++ native matrix form for OpenGL use.">ConMat</a>();
<a name="l00345"></a>00345         <a class="code" href="_arc_ball_8h.html#a0d9529b8d3d0fc1dd9306848bd6e019a">Matrix3fSetIdentity</a>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a07e1ebf14aaebe563443d2923e6b4d61">LastRot</a>);                                                           <span class="comment">// Reset Rotation</span>
<a name="l00346"></a>00346         <a class="code" href="_arc_ball_8h.html#a0d9529b8d3d0fc1dd9306848bd6e019a">Matrix3fSetIdentity</a>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>);                                                           <span class="comment">// Reset Rotation</span>
<a name="l00347"></a>00347     <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a> = <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a07e1ebf14aaebe563443d2923e6b4d61">LastRot</a>;
<a name="l00348"></a>00348         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a2e614255469c48a1d3a7949936d8fcfb" title="Value of Zooming -distance for the center, focal pont.">Zoom</a>=-30.0;
<a name="l00349"></a>00349         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a57d3101b26d87de937bdff2467cddad8">TranslX</a>=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a345fefcc950cf66b9e17ea12cc03e40c" title="Translation X, Y of model.">TranslY</a>=0.0f;
<a name="l00350"></a>00350 
<a name="l00351"></a>00351         <span class="comment">//Not selecting any thing</span>
<a name="l00352"></a>00352         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#af517cdc2e6b8e972e1297cb3281e8c15" title="ID of Selected Atom- zero indexed as coming from OpenGL machinery.">SelectedAtom</a>=-1;
<a name="l00353"></a>00353         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7825b349b38f128d4a98b6b45b95051c" title="Atom to be selected.">ToBeSelectedAtom</a>=-1;
<a name="l00354"></a>00354 
<a name="l00355"></a>00355         
<a name="l00356"></a>00356 }
<a name="l00357"></a>00357 <span class="comment"></span>
<a name="l00358"></a>00358 <span class="comment">/**</span>
<a name="l00359"></a>00359 <span class="comment">* @brief Setting the initial zoom of the system in order to fit perfctly in screen.</span>
<a name="l00360"></a>00360 <span class="comment">*/</span>
<a name="l00361"></a>00361 System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a22e7bcaaad16c2edbac9a953a1ede7db">OpenGLForm::COpenGL::ZoomtoFillScreen</a>()
<a name="l00362"></a>00362 {
<a name="l00363"></a>00363         <span class="keywordtype">double</span> ratio=((double)<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc3d9b1f8036a70a3312fabf2337805" title="Width and Height of the OpenGL Window.">mHeight</a>)/((double)<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a53bce1efc6e7517c8bbce3538a1066f7">mWidth</a>);
<a name="l00364"></a>00364 
<a name="l00365"></a>00365         <span class="comment">//Checking if height or width is bigger</span>
<a name="l00366"></a>00366         <span class="keywordflow">if</span>((<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;MaxX-<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;MinX)&gt;(<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;MaxY-<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;MinY) &amp;&amp; 
<a name="l00367"></a>00367            (<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;MaxX-<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;MinX)&gt;epsilo)  
<a name="l00368"></a>00368                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a2e614255469c48a1d3a7949936d8fcfb" title="Value of Zooming -distance for the center, focal pont.">Zoom</a>= -ratio*(<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;MaxX-<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;MinX) / (2.0*tan(<a class="code" href="_i_o_spin_system_8h.html#a598a3330b3c21701223ee0ca14316eca">PI</a>/8.0))-5.0;
<a name="l00369"></a>00369         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;MaxY-<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;MinY)&gt;epsilo)                      
<a name="l00370"></a>00370                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a2e614255469c48a1d3a7949936d8fcfb" title="Value of Zooming -distance for the center, focal pont.">Zoom</a>= -ratio*(<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;MaxY-<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;MinY) / (2.0*tan(<a class="code" href="_i_o_spin_system_8h.html#a598a3330b3c21701223ee0ca14316eca">PI</a>/8.0))-5.0;
<a name="l00371"></a>00371         <span class="keywordflow">else</span> <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a2e614255469c48a1d3a7949936d8fcfb" title="Value of Zooming -distance for the center, focal pont.">Zoom</a>=-30.0;
<a name="l00372"></a>00372 }
<a name="l00373"></a>00373 <span class="comment"></span>
<a name="l00374"></a>00374 <span class="comment">/**</span>
<a name="l00375"></a>00375 <span class="comment">* @brief Converts Matrix4fT form to C++ native matrix form for OpenGL use </span>
<a name="l00376"></a>00376 <span class="comment">*/</span>
<a name="l00377"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aeab1376cc77c0a6a9923941d9348781a">00377</a> System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aeab1376cc77c0a6a9923941d9348781a" title="Converts Matrix4fT form to C++ native matrix form for OpenGL use.">OpenGLForm::COpenGL::ConMat</a>(System::Void)
<a name="l00378"></a>00378 {
<a name="l00379"></a>00379         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a700170133b4fb855f3e86cd187d0d6a6" title="Current matrix for transformation used for migration to OpenGL format.">TransformMat</a>[0]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XX;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a700170133b4fb855f3e86cd187d0d6a6" title="Current matrix for transformation used for migration to OpenGL format.">TransformMat</a>[1]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XY;
<a name="l00380"></a>00380         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a700170133b4fb855f3e86cd187d0d6a6" title="Current matrix for transformation used for migration to OpenGL format.">TransformMat</a>[2]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XZ;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a700170133b4fb855f3e86cd187d0d6a6" title="Current matrix for transformation used for migration to OpenGL format.">TransformMat</a>[3]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XW;
<a name="l00381"></a>00381         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a700170133b4fb855f3e86cd187d0d6a6" title="Current matrix for transformation used for migration to OpenGL format.">TransformMat</a>[4]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YX;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a700170133b4fb855f3e86cd187d0d6a6" title="Current matrix for transformation used for migration to OpenGL format.">TransformMat</a>[5]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YY;
<a name="l00382"></a>00382         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a700170133b4fb855f3e86cd187d0d6a6" title="Current matrix for transformation used for migration to OpenGL format.">TransformMat</a>[6]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YZ;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a700170133b4fb855f3e86cd187d0d6a6" title="Current matrix for transformation used for migration to OpenGL format.">TransformMat</a>[7]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YW;
<a name="l00383"></a>00383         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a700170133b4fb855f3e86cd187d0d6a6" title="Current matrix for transformation used for migration to OpenGL format.">TransformMat</a>[8]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZX;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a700170133b4fb855f3e86cd187d0d6a6" title="Current matrix for transformation used for migration to OpenGL format.">TransformMat</a>[9]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZY;
<a name="l00384"></a>00384         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a700170133b4fb855f3e86cd187d0d6a6" title="Current matrix for transformation used for migration to OpenGL format.">TransformMat</a>[10]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZZ;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a700170133b4fb855f3e86cd187d0d6a6" title="Current matrix for transformation used for migration to OpenGL format.">TransformMat</a>[11]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZW;
<a name="l00385"></a>00385         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a700170133b4fb855f3e86cd187d0d6a6" title="Current matrix for transformation used for migration to OpenGL format.">TransformMat</a>[12]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;TX;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a700170133b4fb855f3e86cd187d0d6a6" title="Current matrix for transformation used for migration to OpenGL format.">TransformMat</a>[13]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;TY;
<a name="l00386"></a>00386         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a700170133b4fb855f3e86cd187d0d6a6" title="Current matrix for transformation used for migration to OpenGL format.">TransformMat</a>[14]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;TZ;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a700170133b4fb855f3e86cd187d0d6a6" title="Current matrix for transformation used for migration to OpenGL format.">TransformMat</a>[15]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;TW;
<a name="l00387"></a>00387         
<a name="l00388"></a>00388 }
<a name="l00389"></a>00389 
<a name="l00390"></a>00390 <span class="preprocessor">#pragma endregion</span>
<a name="l00391"></a>00391 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00392"></a>00392 <span class="comment">///// Travelling to Plane/////////////////</span>
<a name="l00393"></a>00393 <span class="comment"></span><span class="preprocessor">#pragma region Travelling to Plane</span>
<a name="l00394"></a>00394 <span class="preprocessor"></span><span class="comment">/**</span>
<a name="l00395"></a>00395 <span class="comment">* @brief Rotates the 3D model to a plane.</span>
<a name="l00396"></a>00396 <span class="comment">* @param axis1 Name of the first axis of the plane to rotate.</span>
<a name="l00397"></a>00397 <span class="comment">* @param axis2 Name of the second axis of the plane to rotate.</span>
<a name="l00398"></a>00398 <span class="comment">*/</span>
<a name="l00399"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7fa1e17cedd7c3ec6d1d67b770b69a9d">00399</a> System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7fa1e17cedd7c3ec6d1d67b770b69a9d" title="Rotates the 3D model to a plane.">OpenGLForm::COpenGL::RotateToPlane</a>(<span class="keywordtype">char</span> axis1, <span class="keywordtype">char</span> axis2)
<a name="l00400"></a>00400 {
<a name="l00401"></a>00401         <span class="comment">//Make identity</span>
<a name="l00402"></a>00402          <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XX=1.0; <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XY=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XZ=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XW=0.0;
<a name="l00403"></a>00403          <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YX=0.0; <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YY=1.0; <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YZ=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YW=0.0; 
<a name="l00404"></a>00404          <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZX=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZY=0.0; <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZZ=1.0; <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZW=0.0; 
<a name="l00405"></a>00405          <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;TX=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;TY=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;TZ=0.0; <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;TW=1.0;
<a name="l00406"></a>00406           <a class="code" href="_arc_ball_8h.html#a0d9529b8d3d0fc1dd9306848bd6e019a">Matrix3fSetIdentity</a>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>);
<a name="l00407"></a>00407 
<a name="l00408"></a>00408         
<a name="l00409"></a>00409         <span class="keywordflow">if</span>(axis1==axis2) <span class="keywordflow">return</span>;
<a name="l00410"></a>00410 
<a name="l00411"></a>00411         <span class="comment">//Set up the rotattion matrix according to selected plane</span>
<a name="l00412"></a>00412         <span class="keywordflow">if</span>(axis1==<span class="charliteral">&#39;X&#39;</span> &amp;&amp; axis2==<span class="charliteral">&#39;Z&#39;</span>)
<a name="l00413"></a>00413         {
<a name="l00414"></a>00414         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YY=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;YY=0.0;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZZ=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;ZZ=0.0;
<a name="l00415"></a>00415         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YZ=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;YZ=-1.0;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZY=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;ZY=1.0;
<a name="l00416"></a>00416         };
<a name="l00417"></a>00417 
<a name="l00418"></a>00418         <span class="keywordflow">if</span>(axis1==<span class="charliteral">&#39;Z&#39;</span> &amp;&amp; axis2==<span class="charliteral">&#39;Y&#39;</span>)
<a name="l00419"></a>00419         {
<a name="l00420"></a>00420         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XX=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;XX=0.0;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZZ=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;ZZ=0.0;
<a name="l00421"></a>00421         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XZ=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;XZ=-1.0;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZX=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;ZX=1.0;
<a name="l00422"></a>00422         };
<a name="l00423"></a>00423 
<a name="l00424"></a>00424         <span class="keywordflow">if</span>(axis1==<span class="charliteral">&#39;Y&#39;</span> &amp;&amp; axis2==<span class="charliteral">&#39;X&#39;</span>)
<a name="l00425"></a>00425         {
<a name="l00426"></a>00426         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XX=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;XX=0.0;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YY=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;YY=0.0;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZZ=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;ZZ=0.0;
<a name="l00427"></a>00427         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XY=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;XY=1.0;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YX=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;YX=1.0;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZZ=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;ZZ=-1.0;
<a name="l00428"></a>00428         };
<a name="l00429"></a>00429 
<a name="l00430"></a>00430         <span class="keywordflow">if</span>(axis1==<span class="charliteral">&#39;Z&#39;</span> &amp;&amp; axis2==<span class="charliteral">&#39;X&#39;</span>)
<a name="l00431"></a>00431         {
<a name="l00432"></a>00432         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XX=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;XX=0.0;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YY=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;YY=0.0;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZZ=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;ZZ=0.0;
<a name="l00433"></a>00433         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XY=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;XY=1.0;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YZ=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;YZ=1.0;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZX=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;ZX=1.0;
<a name="l00434"></a>00434         };
<a name="l00435"></a>00435 
<a name="l00436"></a>00436         <span class="keywordflow">if</span>(axis1==<span class="charliteral">&#39;Y&#39;</span> &amp;&amp; axis2==<span class="charliteral">&#39;Z&#39;</span>)
<a name="l00437"></a>00437         {
<a name="l00438"></a>00438         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XX=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;XX=0.0;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YY=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;YY=0.0;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZZ=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;ZZ=0.0;
<a name="l00439"></a>00439         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XZ=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;XZ=1.0;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YX=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;YX=1.0;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZY=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>-&gt;ZY=1.0;
<a name="l00440"></a>00440         };
<a name="l00441"></a>00441         
<a name="l00442"></a>00442     <span class="comment">//Extract the current rotation matrix</span>
<a name="l00443"></a>00443         GLdouble modelview[16]; <span class="comment">//var to hold the modelview info</span>
<a name="l00444"></a>00444         glGetDoublev(GL_MODELVIEW_MATRIX, modelview ); <span class="comment">//get the modelview info</span>
<a name="l00445"></a>00445 
<a name="l00446"></a>00446         <span class="comment">//Migrate the final matrix</span>
<a name="l00447"></a>00447         GLdouble temp[16];
<a name="l00448"></a>00448         temp[0]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XX;temp[1]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XY;temp[2]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XZ;temp[3]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XW;
<a name="l00449"></a>00449         temp[4]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YX;temp[5]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YY;temp[6]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YZ;temp[7]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YW;
<a name="l00450"></a>00450         temp[8]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZX;temp[9]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZY;temp[10]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZZ;temp[11]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZW;
<a name="l00451"></a>00451         temp[12]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;TX;temp[13]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;TY;temp[14]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;TZ;temp[15]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;TW;
<a name="l00452"></a>00452 
<a name="l00453"></a>00453         <span class="comment">//Create the incrementing step matrix</span>
<a name="l00454"></a>00454         <span class="keywordtype">double</span> steps=15.0f;
<a name="l00455"></a>00455         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;12;i++)  <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a618b7a88f81f17620fa6f35658713830" title="Matrix for saving current frame in travelling.">SaveMat</a>[i]=(temp[i]-modelview[i])/steps;
<a name="l00456"></a>00456 
<a name="l00457"></a>00457         <span class="comment">//Start the Slow travelling</span>
<a name="l00458"></a>00458         ((<a class="code" href="class_spinach_g_u_i_1_1_main_form.html" title="Summary for MainForm.">SpinachGUI::MainForm</a>^)<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a904cf12aa0803e2da3a727cdb68392c4" title="Related to MainForm of Application.">mainForm</a>)-&gt;OpenGLtimer-&gt;Start();
<a name="l00459"></a>00459 
<a name="l00460"></a>00460 }
<a name="l00461"></a>00461 <span class="comment"></span>
<a name="l00462"></a>00462 <span class="comment">/**</span>
<a name="l00463"></a>00463 <span class="comment">* @brief Creates the transformation matrix for every frame during travelling</span>
<a name="l00464"></a>00464 <span class="comment">*/</span>
<a name="l00465"></a>00465 System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ae9ada6e9094ec18c7876c0c315fa034d">OpenGLForm::COpenGL::Travelling</a>()
<a name="l00466"></a>00466 {
<a name="l00467"></a>00467 
<a name="l00468"></a>00468         <span class="comment">//Extract the current rotation matrix</span>
<a name="l00469"></a>00469         GLdouble modelview[16]; <span class="comment">//var to hold the modelview info</span>
<a name="l00470"></a>00470         glGetDoublev(GL_MODELVIEW_MATRIX, modelview ); <span class="comment">//get the modelview info</span>
<a name="l00471"></a>00471 
<a name="l00472"></a>00472         <span class="comment">//Migrate the final matrix</span>
<a name="l00473"></a>00473         GLdouble temp[16];
<a name="l00474"></a>00474         temp[0]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XX;temp[1]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XY;temp[2]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XZ;temp[3]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;XW;
<a name="l00475"></a>00475         temp[4]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YX;temp[5]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YY;temp[6]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YZ;temp[7]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;YW;
<a name="l00476"></a>00476         temp[8]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZX;temp[9]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZY;temp[10]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZZ;temp[11]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;ZW;
<a name="l00477"></a>00477         temp[12]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;TX;temp[13]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;TY;temp[14]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;TZ;temp[15]=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>-&gt;TW;
<a name="l00478"></a>00478 
<a name="l00479"></a>00479         <span class="comment">//Create the transformation matrix for the current frame of travelling</span>
<a name="l00480"></a>00480         <span class="comment">// and calculate the difference from the final transformation</span>
<a name="l00481"></a>00481         <span class="keywordtype">double</span> sum=0.0f;
<a name="l00482"></a>00482         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;12;i++)
<a name="l00483"></a>00483         {
<a name="l00484"></a>00484                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a700170133b4fb855f3e86cd187d0d6a6" title="Current matrix for transformation used for migration to OpenGL format.">TransformMat</a>[i]=modelview[i]+<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a618b7a88f81f17620fa6f35658713830" title="Matrix for saving current frame in travelling.">SaveMat</a>[i];
<a name="l00485"></a>00485                 sum+=abs(temp[i]-<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a700170133b4fb855f3e86cd187d0d6a6" title="Current matrix for transformation used for migration to OpenGL format.">TransformMat</a>[i]);
<a name="l00486"></a>00486         }
<a name="l00487"></a>00487 
<a name="l00488"></a>00488         <span class="comment">// Travel termination critirion</span>
<a name="l00489"></a>00489         <span class="keywordflow">if</span>(sum&lt;0.001)   ((<a class="code" href="class_spinach_g_u_i_1_1_main_form.html" title="Summary for MainForm.">SpinachGUI::MainForm</a>^)<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a904cf12aa0803e2da3a727cdb68392c4" title="Related to MainForm of Application.">mainForm</a>)-&gt;OpenGLtimer-&gt;Stop();
<a name="l00490"></a>00490         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a4269a637342af6fb3add0853e1301da6" title="Final Render routine.">Render</a>();
<a name="l00491"></a>00491 }
<a name="l00492"></a>00492 <span class="preprocessor">#pragma endregion</span>
<a name="l00493"></a>00493 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00494"></a>00494 <span class="comment">///// Total Rendering Routines////////////</span>
<a name="l00495"></a>00495 <span class="comment"></span><span class="preprocessor">#pragma region Total Rendering Routines</span>
<a name="l00496"></a>00496 <span class="preprocessor"></span><span class="comment">/**</span>
<a name="l00497"></a>00497 <span class="comment">* @brief Updates the display list of the components of the system and renders at the end</span>
<a name="l00498"></a>00498 <span class="comment">* @param type The components type to update. </span>
<a name="l00499"></a>00499 <span class="comment">*/</span>
<a name="l00500"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ac8df7bacc4115db6119fb22eb76239f9">00500</a> System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ac8df7bacc4115db6119fb22eb76239f9" title="Updates the display list of the components of the system and renders at the end.">OpenGLForm::COpenGL::UpdateDisplay</a>(<a class="code" href="_open_g_l_8h.html#a0957e0df001dd796895b75f947daddb2">UpdateType</a> type)
<a name="l00501"></a>00501 {
<a name="l00502"></a>00502         <span class="comment">//Updates only atoms</span>
<a name="l00503"></a>00503         <span class="keywordflow">if</span>(type==<a class="code" href="_open_g_l_8h.html#a0957e0df001dd796895b75f947daddb2ac9b19bb44ce177521e4a9873919e99e6">UpdateType::ATOMS</a> || type==<a class="code" href="_open_g_l_8h.html#a0957e0df001dd796895b75f947daddb2ab1d5eac4b1dca480c8056eaea7663b7a">UpdateType::ALL</a>)
<a name="l00504"></a>00504         {
<a name="l00505"></a>00505                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a91d4b461b8d993b4ee65e940d284a5de" title="Rendering All atoms for Call list.">AllAtoms</a>=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aba422d8f28cd045e5dbd268b33f1d8fa" title="Non Default sphere for Call list.">MySphere</a>+13;
<a name="l00506"></a>00506                 glNewList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a91d4b461b8d993b4ee65e940d284a5de" title="Rendering All atoms for Call list.">AllAtoms</a>,GL_COMPILE);
<a name="l00507"></a>00507                 glFrontFace(GL_CCW);              <span class="comment">// set CCW as fron face direction</span>
<a name="l00508"></a>00508         glPolygonMode(GL_FRONT, GL_FILL); <span class="comment">// set front face fill mode</span>
<a name="l00509"></a>00509         glPolygonMode(GL_BACK,  GL_LINE); <span class="comment">// set back face fill mode</span>
<a name="l00510"></a>00510         glCullFace(GL_BACK);              <span class="comment">// set for culling back faces</span>
<a name="l00511"></a>00511         glEnable(GL_CULL_FACE);           <span class="comment">// enable face culling</span>
<a name="l00512"></a>00512                 glEnable (GL_BLEND);
<a name="l00513"></a>00513                 glBlendFunc (GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
<a name="l00514"></a>00514                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aaef092d833a02f8ffcccd33ec68565b8" title="Renders all atoms and compiles the selections ids for The OpenGL machinery.">Render_Atoms</a>();
<a name="l00515"></a>00515             <span class="comment">//glEnable(GL_CULL_FACE);</span>
<a name="l00516"></a>00516             glPolygonMode(GL_FRONT, GL_FILL); <span class="comment">// set front face fill mode</span>
<a name="l00517"></a>00517         glPolygonMode(GL_BACK,  GL_FILL); <span class="comment">// set back face fill mode</span>
<a name="l00518"></a>00518         glCullFace(GL_BACK);              <span class="comment">// set for culling back faces</span>
<a name="l00519"></a>00519         glDisable(GL_CULL_FACE); 
<a name="l00520"></a>00520                 glDisable (GL_BLEND);
<a name="l00521"></a>00521                 glEndList();
<a name="l00522"></a>00522         }
<a name="l00523"></a>00523         
<a name="l00524"></a>00524         <span class="comment">//Updates only bonds and j-couplings</span>
<a name="l00525"></a>00525         <span class="keywordflow">if</span>(type==<a class="code" href="_open_g_l_8h.html#a0957e0df001dd796895b75f947daddb2a0e25d788d277d642072209cdb5bc3d91">UpdateType::BONDS_LIKE</a> || type==<a class="code" href="_open_g_l_8h.html#a0957e0df001dd796895b75f947daddb2ab1d5eac4b1dca480c8056eaea7663b7a">UpdateType::ALL</a>)
<a name="l00526"></a>00526         {
<a name="l00527"></a>00527                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#acf9725a397d5af59de95a762cc202e16" title="Rendering All bonds and j-couplings for Call list.">AllBonds_Like</a>=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aba422d8f28cd045e5dbd268b33f1d8fa" title="Non Default sphere for Call list.">MySphere</a>+14;
<a name="l00528"></a>00528                 glNewList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#acf9725a397d5af59de95a762cc202e16" title="Rendering All bonds and j-couplings for Call list.">AllBonds_Like</a>,GL_COMPILE);
<a name="l00529"></a>00529                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a20ad2d00c74c32564330da4b870b327e" title="Render bonds and j-couplings.">Render_Bonds</a>();
<a name="l00530"></a>00530                 glEndList();
<a name="l00531"></a>00531         }
<a name="l00532"></a>00532 
<a name="l00533"></a>00533         <span class="comment">//Updates only ellpsoids</span>
<a name="l00534"></a>00534         <span class="keywordflow">if</span>(type==<a class="code" href="_open_g_l_8h.html#a0957e0df001dd796895b75f947daddb2a8beed90e57a4475297c26db8bc77d8eb">UpdateType::ELLIPSOIDS</a> || type==<a class="code" href="_open_g_l_8h.html#a0957e0df001dd796895b75f947daddb2ab1d5eac4b1dca480c8056eaea7663b7a">UpdateType::ALL</a>)
<a name="l00535"></a>00535         {
<a name="l00536"></a>00536                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a813b77a74ee0757b0d7ef7fab2bdc85f" title="Rendering All ellipsoidal interactions for Call list.">All_Ellipsoids</a>=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aba422d8f28cd045e5dbd268b33f1d8fa" title="Non Default sphere for Call list.">MySphere</a>+15;
<a name="l00537"></a>00537                 glNewList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a813b77a74ee0757b0d7ef7fab2bdc85f" title="Rendering All ellipsoidal interactions for Call list.">All_Ellipsoids</a>,GL_COMPILE);
<a name="l00538"></a>00538                 <span class="comment">//Using second method for rendering tranlucent ellipsoids</span>
<a name="l00539"></a>00539                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a34bf9fe57a5187c5e6b03a0e86aca066" title="Render in total the transparent ellispoids of all atoms nuclei selecting render method.">Render_Transparent_Atom_Properties</a>(2);
<a name="l00540"></a>00540                 glEndList();
<a name="l00541"></a>00541                 
<a name="l00542"></a>00542         }
<a name="l00543"></a>00543 
<a name="l00544"></a>00544         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a4269a637342af6fb3add0853e1301da6" title="Final Render routine.">Render</a>();
<a name="l00545"></a>00545         
<a name="l00546"></a>00546 }
<a name="l00547"></a>00547 <span class="comment"></span>
<a name="l00548"></a>00548 <span class="comment">/**</span>
<a name="l00549"></a>00549 <span class="comment">* @brief Rendering the all of the components of the 3d model</span>
<a name="l00550"></a>00550 <span class="comment">*/</span>
<a name="l00551"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a5176def024dbfe8abf5d90c939a07408">00551</a> System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a5176def024dbfe8abf5d90c939a07408" title="Rendering the all of the components of the 3d model.">OpenGLForm::COpenGL::TotalRender</a>(System::Void)
<a name="l00552"></a>00552 {
<a name="l00553"></a>00553         <span class="comment">//Render &quot;Nuclei&quot; name</span>
<a name="l00554"></a>00554         glMatrixMode(GL_PROJECTION);
<a name="l00555"></a>00555         glPushMatrix();
<a name="l00556"></a>00556         glLoadIdentity();
<a name="l00557"></a>00557         gluOrtho2D(0.0, (GLfloat)mWidth, 0.0,(GLfloat)<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc3d9b1f8036a70a3312fabf2337805" title="Width and Height of the OpenGL Window.">mHeight</a>);
<a name="l00558"></a>00558         glMatrixMode(GL_MODELVIEW);
<a name="l00559"></a>00559         glPushMatrix();
<a name="l00560"></a>00560         glLoadIdentity();
<a name="l00561"></a>00561         
<a name="l00562"></a>00562         glListBase(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#abfca7bb825b247d0cae1266b7976d548" title="Fonts for OpenGL text.">nFontList</a>);
<a name="l00563"></a>00563         glDisable(GL_DEPTH_TEST);
<a name="l00564"></a>00564         glDisable(GL_LIGHTING);
<a name="l00565"></a>00565         <span class="keywordtype">char</span> buf[23];
<a name="l00566"></a>00566         glColor3f(0.7f, 0.7f, 0.7f);
<a name="l00567"></a>00567         glRasterPos2i((GLint)10, (GLint)mHeight-25);
<a name="l00568"></a>00568 
<a name="l00569"></a>00569         <span class="comment">//Measuring FPS in debug mode</span>
<a name="l00570"></a>00570 <span class="preprocessor">#if defined(_DEBUG)</span>
<a name="l00571"></a>00571 <span class="preprocessor"></span>        sprintf_s(buf,<span class="stringliteral">&quot;NUCLEI FPS: %d    &quot;</span>, (<span class="keywordtype">int</span>)<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aa94ce2db23021e67c5a021d743773b44" title="FPS Counter.">FPSrate</a>);
<a name="l00572"></a>00572         glCallLists (17, GL_UNSIGNED_BYTE, &amp;buf);
<a name="l00573"></a>00573 <span class="preprocessor">#else</span>
<a name="l00574"></a>00574 <span class="preprocessor"></span>        sprintf_s(buf,<span class="stringliteral">&quot;NUCLEI&quot;</span>);
<a name="l00575"></a>00575         glCallLists (6, GL_UNSIGNED_BYTE, &amp;buf);
<a name="l00576"></a>00576 <span class="preprocessor">#endif</span>
<a name="l00577"></a>00577 <span class="preprocessor"></span>
<a name="l00578"></a>00578         glEnable(GL_LIGHTING);
<a name="l00579"></a>00579         glEnable(GL_DEPTH_TEST);
<a name="l00580"></a>00580 
<a name="l00581"></a>00581         glMatrixMode(GL_PROJECTION); <span class="comment">//swapped this with...</span>
<a name="l00582"></a>00582         glPopMatrix();
<a name="l00583"></a>00583         glMatrixMode(GL_MODELVIEW); <span class="comment">//...this</span>
<a name="l00584"></a>00584         glPopMatrix();
<a name="l00585"></a>00585 
<a name="l00586"></a>00586         <span class="comment">//Render Electron cloud Plane</span>
<a name="l00587"></a>00587         <span class="keywordflow">if</span>(<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;get_electron_number()&gt;0) <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6f98dd2f1244759dd296c0afe49552f6" title="Render electron cloud plane. Usually a verysmall number of electron are drawn, so not so much optimiz...">Render_Electrons</a>();
<a name="l00588"></a>00588         
<a name="l00589"></a>00589         
<a name="l00590"></a>00590         <span class="comment">//Zoom &amp; Translation, Rotation and Centering</span>
<a name="l00591"></a>00591         glTranslatef((GLfloat)(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a57d3101b26d87de937bdff2467cddad8">TranslX</a>/abs(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a2e614255469c48a1d3a7949936d8fcfb" title="Value of Zooming -distance for the center, focal pont.">Zoom</a>)), (GLfloat)(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a345fefcc950cf66b9e17ea12cc03e40c" title="Translation X, Y of model.">TranslY</a>/abs(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a2e614255469c48a1d3a7949936d8fcfb" title="Value of Zooming -distance for the center, focal pont.">Zoom</a>)),(GLfloat) <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a2e614255469c48a1d3a7949936d8fcfb" title="Value of Zooming -distance for the center, focal pont.">Zoom</a>);
<a name="l00592"></a>00592         glMultMatrixf(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a700170133b4fb855f3e86cd187d0d6a6" title="Current matrix for transformation used for migration to OpenGL format.">TransformMat</a>);
<a name="l00593"></a>00593         glTranslatef((GLfloat)(-(<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;MaxX+<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;MinX)/2.0f),
<a name="l00594"></a>00594                 (GLfloat)(-(<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;MaxY+<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;MinY)/2.0f),
<a name="l00595"></a>00595                 (GLfloat)(-(<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;MaxZ+<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;MinZ)/2.0f));
<a name="l00596"></a>00596 
<a name="l00597"></a>00597                 
<a name="l00598"></a>00598         <span class="comment">//Render Navigation Axes</span>
<a name="l00599"></a>00599         <span class="keywordflow">if</span> (<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a735447373bdfe5ed0fda746aaeaa5f72" title="Flag for showing navigation axes.">AxesFlag</a>)  <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ab5bbb674e0e4ea78f14ae0868a245e4d" title="Render of navigation axes in the edge fo the window.">Render_Navigation</a>();
<a name="l00600"></a>00600         <span class="comment">//glCallList(Navigation);</span>
<a name="l00601"></a>00601 
<a name="l00602"></a>00602         <span class="comment">//Render Atoms and selected Atoms</span>
<a name="l00603"></a>00603         glCallList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a91d4b461b8d993b4ee65e940d284a5de" title="Rendering All atoms for Call list.">AllAtoms</a>);
<a name="l00604"></a>00604         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6baf0e86d770379bdff7827cd1beb13e" title="Render an translucent outline of the atom to be selected and an fainted outline of the atom selected...">Render_SelectedAtoms</a>();
<a name="l00605"></a>00605         
<a name="l00606"></a>00606         <span class="comment">//Render Bonds</span>
<a name="l00607"></a>00607         glCallList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#acf9725a397d5af59de95a762cc202e16" title="Rendering All bonds and j-couplings for Call list.">AllBonds_Like</a>);
<a name="l00608"></a>00608 
<a name="l00609"></a>00609         <span class="comment">//Render translucent Atom properties</span>
<a name="l00610"></a>00610         glCallList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a813b77a74ee0757b0d7ef7fab2bdc85f" title="Rendering All ellipsoidal interactions for Call list.">All_Ellipsoids</a>);
<a name="l00611"></a>00611 }
<a name="l00612"></a>00612 <span class="comment"></span>
<a name="l00613"></a>00613 <span class="comment">/**</span>
<a name="l00614"></a>00614 <span class="comment">* @brief Final Render routine</span>
<a name="l00615"></a>00615 <span class="comment">*/</span>
<a name="l00616"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a4269a637342af6fb3add0853e1301da6">00616</a> System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a4269a637342af6fb3add0853e1301da6" title="Final Render routine.">OpenGLForm::COpenGL::Render</a>(System::Void)
<a name="l00617"></a>00617 {
<a name="l00618"></a>00618         <span class="comment">//For measuring frame rate</span>
<a name="l00619"></a>00619         ++<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ab18dfb6dba5051a167a0f84fd8848550" title="Number of times through display loop since redraw.">loop_count</a>;
<a name="l00620"></a>00620     <span class="keywordtype">double</span> curtime = GetTickCount()/1000.0;
<a name="l00621"></a>00621 
<a name="l00622"></a>00622         <span class="comment">//Initializing Rendering</span>
<a name="l00623"></a>00623         <span class="comment">// Background color</span>
<a name="l00624"></a>00624         glClearColor((GLfloat)<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a59338162d14cc3c1179d6c90290ce450" title="RGB Matrix for the color.">BackgroundColor</a>[0],  
<a name="l00625"></a>00625                          (GLfloat)BackgroundColor[1], 
<a name="l00626"></a>00626                          (GLfloat)BackgroundColor[2], 
<a name="l00627"></a>00627                                  1.0f); 
<a name="l00628"></a>00628         <span class="comment">// Fog-culling color</span>
<a name="l00629"></a>00629         GLfloat fogcol[4];
<a name="l00630"></a>00630         fogcol[0] = (GLfloat)BackgroundColor[0];  
<a name="l00631"></a>00631         fogcol[1] = (GLfloat)BackgroundColor[0];
<a name="l00632"></a>00632         fogcol[2] = (GLfloat)BackgroundColor[0];  
<a name="l00633"></a>00633         fogcol[3] = 1.0;
<a name="l00634"></a>00634         glFogfv(GL_FOG_COLOR, fogcol);
<a name="l00635"></a>00635 
<a name="l00636"></a>00636         glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT|GL_STENCIL_BUFFER_BIT);       <span class="comment">// Clear screen and depth buffer</span>
<a name="l00637"></a>00637         
<a name="l00638"></a>00638         <span class="comment">//Setting the perspective</span>
<a name="l00639"></a>00639         glMatrixMode(GL_PROJECTION);
<a name="l00640"></a>00640         glLoadIdentity();
<a name="l00641"></a>00641         gluPerspective(45.0f,(GLfloat)mWidth/(GLfloat)<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc3d9b1f8036a70a3312fabf2337805" title="Width and Height of the OpenGL Window.">mHeight</a>,0.1f,300.0f); <span class="comment">//gluPerspective(fov, Aspect, nplane, fplane);</span>
<a name="l00642"></a>00642 
<a name="l00643"></a>00643         <span class="comment">//Back to modelview for rotation</span>
<a name="l00644"></a>00644         glMatrixMode(GL_MODELVIEW);
<a name="l00645"></a>00645         glLoadIdentity();
<a name="l00646"></a>00646 
<a name="l00647"></a>00647         
<a name="l00648"></a>00648         glEnable (GL_BLEND);
<a name="l00649"></a>00649         glBlendFunc (GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
<a name="l00650"></a>00650 
<a name="l00651"></a>00651         <span class="comment">//Quadbuffering for stereo view or not</span>
<a name="l00652"></a>00652         <span class="keywordflow">if</span>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ab7c488998482ef56d60f94fbddbd0879" title="Flag for stero viewing.">stereoview</a>)
<a name="l00653"></a>00653         {     
<a name="l00654"></a>00654         <span class="comment">//Left Eye</span>
<a name="l00655"></a>00655     glDrawBuffer(GL_BACK_LEFT);
<a name="l00656"></a>00656         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a89ada71ba19ad35316eb8cb304e63edc" title="Calculates the transformation matrix and parameters for double or quad buffer display.">Calc_eye</a>(1, <span class="keyword">true</span>);
<a name="l00657"></a>00657         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a5176def024dbfe8abf5d90c939a07408" title="Rendering the all of the components of the 3d model.">TotalRender</a>();
<a name="l00658"></a>00658 
<a name="l00659"></a>00659         <span class="comment">//Right Eye</span>
<a name="l00660"></a>00660         glDepthMask(GL_TRUE);
<a name="l00661"></a>00661         glClear(GL_DEPTH_BUFFER_BIT);
<a name="l00662"></a>00662         glDrawBuffer(GL_BACK_RIGHT);
<a name="l00663"></a>00663         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a89ada71ba19ad35316eb8cb304e63edc" title="Calculates the transformation matrix and parameters for double or quad buffer display.">Calc_eye</a>(2, <span class="keyword">true</span>);
<a name="l00664"></a>00664         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a5176def024dbfe8abf5d90c939a07408" title="Rendering the all of the components of the 3d model.">TotalRender</a>();
<a name="l00665"></a>00665         }
<a name="l00666"></a>00666         <span class="keywordflow">else</span> 
<a name="l00667"></a>00667         {
<a name="l00668"></a>00668         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a89ada71ba19ad35316eb8cb304e63edc" title="Calculates the transformation matrix and parameters for double or quad buffer display.">Calc_eye</a>(0, <span class="keyword">true</span>);
<a name="l00669"></a>00669         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a5176def024dbfe8abf5d90c939a07408" title="Rendering the all of the components of the 3d model.">TotalRender</a>();
<a name="l00670"></a>00670         }
<a name="l00671"></a>00671         
<a name="l00672"></a>00672         <span class="comment">//For FPS measure</span>
<a name="l00673"></a>00673         <span class="keywordflow">if</span> (curtime - <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a67bc0706cfe86758cb6b0afd9a3b4802" title="Time of last redraw.">last_update</a> &gt; 0.5)
<a name="l00674"></a>00674         {
<a name="l00675"></a>00675                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aa94ce2db23021e67c5a021d743773b44" title="FPS Counter.">FPSrate</a> = <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ab18dfb6dba5051a167a0f84fd8848550" title="Number of times through display loop since redraw.">loop_count</a> / (curtime - <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a67bc0706cfe86758cb6b0afd9a3b4802" title="Time of last redraw.">last_update</a>);
<a name="l00676"></a>00676                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a67bc0706cfe86758cb6b0afd9a3b4802" title="Time of last redraw.">last_update</a> = curtime;
<a name="l00677"></a>00677                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ab18dfb6dba5051a167a0f84fd8848550" title="Number of times through display loop since redraw.">loop_count</a> = 0;
<a name="l00678"></a>00678         }
<a name="l00679"></a>00679 
<a name="l00680"></a>00680         <span class="comment">//OpenGL exception catching</span>
<a name="l00681"></a>00681         GLenum x = glGetError() ;
<a name="l00682"></a>00682         <span class="keywordflow">if</span> ( x != GL_NO_ERROR ) cout &lt;&lt; <span class="stringliteral">&quot;OpenGL error:&quot;</span> &lt;&lt; gluErrorString(x) &lt;&lt; endl;
<a name="l00683"></a>00683                 
<a name="l00684"></a>00684         
<a name="l00685"></a>00685         <span class="comment">//Swap the Buffers and send it to the graphics card(flush)</span>
<a name="l00686"></a>00686         SwapBuffers(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a12341750588558dacd3daf1b8408a6ef" title="For OpenGL window panel.">m_hDC</a>);     
<a name="l00687"></a>00687         glFlush();
<a name="l00688"></a>00688         glDrawBuffer(GL_BACK);
<a name="l00689"></a>00689 }
<a name="l00690"></a>00690 <span class="comment"></span>
<a name="l00691"></a>00691 <span class="comment">/**</span>
<a name="l00692"></a>00692 <span class="comment">* @brief Calculates the transformation matrix and parameters for double or quad buffer display</span>
<a name="l00693"></a>00693 <span class="comment">* @param whicheye For which eye to create the transformation matrix, 1:Left, 2:Right, 0: Nothing.</span>
<a name="l00694"></a>00694 <span class="comment">* @param calc Flag used for rendering of selection buffer.</span>
<a name="l00695"></a>00695 <span class="comment">*/</span>
<a name="l00696"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a89ada71ba19ad35316eb8cb304e63edc">00696</a> System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a89ada71ba19ad35316eb8cb304e63edc" title="Calculates the transformation matrix and parameters for double or quad buffer display.">OpenGLForm::COpenGL::Calc_eye</a>(<span class="keywordtype">int</span> whicheye, <span class="keywordtype">bool</span> calc)
<a name="l00697"></a>00697 {
<a name="l00698"></a>00698   <span class="keywordtype">float</span> Aspect=(GLfloat)mWidth/(GLfloat)<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc3d9b1f8036a70a3312fabf2337805" title="Width and Height of the OpenGL Window.">mHeight</a>;
<a name="l00699"></a>00699   <span class="keywordtype">float</span> d,cpUp, cpDown, cpLeft, cpRight;
<a name="l00700"></a>00700   <span class="keywordtype">float</span> nearClip=1.0f, farClip=6000.0f, vSize=2.0f, zDist=0.0f;
<a name="l00701"></a>00701   <span class="comment">//float nearClip=0.5f, farClip=10.0f, vSize=4.0f, zDist=0.0f;</span>
<a name="l00702"></a>00702   <span class="keywordtype">float</span> halfvsize = 0.5f * vSize; <span class="comment">//OK</span>
<a name="l00703"></a>00703   <span class="keywordtype">float</span> halfhsize = Aspect * halfvsize;<span class="comment">//OK // width = aspect * height</span>
<a name="l00704"></a>00704   <span class="keywordtype">float</span> eyePos[3]={0,0,2}; <span class="comment">//OK</span>
<a name="l00705"></a>00705   <span class="keywordtype">float</span> upDir[3]={0,1,0}; <span class="comment">//OK</span>
<a name="l00706"></a>00706   <span class="keywordtype">float</span> eyeDir[3]={0,0,-2}; <span class="comment">//OK</span>
<a name="l00707"></a>00707   <span class="keywordtype">float</span> eyeSep=0.080f; <span class="comment">//OK</span>
<a name="l00708"></a>00708   <span class="keywordtype">float</span> eyeDist=eyePos[2]; <span class="comment">//OK</span>
<a name="l00709"></a>00709   <span class="keywordtype">float</span> flen=3.0; <span class="comment">//3</span>
<a name="l00710"></a>00710   <span class="keywordtype">float</span> eyeSepDir[3];
<a name="l00711"></a>00711 
<a name="l00712"></a>00712   <span class="keywordflow">if</span> (!eyeDist) <span class="keywordflow">return</span>;
<a name="l00713"></a>00713   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;3; i++) eyeDir[i] *= flen/eyeDist;
<a name="l00714"></a>00714   eyeDist = flen;
<a name="l00715"></a>00715 
<a name="l00716"></a>00716   <span class="keywordflow">if</span>(eyePos[2] - zDist != 0.0f)
<a name="l00717"></a>00717     {
<a name="l00718"></a>00718          d = nearClip / (eyePos[2] - zDist);
<a name="l00719"></a>00719          cpRight = d * halfhsize;     <span class="comment">// right side is at half width</span>
<a name="l00720"></a>00720      cpLeft = -cpRight;           <span class="comment">// left side is at negative half width</span>
<a name="l00721"></a>00721      cpUp = d * halfvsize;        <span class="comment">// top side is at half height</span>
<a name="l00722"></a>00722      cpDown = -cpUp;              <span class="comment">// bottom is at negative half height</span>
<a name="l00723"></a>00723      };
<a name="l00724"></a>00724 
<a name="l00725"></a>00725   <span class="keywordtype">float</span> *L = eyeDir;
<a name="l00726"></a>00726   <span class="keywordtype">float</span> *U = upDir;
<a name="l00727"></a>00727   <span class="keywordtype">float</span> m, A = 0.5f * eyeSep;
<a name="l00728"></a>00728   eyeSepDir[0] = L[1] * U[2] - L[2] * U[1];
<a name="l00729"></a>00729   eyeSepDir[1] = L[2] * U[0] - L[0] * U[2];
<a name="l00730"></a>00730   eyeSepDir[2] = L[0] * U[1] - L[1] * U[0];
<a name="l00731"></a>00731   m = sqrt(eyeSepDir[0] * eyeSepDir[0] + eyeSepDir[1] * eyeSepDir[1] +
<a name="l00732"></a>00732             eyeSepDir[2] * eyeSepDir[2]);
<a name="l00733"></a>00733 
<a name="l00734"></a>00734   <span class="keywordflow">if</span>(m &gt; 0.0)  A /= m;
<a name="l00735"></a>00735   <span class="keywordflow">else</span>  A = 0.0;
<a name="l00736"></a>00736 
<a name="l00737"></a>00737   eyeSepDir[0] *= A;
<a name="l00738"></a>00738   eyeSepDir[1] *= A;
<a name="l00739"></a>00739   eyeSepDir[2] *= A;
<a name="l00740"></a>00740 
<a name="l00741"></a>00741   <span class="keywordtype">int</span> i;
<a name="l00742"></a>00742   GLdouble ep[3];
<a name="l00743"></a>00743 
<a name="l00744"></a>00744   
<a name="l00745"></a>00745 
<a name="l00746"></a>00746   <span class="keywordflow">switch</span> (whicheye) {
<a name="l00747"></a>00747   <span class="keywordflow">case</span> 1:  <span class="comment">//Left eye</span>
<a name="l00748"></a>00748           <span class="comment">// draw to BACK LEFT only</span>
<a name="l00749"></a>00749           <span class="comment">// glDepthMask(GL_TRUE);</span>
<a name="l00750"></a>00750           glDrawBuffer(GL_BACK_LEFT);
<a name="l00751"></a>00751           <span class="comment">//glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</span>
<a name="l00752"></a>00752           <span class="keywordflow">for</span> (i=0; i&lt;3; i++)  ep[i] = eyePos[i] - eyeSepDir[i];
<a name="l00753"></a>00753           <span class="keywordflow">break</span>;
<a name="l00754"></a>00754 
<a name="l00755"></a>00755   <span class="keywordflow">case</span> 2: <span class="comment">//Right eye</span>
<a name="l00756"></a>00756           <span class="comment">// draw to BACK RIGHT only</span>
<a name="l00757"></a>00757           <span class="keywordflow">if</span>(calc)
<a name="l00758"></a>00758           {
<a name="l00759"></a>00759           glDepthMask(GL_TRUE);
<a name="l00760"></a>00760           <span class="comment">//glClear(GL_DEPTH_BUFFER_BIT); //normal</span>
<a name="l00761"></a>00761 
<a name="l00762"></a>00762           glDrawBuffer(GL_BACK_RIGHT);<span class="comment">//alternative</span>
<a name="l00763"></a>00763           glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);<span class="comment">//alternative</span>
<a name="l00764"></a>00764 
<a name="l00765"></a>00765           glDrawBuffer(GL_BACK_RIGHT);
<a name="l00766"></a>00766           }
<a name="l00767"></a>00767           <span class="keywordflow">for</span> (i=0; i&lt;3; i++) ep[i] = eyePos[i] + eyeSepDir[i];
<a name="l00768"></a>00768           <span class="keywordflow">break</span>;
<a name="l00769"></a>00769 
<a name="l00770"></a>00770   <span class="keywordflow">case</span> 0:<span class="comment">//No stereo</span>
<a name="l00771"></a>00771           <span class="keywordflow">for</span> (i=0; i&lt;3; i++) ep[i] = eyePos[i];
<a name="l00772"></a>00772           <span class="keywordflow">break</span>;
<a name="l00773"></a>00773   };
<a name="l00774"></a>00774 
<a name="l00775"></a>00775  
<a name="l00776"></a>00776   <span class="keywordtype">float</span> eyeshift = float(ep[0] - eyePos[0]);
<a name="l00777"></a>00777   <span class="keywordflow">if</span>(calc) glMatrixMode(GL_PROJECTION);
<a name="l00778"></a>00778   <span class="keywordflow">if</span>(calc) glLoadIdentity();
<a name="l00779"></a>00779   glFrustum((GLdouble)cpLeft  + (eyeshift * nearClip / eyeDist),
<a name="l00780"></a>00780           (GLdouble)cpRight + (eyeshift * nearClip / eyeDist),
<a name="l00781"></a>00781           (GLdouble)cpDown,
<a name="l00782"></a>00782           (GLdouble)cpUp,
<a name="l00783"></a>00783           (GLdouble)nearClip,
<a name="l00784"></a>00784           (GLdouble)farClip);
<a name="l00785"></a>00785 
<a name="l00786"></a>00786 
<a name="l00787"></a>00787   glTranslatef(-eyeshift, 0.0, 0.0);
<a name="l00788"></a>00788   glMatrixMode(GL_MODELVIEW);
<a name="l00789"></a>00789   glLoadIdentity();
<a name="l00790"></a>00790   gluLookAt(eyePos[0], eyePos[1], eyePos[2],
<a name="l00791"></a>00791           (GLdouble)(eyePos[0] + eyeDir[0]),
<a name="l00792"></a>00792           (GLdouble)(eyePos[1] + eyeDir[1]),
<a name="l00793"></a>00793           (GLdouble)(eyePos[2] + eyeDir[2]),
<a name="l00794"></a>00794           (GLdouble)(upDir[0]),
<a name="l00795"></a>00795           (GLdouble)(upDir[1]),
<a name="l00796"></a>00796           (GLdouble)(upDir[2]));
<a name="l00797"></a>00797 <span class="comment">/*</span>
<a name="l00798"></a>00798 <span class="comment"></span>
<a name="l00799"></a>00799 <span class="comment">      glMatrixMode(GL_PROJECTION);</span>
<a name="l00800"></a>00800 <span class="comment">    glLoadIdentity();</span>
<a name="l00801"></a>00801 <span class="comment">    glFrustum((GLdouble)cpLeft,  (GLdouble)cpRight,  (GLdouble)cpDown,</span>
<a name="l00802"></a>00802 <span class="comment">              (GLdouble)cpUp,   (GLdouble)nearClip, (GLdouble)farClip);</span>
<a name="l00803"></a>00803 <span class="comment"></span>
<a name="l00804"></a>00804 <span class="comment">    glMatrixMode(GL_MODELVIEW);</span>
<a name="l00805"></a>00805 <span class="comment">    glLoadIdentity();</span>
<a name="l00806"></a>00806 <span class="comment">    gluLookAt(ep[0], ep[1], ep[2],</span>
<a name="l00807"></a>00807 <span class="comment">              (GLdouble)(eyePos[0] + eyeDir[0]),</span>
<a name="l00808"></a>00808 <span class="comment">              (GLdouble)(eyePos[1] + eyeDir[1]),</span>
<a name="l00809"></a>00809 <span class="comment">              (GLdouble)(eyePos[2] + eyeDir[2]),</span>
<a name="l00810"></a>00810 <span class="comment">              (GLdouble)(upDir[0]),</span>
<a name="l00811"></a>00811 <span class="comment">              (GLdouble)(upDir[1]),</span>
<a name="l00812"></a>00812 <span class="comment">              (GLdouble)(upDir[2]));</span>
<a name="l00813"></a>00813 <span class="comment"></span>
<a name="l00814"></a>00814 <span class="comment">*/</span>
<a name="l00815"></a>00815 
<a name="l00816"></a>00816 }
<a name="l00817"></a>00817 <span class="preprocessor">#pragma endregion</span>
<a name="l00818"></a>00818 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00819"></a>00819 <span class="comment">///// Rendering Nuclei components/////////</span>
<a name="l00820"></a>00820 <span class="comment"></span><span class="preprocessor">#pragma region Rendering Nuclei components</span>
<a name="l00821"></a>00821 <span class="preprocessor"></span><span class="comment">/**</span>
<a name="l00822"></a>00822 <span class="comment">* @brief Render in total the transparent ellispoids of all atoms nuclei selecting render method.</span>
<a name="l00823"></a>00823 <span class="comment">* @param RenderKind Rendering method for translucent ellipsoids </span>
<a name="l00824"></a>00824 <span class="comment">* 1:Nothing just blending, 2:No depthing, 3:Using multiple passes.</span>
<a name="l00825"></a>00825 <span class="comment">*/</span>
<a name="l00826"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a34bf9fe57a5187c5e6b03a0e86aca066">00826</a> System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a34bf9fe57a5187c5e6b03a0e86aca066" title="Render in total the transparent ellispoids of all atoms nuclei selecting render method.">OpenGLForm::COpenGL::Render_Transparent_Atom_Properties</a>(<span class="keywordtype">int</span> RenderKind)
<a name="l00827"></a>00827 {
<a name="l00828"></a>00828         <span class="keywordflow">if</span>(RenderKind==1) <span class="comment">//Using nothing</span>
<a name="l00829"></a>00829         {
<a name="l00830"></a>00830                 glBlendFunc (GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
<a name="l00831"></a>00831                 glEnable (GL_BLEND);
<a name="l00832"></a>00832                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6b334a904a14208066ba9619d9761069" title="Render the transparent ellispoids of all atoms nuclei with the specified translucency.">Render_Transparency</a>(1.0f,<span class="keyword">true</span>);
<a name="l00833"></a>00833         }
<a name="l00834"></a>00834         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(RenderKind==2) <span class="comment">//No depthing</span>
<a name="l00835"></a>00835         {
<a name="l00836"></a>00836                 glBlendFunc (GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
<a name="l00837"></a>00837                 glEnable (GL_BLEND);
<a name="l00838"></a>00838                 glDepthMask(GL_FALSE);
<a name="l00839"></a>00839                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6b334a904a14208066ba9619d9761069" title="Render the transparent ellispoids of all atoms nuclei with the specified translucency.">Render_Transparency</a>(0.8f,<span class="keyword">true</span>);
<a name="l00840"></a>00840                 glDepthMask(GL_TRUE);
<a name="l00841"></a>00841 
<a name="l00842"></a>00842         }
<a name="l00843"></a>00843         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(RenderKind==3) <span class="comment">//Using multiple passes</span>
<a name="l00844"></a>00844         {
<a name="l00845"></a>00845                 <span class="keywordtype">double</span> fac=0.75f;
<a name="l00846"></a>00846                 glBlendFunc (GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
<a name="l00847"></a>00847                 glEnable (GL_BLEND);<span class="comment"></span>
<a name="l00848"></a>00848 <span class="comment">                ///////////////////////////////////////</span>
<a name="l00849"></a>00849 <span class="comment"></span>                glDisable(GL_CULL_FACE);
<a name="l00850"></a>00850                 glDepthFunc(GL_LESS);
<a name="l00851"></a>00851                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aaef092d833a02f8ffcccd33ec68565b8" title="Renders all atoms and compiles the selections ids for The OpenGL machinery.">Render_Atoms</a>();
<a name="l00852"></a>00852                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6b334a904a14208066ba9619d9761069" title="Render the transparent ellispoids of all atoms nuclei with the specified translucency.">Render_Transparency</a>(0.0f,<span class="keyword">true</span>);
<a name="l00853"></a>00853                 <span class="comment">// render with alpha = 0, to prime the depth buffer</span>
<a name="l00854"></a>00854 
<a name="l00855"></a>00855                 glEnable(GL_CULL_FACE);
<a name="l00856"></a>00856                 glCullFace(GL_FRONT);
<a name="l00857"></a>00857                 glDepthFunc(GL_ALWAYS);
<a name="l00858"></a>00858                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6b334a904a14208066ba9619d9761069" title="Render the transparent ellispoids of all atoms nuclei with the specified translucency.">Render_Transparency</a>(fac,<span class="keyword">true</span>);
<a name="l00859"></a>00859                 <span class="comment">// render with alpha = f*alpha</span>
<a name="l00860"></a>00860 
<a name="l00861"></a>00861                 glEnable(GL_CULL_FACE);
<a name="l00862"></a>00862                 glCullFace(GL_FRONT);
<a name="l00863"></a>00863                 glDepthFunc(GL_LEQUAL);
<a name="l00864"></a>00864                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6b334a904a14208066ba9619d9761069" title="Render the transparent ellispoids of all atoms nuclei with the specified translucency.">Render_Transparency</a>(fac,<span class="keyword">false</span>);
<a name="l00865"></a>00865                 <span class="comment">// render with alpha = (alpha-f*alpha)/(1.0-f*alpha)</span>
<a name="l00866"></a>00866 
<a name="l00867"></a>00867 
<a name="l00868"></a>00868                 glEnable(GL_CULL_FACE);
<a name="l00869"></a>00869                 glCullFace(GL_BACK);
<a name="l00870"></a>00870                 glDepthFunc(GL_ALWAYS);
<a name="l00871"></a>00871                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6b334a904a14208066ba9619d9761069" title="Render the transparent ellispoids of all atoms nuclei with the specified translucency.">Render_Transparency</a>(fac,<span class="keyword">true</span>);
<a name="l00872"></a>00872                 <span class="comment">// render with alpha = f*alpha</span>
<a name="l00873"></a>00873 
<a name="l00874"></a>00874                 <span class="comment">// There&#39;s a trade off here. With culling enabled then a perfectly</span>
<a name="l00875"></a>00875                 <span class="comment">// opaque object (alpha=1) may be wrong. With it disabled, ordering</span>
<a name="l00876"></a>00876                 <span class="comment">// artifacts may appear</span>
<a name="l00877"></a>00877                 <span class="comment">// glEnable(GL_CULL_FACE);</span>
<a name="l00878"></a>00878                 <span class="comment">// glCullFace(GL_BACK);</span>
<a name="l00879"></a>00879                 glDisable(GL_CULL_FACE);
<a name="l00880"></a>00880                 glDepthFunc(GL_LEQUAL);
<a name="l00881"></a>00881                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6b334a904a14208066ba9619d9761069" title="Render the transparent ellispoids of all atoms nuclei with the specified translucency.">Render_Transparency</a>(fac,<span class="keyword">false</span>);
<a name="l00882"></a>00882 
<a name="l00883"></a>00883                 <span class="comment">//back to original</span>
<a name="l00884"></a>00884                 glDisable(GL_CULL_FACE);
<a name="l00885"></a>00885                 glDisable (GL_BLEND);
<a name="l00886"></a>00886                 glDepthFunc(GL_LEQUAL); 
<a name="l00887"></a>00887         };
<a name="l00888"></a>00888 
<a name="l00889"></a>00889 
<a name="l00890"></a>00890 
<a name="l00891"></a>00891 }
<a name="l00892"></a>00892 <span class="comment"></span>
<a name="l00893"></a>00893 <span class="comment">/**</span>
<a name="l00894"></a>00894 <span class="comment">* @brief Render an translucent outline of the atom to be selected and an fainted outline</span>
<a name="l00895"></a>00895 <span class="comment">* of the atom selected. Also show the ID of the atom. If proper flag is true show</span>
<a name="l00896"></a>00896 <span class="comment">* the ID of all atoms.</span>
<a name="l00897"></a>00897 <span class="comment">*/</span>
<a name="l00898"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6baf0e86d770379bdff7827cd1beb13e">00898</a> System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6baf0e86d770379bdff7827cd1beb13e" title="Render an translucent outline of the atom to be selected and an fainted outline of the atom selected...">OpenGLForm::COpenGL::Render_SelectedAtoms</a>(System::Void)
<a name="l00899"></a>00899 {
<a name="l00900"></a>00900         <span class="keywordtype">float</span> red,green,blue,scaling; 
<a name="l00901"></a>00901         <span class="keywordtype">float</span> num=1.5f/300.f;                   <span class="comment">//scaling factor</span>
<a name="l00902"></a>00902         
<a name="l00903"></a>00903         <span class="comment">//Enable culling</span>
<a name="l00904"></a>00904         glFrontFace(GL_CCW);              <span class="comment">// set CCW as fron face direction</span>
<a name="l00905"></a>00905         glPolygonMode(GL_FRONT, GL_FILL); <span class="comment">// set front face fill mode</span>
<a name="l00906"></a>00906         glPolygonMode(GL_BACK,  GL_LINE); <span class="comment">// set back face fill mode</span>
<a name="l00907"></a>00907         glCullFace(GL_BACK);              <span class="comment">// set for culling back faces</span>
<a name="l00908"></a>00908         glEnable(GL_CULL_FACE);           <span class="comment">// enable face culling</span>
<a name="l00909"></a>00909         glEnable (GL_BLEND);
<a name="l00910"></a>00910         glBlendFunc (GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
<a name="l00911"></a>00911 
<a name="l00912"></a>00912 <span class="comment">//Loop over all atoms for drawing all the IDs when needed</span>
<a name="l00913"></a>00913  <span class="keywordflow">for each</span>(<span class="keywordtype">int</span> i <span class="keywordflow">in</span> <a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;Keys)
<a name="l00914"></a>00914         {
<a name="l00915"></a>00915         <span class="keywordflow">if</span> (((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;isotope-&gt;Element!=<span class="stringliteral">&quot;e&quot;</span>)
<a name="l00916"></a>00916            {
<a name="l00917"></a>00917                 <span class="comment">//Draw the fainted outline for the atom selected</span>
<a name="l00918"></a>00918                 <span class="keywordflow">if</span>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a0f0330d51c3dd60a65da76dc533d177e" title="Flag for selecting atoms.">SelectFlag</a> &amp;&amp; (<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#af517cdc2e6b8e972e1297cb3281e8c15" title="ID of Selected Atom- zero indexed as coming from OpenGL machinery.">SelectedAtom</a>==i-1 ))
<a name="l00919"></a>00919                 {
<a name="l00920"></a>00920                         glPushMatrix();
<a name="l00921"></a>00921                         <span class="comment">//The same position as the atom</span>
<a name="l00922"></a>00922                         glTranslatef((GLfloat)((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;X,
<a name="l00923"></a>00923                                                  (GLfloat)((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;Y,
<a name="l00924"></a>00924                                                  (GLfloat)((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;Z);
<a name="l00925"></a>00925 
<a name="l00926"></a>00926                         <span class="comment">//Color a litle bit more fainted than  the  color of the atom</span>
<a name="l00927"></a>00927                         red=((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;isotope-&gt;Red;
<a name="l00928"></a>00928                         green=((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;isotope-&gt;Green;
<a name="l00929"></a>00929                         blue=((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;isotope-&gt;Blue;
<a name="l00930"></a>00930                         glColor4f(red+0.1f,green+0.1f,blue+0.1f,0.6f);
<a name="l00931"></a>00931 
<a name="l00932"></a>00932                         <span class="comment">//Large than the atom by a factor num</span>
<a name="l00933"></a>00933                         scaling=num*((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;isotope-&gt;Radius;
<a name="l00934"></a>00934                         glScalef((GLfloat)scaling,(GLfloat)scaling,(GLfloat)scaling);
<a name="l00935"></a>00935 
<a name="l00936"></a>00936                         <span class="comment">//Draw</span>
<a name="l00937"></a>00937                         <span class="keywordflow">if</span> (<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ab71e341d370590f578bfb2b9156fb21a" title="Flag for using low resolution during rotation.">LowRes</a>)glCallList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a30122f7a0e8a1087a6104fd2c1ef114f" title="Selected Sphere with low Resolution for Call list.">SelectedSphereLowRes</a>); <span class="keywordflow">else</span> glCallList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7deebfbc439113126d7980a6a5231560" title="Selected Sphere with high Resolution for Call list.">SelectedSphereHighRes</a>);
<a name="l00938"></a>00938                         glPopMatrix();
<a name="l00939"></a>00939                 };
<a name="l00940"></a>00940                 
<a name="l00941"></a>00941                 <span class="comment">//Draw the translucent outline for the atom to be selected</span>
<a name="l00942"></a>00942                 <span class="keywordflow">if</span>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a0f0330d51c3dd60a65da76dc533d177e" title="Flag for selecting atoms.">SelectFlag</a> &amp;&amp; (<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7825b349b38f128d4a98b6b45b95051c" title="Atom to be selected.">ToBeSelectedAtom</a>==i-1))
<a name="l00943"></a>00943                 {
<a name="l00944"></a>00944                         glPushMatrix();
<a name="l00945"></a>00945                         <span class="comment">//The same position as the atom</span>
<a name="l00946"></a>00946                         glTranslatef((GLfloat)((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;X,
<a name="l00947"></a>00947                                                  (GLfloat)((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;Y,
<a name="l00948"></a>00948                                                  (GLfloat)((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;Z);
<a name="l00949"></a>00949 
<a name="l00950"></a>00950                         <span class="comment">//Color a litle bit more translucent than  the  color of the atom</span>
<a name="l00951"></a>00951                         red=((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;isotope-&gt;Red;
<a name="l00952"></a>00952                         green=((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;isotope-&gt;Green;
<a name="l00953"></a>00953                         blue=((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;isotope-&gt;Blue;
<a name="l00954"></a>00954                         glColor4f(red+0.1f,green+0.1f,blue+0.1f,0.2f);
<a name="l00955"></a>00955 
<a name="l00956"></a>00956                         <span class="comment">//Large than the atom by a factor num</span>
<a name="l00957"></a>00957                         scaling=num*((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;isotope-&gt;Radius;
<a name="l00958"></a>00958                         glScalef((GLfloat)scaling,(GLfloat)scaling,(GLfloat)scaling);
<a name="l00959"></a>00959                         <span class="comment">//Draw</span>
<a name="l00960"></a>00960                         <span class="keywordflow">if</span> (<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ab71e341d370590f578bfb2b9156fb21a" title="Flag for using low resolution during rotation.">LowRes</a>)glCallList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a30122f7a0e8a1087a6104fd2c1ef114f" title="Selected Sphere with low Resolution for Call list.">SelectedSphereLowRes</a>); <span class="keywordflow">else</span> glCallList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7deebfbc439113126d7980a6a5231560" title="Selected Sphere with high Resolution for Call list.">SelectedSphereHighRes</a>);
<a name="l00961"></a>00961                         glPopMatrix();
<a name="l00962"></a>00962                 };
<a name="l00963"></a>00963 
<a name="l00964"></a>00964                 <span class="comment">//Label atoms with their ID to be selected or when flag of drawing all atoms ID is true</span>
<a name="l00965"></a>00965                 <span class="keywordflow">if</span>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aea9bc7ab4d1f1cb9f91b2fa4fd9d7d28" title="Flag for showing ID of all atoms.">AtomIDFlag</a> || <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7825b349b38f128d4a98b6b45b95051c" title="Atom to be selected.">ToBeSelectedAtom</a>==i-1) 
<a name="l00966"></a>00966                         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a198db840c47578a0a2bbc10f132ed9f7" title="Renders OpenGL text of the integer number ID in distance radius from a point lied in (x...">Render_IDText</a>(((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;X, 
<a name="l00967"></a>00967                                           ((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;Y, 
<a name="l00968"></a>00968                                           ((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;Z,
<a name="l00969"></a>00969                                                   (GLfloat)((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;isotope-&gt;Radius/300.0f,
<a name="l00970"></a>00970                                           ((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;getID());
<a name="l00971"></a>00971                 
<a name="l00972"></a>00972             };
<a name="l00973"></a>00973         };
<a name="l00974"></a>00974 
<a name="l00975"></a>00975                 <span class="comment">//Disable culling</span>
<a name="l00976"></a>00976             <span class="comment">//glEnable(GL_CULL_FACE);</span>
<a name="l00977"></a>00977             glPolygonMode(GL_FRONT, GL_FILL); <span class="comment">// set front face fill mode</span>
<a name="l00978"></a>00978         glPolygonMode(GL_BACK,  GL_FILL); <span class="comment">// set back face fill mode</span>
<a name="l00979"></a>00979         glCullFace(GL_BACK);              <span class="comment">// set for culling back faces</span>
<a name="l00980"></a>00980         glDisable(GL_CULL_FACE); 
<a name="l00981"></a>00981                 glDisable (GL_BLEND);
<a name="l00982"></a>00982 
<a name="l00983"></a>00983 }
<a name="l00984"></a>00984 <span class="comment"></span>
<a name="l00985"></a>00985 <span class="comment">/**</span>
<a name="l00986"></a>00986 <span class="comment">* @brief Renders OpenGL text of the integer number ID in distance radius from a point lied in (x,y,z). </span>
<a name="l00987"></a>00987 <span class="comment">* @param x Coordinate x.</span>
<a name="l00988"></a>00988 <span class="comment">* @param y Coordinate y.</span>
<a name="l00989"></a>00989 <span class="comment">* @param z Coordinate z.</span>
<a name="l00990"></a>00990 <span class="comment">* @param radius Distance form the point where the text will be printed at the right.</span>
<a name="l00991"></a>00991 <span class="comment">* @param ID Integer number which will be printed as a text.</span>
<a name="l00992"></a>00992 <span class="comment">*/</span>
<a name="l00993"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a198db840c47578a0a2bbc10f132ed9f7">00993</a> System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a198db840c47578a0a2bbc10f132ed9f7" title="Renders OpenGL text of the integer number ID in distance radius from a point lied in (x...">OpenGLForm::COpenGL::Render_IDText</a>(<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y, <span class="keywordtype">double</span> z, <span class="keywordtype">double</span> radius, <span class="keywordtype">int</span> ID)
<a name="l00994"></a>00994 {
<a name="l00995"></a>00995         <span class="comment">//Extract coordinates</span>
<a name="l00996"></a>00996         glPushMatrix();
<a name="l00997"></a>00997         glTranslatef((GLfloat)x,(GLfloat)y,     (GLfloat)z);
<a name="l00998"></a>00998         GLdouble modelview[16];                                                 <span class="comment">//var to hold the modelview info</span>
<a name="l00999"></a>00999         glGetDoublev(GL_MODELVIEW_MATRIX, modelview );  <span class="comment">//get the modelview info</span>
<a name="l01000"></a>01000         glPopMatrix();
<a name="l01001"></a>01001 
<a name="l01002"></a>01002 
<a name="l01003"></a>01003         glPushMatrix();                          <span class="comment">//save rotation</span>
<a name="l01004"></a>01004         glMatrixMode(GL_MODELVIEW);  <span class="comment">// reset to initial  reference frame</span>
<a name="l01005"></a>01005         glLoadIdentity();
<a name="l01006"></a>01006 
<a name="l01007"></a>01007         <span class="comment">//Disable Lighting and depth test</span>
<a name="l01008"></a>01008         glDisable(GL_DEPTH_TEST);
<a name="l01009"></a>01009         glDisable(GL_LIGHTING);
<a name="l01010"></a>01010         glColor3f(0.0f, 0.0f, 0.0f);
<a name="l01011"></a>01011 
<a name="l01012"></a>01012         <span class="comment">//Draw to world coordinates</span>
<a name="l01013"></a>01013         glRasterPos3f((GLfloat)(modelview[12]+radius),
<a name="l01014"></a>01014                                   (GLfloat)(modelview[13]+radius),
<a name="l01015"></a>01015                                   (GLfloat)(modelview[14]+radius));
<a name="l01016"></a>01016         
<a name="l01017"></a>01017         <span class="comment">//Set the font</span>
<a name="l01018"></a>01018         glListBase(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#abfca7bb825b247d0cae1266b7976d548" title="Fonts for OpenGL text.">nFontList</a>);
<a name="l01019"></a>01019 
<a name="l01020"></a>01020         <span class="comment">//Write in a buffer and then to OpenGL machinery</span>
<a name="l01021"></a>01021         <span class="keywordtype">char</span> buf[5];
<a name="l01022"></a>01022         sprintf_s(buf,<span class="stringliteral">&quot;%d&quot;</span>, ID);
<a name="l01023"></a>01023         <span class="keywordtype">string</span> num=(string)buf;
<a name="l01024"></a>01024         <span class="keywordflow">if</span>(ID&gt;9) glCallLists (2, GL_UNSIGNED_BYTE, &amp;buf);
<a name="l01025"></a>01025         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ID&gt;99) glCallLists (3, GL_UNSIGNED_BYTE, &amp;buf);
<a name="l01026"></a>01026         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ID&lt;=9) glCallLists (1, GL_UNSIGNED_BYTE, &amp;buf);
<a name="l01027"></a>01027 
<a name="l01028"></a>01028         <span class="comment">//Enable  Lighting and depth test</span>
<a name="l01029"></a>01029         glEnable(GL_LIGHTING);
<a name="l01030"></a>01030         glEnable(GL_DEPTH_TEST);
<a name="l01031"></a>01031         glPopMatrix();<span class="comment">// back to original orientation</span>
<a name="l01032"></a>01032 
<a name="l01033"></a>01033 
<a name="l01034"></a>01034 }
<a name="l01035"></a>01035 <span class="comment"></span>
<a name="l01036"></a>01036 <span class="comment">/**</span>
<a name="l01037"></a>01037 <span class="comment">* @brief Renders all atoms and compiles the selections ids for The OpenGL machinery. </span>
<a name="l01038"></a>01038 <span class="comment">*/</span>
<a name="l01039"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aaef092d833a02f8ffcccd33ec68565b8">01039</a> System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aaef092d833a02f8ffcccd33ec68565b8" title="Renders all atoms and compiles the selections ids for The OpenGL machinery.">OpenGLForm::COpenGL::Render_Atoms</a>(System::Void)
<a name="l01040"></a>01040 {
<a name="l01041"></a>01041         <span class="comment">//Enable culling</span>
<a name="l01042"></a>01042         glFrontFace(GL_CCW);              <span class="comment">// set CCW as fron face direction</span>
<a name="l01043"></a>01043         glPolygonMode(GL_FRONT, GL_FILL); <span class="comment">// set front face fill mode</span>
<a name="l01044"></a>01044         glPolygonMode(GL_BACK,  GL_LINE); <span class="comment">// set back face fill mode</span>
<a name="l01045"></a>01045         glCullFace(GL_BACK);              <span class="comment">// set for culling back faces</span>
<a name="l01046"></a>01046         glEnable(GL_CULL_FACE);           <span class="comment">// enable face culling</span>
<a name="l01047"></a>01047         glEnable (GL_BLEND);
<a name="l01048"></a>01048         glBlendFunc (GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
<a name="l01049"></a>01049 
<a name="l01050"></a>01050 
<a name="l01051"></a>01051 
<a name="l01052"></a>01052         <span class="keywordtype">float</span> red,green,blue,scaling; 
<a name="l01053"></a>01053         <span class="keywordtype">float</span> num=1.0f/300.f;                   <span class="comment">//scaling factor</span>
<a name="l01054"></a>01054 
<a name="l01055"></a>01055         <span class="comment">//Draw all atoms with color and prepare for selection</span>
<a name="l01056"></a>01056         <span class="keywordflow">for each</span>(<span class="keywordtype">int</span> i <span class="keywordflow">in</span> <a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;Keys)
<a name="l01057"></a>01057         {
<a name="l01058"></a>01058                 <span class="keywordflow">if</span> (((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;isotope-&gt;Element!=<span class="stringliteral">&quot;e&quot;</span>)
<a name="l01059"></a>01059                 {
<a name="l01060"></a>01060                         glPushMatrix();
<a name="l01061"></a>01061 
<a name="l01062"></a>01062                         <span class="comment">//Set the ID in OpenGL machinery for selection</span>
<a name="l01063"></a>01063                         glLoadName (i-1);
<a name="l01064"></a>01064                         <span class="comment">//The position of the atom</span>
<a name="l01065"></a>01065                         glTranslatef((GLfloat)((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;X,
<a name="l01066"></a>01066                                                  (GLfloat)((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;Y,
<a name="l01067"></a>01067                                                  (GLfloat)((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;Z);
<a name="l01068"></a>01068                                 
<a name="l01069"></a>01069                         <span class="comment">//Scaling with a num factor</span>
<a name="l01070"></a>01070                         scaling=num*((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;isotope-&gt;Radius;
<a name="l01071"></a>01071                         glScalef((GLfloat)scaling,(GLfloat)scaling,(GLfloat)scaling);
<a name="l01072"></a>01072 
<a name="l01073"></a>01073                         <span class="comment">//Color the atom</span>
<a name="l01074"></a>01074                         red=((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;isotope-&gt;Red;
<a name="l01075"></a>01075                         green=((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;isotope-&gt;Green;
<a name="l01076"></a>01076                         blue=((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>[i])-&gt;isotope-&gt;Blue;
<a name="l01077"></a>01077                         glColor3f(red,green,blue);
<a name="l01078"></a>01078 
<a name="l01079"></a>01079                         <span class="comment">//Draw</span>
<a name="l01080"></a>01080                         <span class="keywordflow">if</span> (<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ab71e341d370590f578bfb2b9156fb21a" title="Flag for using low resolution during rotation.">LowRes</a>) glCallList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a8c8b656575b35919a95692d6f22d2382" title="Sphere with low Resolution for Call list.">SphereLowRes</a>); <span class="keywordflow">else</span> glCallList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a368cb340baf71ed4692e561f0a692b18" title="Sphere with high Resolution for Call list.">SphereHighRes</a>);
<a name="l01081"></a>01081                         glPopMatrix();
<a name="l01082"></a>01082                 };
<a name="l01083"></a>01083         };
<a name="l01084"></a>01084 
<a name="l01085"></a>01085         <span class="comment">//Disable culling</span>
<a name="l01086"></a>01086         <span class="comment">//glEnable(GL_CULL_FACE);</span>
<a name="l01087"></a>01087         glPolygonMode(GL_FRONT, GL_FILL); <span class="comment">// set front face fill mode</span>
<a name="l01088"></a>01088         glPolygonMode(GL_BACK,  GL_FILL); <span class="comment">// set back face fill mode</span>
<a name="l01089"></a>01089         glCullFace(GL_BACK);              <span class="comment">// set for culling back faces</span>
<a name="l01090"></a>01090         glDisable(GL_CULL_FACE); 
<a name="l01091"></a>01091         glDisable (GL_BLEND);
<a name="l01092"></a>01092 }
<a name="l01093"></a>01093 <span class="comment"></span>
<a name="l01094"></a>01094 <span class="comment">/**</span>
<a name="l01095"></a>01095 <span class="comment">* @brief Render the transparent ellispoids of all atoms nuclei with the specified translucency</span>
<a name="l01096"></a>01096 <span class="comment">* @param factor A factor multiplied  with the alpha channel of the ellipsoids.</span>
<a name="l01097"></a>01097 <span class="comment">* @param check A flag for how to use facotr and alpha in fun function.</span>
<a name="l01098"></a>01098 <span class="comment">*/</span>
<a name="l01099"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6b334a904a14208066ba9619d9761069">01099</a> System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6b334a904a14208066ba9619d9761069" title="Render the transparent ellispoids of all atoms nuclei with the specified translucency.">OpenGLForm::COpenGL::Render_Transparency</a>(<span class="keywordtype">double</span> factor, <span class="keywordtype">bool</span> check)
<a name="l01100"></a>01100 {
<a name="l01101"></a>01101         <span class="comment">//Setup the minimum chemical bond, if zero put it sero</span>
<a name="l01102"></a>01102         <span class="keywordtype">double</span> validminCB=<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMin[InteractionKind::CBond]&gt; <a class="code" href="_open_g_l_8cpp.html#af637d148c7b4f533fe2b0ab4705ceb46">epsilo</a> &amp;&amp; 
<a name="l01103"></a>01103                               <a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMin[InteractionKind::CBond]&lt; <a class="code" href="_model_8h.html#a31749279d75cb3f5abada2931fffaf31">dMax</a> ? 
<a name="l01104"></a>01104                                           <a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMin[InteractionKind::CBond]: 1.0f;
<a name="l01105"></a>01105 
<a name="l01106"></a>01106         <span class="comment">//Calculate the factors of Chemical shifiting, Hyperfine and Quadrupolar according to</span>
<a name="l01107"></a>01107         <span class="comment">// the chemical bond minimum and their maxima.</span>
<a name="l01108"></a>01108         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a04e6a63da35e196269c38126042a18d0">CSfinfactor</a>= <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a655fb8e18d522e43daec2256cfee5937">CSfactor</a>*validminCB/(abs(<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMax[<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8eae4a1b28ecfe89d0bac93fee76b23ba68">InteractionKind::Shift</a>])&gt;
<a name="l01109"></a>01109                 <a class="code" href="_open_g_l_8cpp.html#af637d148c7b4f533fe2b0ab4705ceb46">epsilo</a> ?
<a name="l01110"></a>01110                 (<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMax[InteractionKind::Shift]) 
<a name="l01111"></a>01111                 : 1.0f);
<a name="l01112"></a>01112         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a0047160e57ccebb2b04b12babd6ed4ef">HCfinfactor</a>=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#afe34ce939edd9ed01b8df562629ab40b">HCfactor</a>*validminCB/(abs(<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMax[<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8eaa963e6070e2708404c83781a60a9e823">InteractionKind::HFC</a>])&gt;
<a name="l01113"></a>01113                 <a class="code" href="_open_g_l_8cpp.html#af637d148c7b4f533fe2b0ab4705ceb46">epsilo</a> ?
<a name="l01114"></a>01114                 (<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMax[InteractionKind::HFC]) 
<a name="l01115"></a>01115                 : 1.0f);
<a name="l01116"></a>01116         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a3a20612ea84b32eec09522c3b6588abe">QCfinfactor</a>= <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#af054791eff9432418c16d48cd8453023">QCfactor</a>*validminCB/(abs(<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMax[<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8eac17339440287fe2fd6774ac931c67eb7">InteractionKind::Quadrupolar</a>])&gt;
<a name="l01117"></a>01117                 <a class="code" href="_open_g_l_8cpp.html#af637d148c7b4f533fe2b0ab4705ceb46">epsilo</a> ?
<a name="l01118"></a>01118                 (<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMax[InteractionKind::Quadrupolar]) 
<a name="l01119"></a>01119                 : 1.0f);
<a name="l01120"></a>01120 
<a name="l01121"></a>01121         <span class="comment">//loop over all interaction to draw the interaction ellipsoids</span>
<a name="l01122"></a>01122         <span class="keywordflow">for each</span>(<span class="keywordtype">int</span> i <span class="keywordflow">in</span> <a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;Keys)
<a name="l01123"></a>01123                 {
<a name="l01124"></a>01124                 <span class="comment">//Check to draw the interactions in the selected atom or not</span>
<a name="l01125"></a>01125                 <span class="keywordflow">if</span>(!(((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;A-&gt;getID()==(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#af517cdc2e6b8e972e1297cb3281e8c15" title="ID of Selected Atom- zero indexed as coming from OpenGL machinery.">SelectedAtom</a>+1)) ||
<a name="l01126"></a>01126                    <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a0f9cb0f634625db9ac37118d7314a044" title="Flag for showing the interaction of the selected atom.">SelectedAtomsInteractionsFlag</a>)       
<a name="l01127"></a>01127                 {
<a name="l01128"></a>01128                         <span class="comment">//Drawing CS (Chemical shift) ellipsoids</span>
<a name="l01129"></a>01129                         <span class="keywordflow">if</span> (((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;IntKind==<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8eae4a1b28ecfe89d0bac93fee76b23ba68">InteractionKind::Shift</a> &amp;&amp; (<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#afa59a811285e41674e9f16ea7b6f77ba">CSFlag</a>))
<a name="l01130"></a>01130                                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a1395bfff5e5f8c5dbbbcf9587a99da1a" title="Render translucent ellispoid and eigen values axes.">Render_Atom_Properties</a>(((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;A-&gt;X,
<a name="l01131"></a>01131                                 ((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;A-&gt;Y,
<a name="l01132"></a>01132                                 ((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;A-&gt;Z,
<a name="l01133"></a>01133                                 ((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;dcm, 
<a name="l01134"></a>01134                                 ((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;eigen, 
<a name="l01135"></a>01135                                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a04e6a63da35e196269c38126042a18d0">CSfinfactor</a>, 
<a name="l01136"></a>01136                                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a5d9b97f6a464282954c7a4d858abb2b7">CScolor</a>, <a class="code" href="_open_g_l_8cpp.html#a3b1858e50e58ec0e37a32e4aa23347e4">fun</a>(0.4f,factor,check),
<a name="l01137"></a>01137                                 i);
<a name="l01138"></a>01138 
<a name="l01139"></a>01139                         <span class="comment">//Drawing HFC (Hyperfine) or AC (Anisotropic) ellipsoids</span>
<a name="l01140"></a>01140                         <span class="keywordflow">if</span> (((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;IntKind==<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8eaa963e6070e2708404c83781a60a9e823">InteractionKind::HFC</a> &amp;&amp; (<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a228adfdf34ef201300550f0f5467e446">HCFlag</a>))
<a name="l01141"></a>01141                                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a1395bfff5e5f8c5dbbbcf9587a99da1a" title="Render translucent ellispoid and eigen values axes.">Render_Atom_Properties</a>(((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;A-&gt;X,
<a name="l01142"></a>01142                                 ((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;A-&gt;Y,
<a name="l01143"></a>01143                                 ((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;A-&gt;Z,
<a name="l01144"></a>01144                                 ((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;dcm, 
<a name="l01145"></a>01145                                 ((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;eigen, 
<a name="l01146"></a>01146                                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a0047160e57ccebb2b04b12babd6ed4ef">HCfinfactor</a>,
<a name="l01147"></a>01147                                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a17fb59ac4d6ef32a53d0fecf2e7dc6cc">HCcolor</a>, <a class="code" href="_open_g_l_8cpp.html#a3b1858e50e58ec0e37a32e4aa23347e4">fun</a>(0.35f,factor,check),
<a name="l01148"></a>01148                                 i);
<a name="l01149"></a>01149 
<a name="l01150"></a>01150                         <span class="comment">//Drawing Zero-field ellipsoids</span>
<a name="l01151"></a>01151                         <span class="keywordflow">if</span> (((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;IntKind==<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8eac17339440287fe2fd6774ac931c67eb7">InteractionKind::Quadrupolar</a> &amp;&amp; (<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aa548f39ed75164d87e04034e809ec70e">QCFlag</a>))
<a name="l01152"></a>01152                                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a1395bfff5e5f8c5dbbbcf9587a99da1a" title="Render translucent ellispoid and eigen values axes.">Render_Atom_Properties</a>(((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;A-&gt;X,
<a name="l01153"></a>01153                                 ((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;A-&gt;Y,
<a name="l01154"></a>01154                                 ((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;A-&gt;Z,
<a name="l01155"></a>01155                                 ((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;dcm, 
<a name="l01156"></a>01156                                 ((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;eigen, 
<a name="l01157"></a>01157                                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a3a20612ea84b32eec09522c3b6588abe">QCfinfactor</a>,  
<a name="l01158"></a>01158                                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a2dbe60a3b6d57cbfa1b939b45a41870a">QCcolor</a>, <a class="code" href="_open_g_l_8cpp.html#a3b1858e50e58ec0e37a32e4aa23347e4">fun</a>(0.35f,factor,check),
<a name="l01159"></a>01159                                 i);
<a name="l01160"></a>01160                 };
<a name="l01161"></a>01161         
<a name="l01162"></a>01162                 };
<a name="l01163"></a>01163 
<a name="l01164"></a>01164 }
<a name="l01165"></a>01165 <span class="comment"></span>
<a name="l01166"></a>01166 <span class="comment">/**</span>
<a name="l01167"></a>01167 <span class="comment">* @brief Render translucent ellispoid and eigen values axes</span>
<a name="l01168"></a>01168 <span class="comment">* @param X Coordinate x.</span>
<a name="l01169"></a>01169 <span class="comment">* @param Y Coordinate y.</span>
<a name="l01170"></a>01170 <span class="comment">* @param Z Coordinate z.</span>
<a name="l01171"></a>01171 <span class="comment">* @param eigenvec Matrix with the eigenvectors(DCM).</span>
<a name="l01172"></a>01172 <span class="comment">* @param eigen Matrix with the eigenvalues.</span>
<a name="l01173"></a>01173 <span class="comment">* @param factor A factor multiplied  with the alpha channel of the ellipsoids.</span>
<a name="l01174"></a>01174 <span class="comment">* @param color Matrix with RGB color.</span>
<a name="l01175"></a>01175 <span class="comment">* @param alpha Alpha channel.</span>
<a name="l01176"></a>01176 <span class="comment">* @param ID ID of the atom to draw.</span>
<a name="l01177"></a>01177 <span class="comment">*/</span>
<a name="l01178"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a1395bfff5e5f8c5dbbbcf9587a99da1a">01178</a> System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a1395bfff5e5f8c5dbbbcf9587a99da1a" title="Render translucent ellispoid and eigen values axes.">OpenGLForm::COpenGL::Render_Atom_Properties</a>(<span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, 
<a name="l01179"></a>01179                                                                                                                  ObservableCollection&lt;double&gt;^ eigenvec, 
<a name="l01180"></a>01180                                                              ObservableCollection&lt;double&gt;^ eigen,  
<a name="l01181"></a>01181                                                                                                                  <span class="keywordtype">double</span> factor, 
<a name="l01182"></a>01182                                                                                                                  <span class="keywordtype">double</span> *color, 
<a name="l01183"></a>01183                                                                                                                  <span class="keywordtype">double</span> alpha, 
<a name="l01184"></a>01184                                                                                                                  <span class="keywordtype">int</span> ID)
<a name="l01185"></a>01185 {
<a name="l01186"></a>01186         <span class="keywordtype">float</span> TransformMatrix[16];
<a name="l01187"></a>01187 
<a name="l01188"></a>01188         <span class="comment">//Draw Axes of reference frame  </span>
<a name="l01189"></a>01189         glPushMatrix();
<a name="l01190"></a>01190         <span class="keywordtype">float</span> scalesize=0.75;
<a name="l01191"></a>01191         <span class="comment">//Draw when the flag is true and when an interation is selected</span>
<a name="l01192"></a>01192         <span class="keywordflow">if</span>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a44b9634d3a01e26c244d965f1eb9a0f1" title="Flag for showing current reference frame axis of interaction.">ReferenceFrameAxesFlag</a> &amp;&amp;
<a name="l01193"></a>01193                 ((<a class="code" href="class_spinach_g_u_i_1_1_main_form.html" title="Summary for MainForm.">SpinachGUI::MainForm</a>^)<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a904cf12aa0803e2da3a727cdb68392c4" title="Related to MainForm of Application.">mainForm</a>)-&gt;dataGridView2-&gt;SelectedRows-&gt;Count&gt;0 &amp;&amp;
<a name="l01194"></a>01194                 Convert::ToInt32(((<a class="code" href="class_spinach_g_u_i_1_1_main_form.html" title="Summary for MainForm.">SpinachGUI::MainForm</a>^)mainForm)-&gt;dataGridView2-&gt;SelectedRows[0]-&gt;Cells[0]-&gt;Value)==ID)
<a name="l01195"></a>01195         {
<a name="l01196"></a>01196                 glDepthMask(GL_TRUE);
<a name="l01197"></a>01197                 <span class="keywordtype">float</span> tX=0, tY=0, tZ=0;
<a name="l01198"></a>01198                 <span class="comment">//Position in the same point as ellispoid</span>
<a name="l01199"></a>01199                 glTranslatef((GLfloat)X, (GLfloat)Y,(GLfloat)Z);
<a name="l01200"></a>01200 
<a name="l01201"></a>01201            <span class="comment">//Rotation according to eigen vector of the reference frame</span>
<a name="l01202"></a>01202            TransformMatrix[0]=(GLfloat)((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[ID])-&gt;Frame-&gt;matrix3x3[0];
<a name="l01203"></a>01203            TransformMatrix[1]=(GLfloat)((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[ID])-&gt;Frame-&gt;matrix3x3[1];
<a name="l01204"></a>01204            TransformMatrix[2]=(GLfloat)((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[ID])-&gt;Frame-&gt;matrix3x3[2];
<a name="l01205"></a>01205            TransformMatrix[3]=(GLfloat)0.0;
<a name="l01206"></a>01206 
<a name="l01207"></a>01207            TransformMatrix[4]=(GLfloat)((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[ID])-&gt;Frame-&gt;matrix3x3[3];
<a name="l01208"></a>01208            TransformMatrix[5]=(GLfloat)((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[ID])-&gt;Frame-&gt;matrix3x3[4];
<a name="l01209"></a>01209            TransformMatrix[6]=(GLfloat)((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[ID])-&gt;Frame-&gt;matrix3x3[5];
<a name="l01210"></a>01210            TransformMatrix[7]=(GLfloat)0.0;
<a name="l01211"></a>01211 
<a name="l01212"></a>01212            TransformMatrix[8]=(GLfloat)((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[ID])-&gt;Frame-&gt;matrix3x3[6];
<a name="l01213"></a>01213            TransformMatrix[9]=(GLfloat)((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[ID])-&gt;Frame-&gt;matrix3x3[7];
<a name="l01214"></a>01214            TransformMatrix[10]=(GLfloat)((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[ID])-&gt;Frame-&gt;matrix3x3[8];
<a name="l01215"></a>01215            TransformMatrix[11]=(GLfloat)0.0;
<a name="l01216"></a>01216         
<a name="l01217"></a>01217            TransformMatrix[12]=TransformMatrix[13]=TransformMatrix[14]=0.0;TransformMatrix[15]=(GLfloat)1.0;
<a name="l01218"></a>01218            glMultMatrixf(TransformMatrix);
<a name="l01219"></a>01219 
<a name="l01220"></a>01220                 <span class="comment">// DRAW WORLD ORIGIN AXIS</span>
<a name="l01221"></a>01221                 glShadeModel(GL_SMOOTH);
<a name="l01222"></a>01222 
<a name="l01223"></a>01223                 <span class="comment">//X-Axis</span>
<a name="l01224"></a>01224                 glPushMatrix();
<a name="l01225"></a>01225                 glColor3f(0.0,1.0,0.0);
<a name="l01226"></a>01226                 glTranslated((GLfloat)tX, (GLfloat)tY,(GLfloat)tZ);
<a name="l01227"></a>01227                 glRotated(-90, 1,0,0);
<a name="l01228"></a>01228                 glScalef(scalesize,scalesize,scalesize);
<a name="l01229"></a>01229                 glTranslated(0,0,1);
<a name="l01230"></a>01230                 gluCylinder(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,0.05,0.0001,0.1,20,20);    <span class="comment">//Head of Arrow</span>
<a name="l01231"></a>01231                 glTranslated(0,0,-1);
<a name="l01232"></a>01232                 gluCylinder(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,0.03,0.03,1.0,20,20);  <span class="comment">//Axis</span>
<a name="l01233"></a>01233                 glPopMatrix();
<a name="l01234"></a>01234 
<a name="l01235"></a>01235                 <span class="comment">//Y-Axis</span>
<a name="l01236"></a>01236                 glPushMatrix();
<a name="l01237"></a>01237                 glColor3f(0.0,0.0,1.0);
<a name="l01238"></a>01238                 glTranslated((GLfloat)tX, (GLfloat)tY,(GLfloat)tZ);
<a name="l01239"></a>01239                 glRotated(90,0 ,0,1);
<a name="l01240"></a>01240                 glScalef(scalesize,scalesize,scalesize);
<a name="l01241"></a>01241                 glTranslated(0,0,1);
<a name="l01242"></a>01242                 gluCylinder(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,0.05,0.0001,0.1,20,20);  <span class="comment">//Axis</span>
<a name="l01243"></a>01243                 glTranslated(0,0,-1);
<a name="l01244"></a>01244                 gluCylinder(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,0.03,0.03,1.0,20,20);  <span class="comment">//Head of Arrow</span>
<a name="l01245"></a>01245                 glPopMatrix();
<a name="l01246"></a>01246 
<a name="l01247"></a>01247                 <span class="comment">//Z-Axis</span>
<a name="l01248"></a>01248                 glPushMatrix();
<a name="l01249"></a>01249                 glTranslated((GLfloat)tX, (GLfloat)tY,(GLfloat)tZ);
<a name="l01250"></a>01250                 glColor3f(1.0,0.0,0.0);
<a name="l01251"></a>01251                 glRotated(90, 0,1,0);
<a name="l01252"></a>01252                 glScalef(scalesize,scalesize,scalesize);
<a name="l01253"></a>01253                 glTranslated(0,0,1);
<a name="l01254"></a>01254                 gluCylinder(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,0.05,0.0001,0.1,20,20);  <span class="comment">//Axis</span>
<a name="l01255"></a>01255                 glTranslated(0,0,-1);
<a name="l01256"></a>01256                 gluCylinder(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,0.03,0.03,1.0,20,20);  <span class="comment">//Head of Arrow</span>
<a name="l01257"></a>01257                 glPopMatrix();
<a name="l01258"></a>01258                 glDepthMask(GL_FALSE);
<a name="l01259"></a>01259 
<a name="l01260"></a>01260 
<a name="l01261"></a>01261         };
<a name="l01262"></a>01262         glPopMatrix();
<a name="l01263"></a>01263 
<a name="l01264"></a>01264 
<a name="l01265"></a>01265         <span class="comment">//Draw interaction</span>
<a name="l01266"></a>01266         glPushMatrix();
<a name="l01267"></a>01267         glTranslatef((GLfloat)X, (GLfloat)Y,(GLfloat)Z);
<a name="l01268"></a>01268         
<a name="l01269"></a>01269         <span class="comment">//In order to draw when bigger than the atom</span>
<a name="l01270"></a>01270         <span class="keywordtype">float</span> show=0.0033*((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[ID])-&gt;A-&gt;isotope-&gt;Radius; 
<a name="l01271"></a>01271         <span class="keywordflow">if</span>(factor*abs(eigen[0])&gt;show ||  factor*abs(eigen[1])&gt;show ||  factor*abs(eigen[2])&gt;show)
<a name="l01272"></a>01272           {
<a name="l01273"></a>01273       <span class="comment">//Rotation according to eigen vector</span>
<a name="l01274"></a>01274           TransformMatrix[0]=(GLfloat)eigenvec[0];TransformMatrix[1]=(GLfloat)eigenvec[1];
<a name="l01275"></a>01275           TransformMatrix[2]=(GLfloat)eigenvec[2]; TransformMatrix[3]=(GLfloat)0.0;
<a name="l01276"></a>01276 
<a name="l01277"></a>01277           TransformMatrix[4]=(GLfloat)eigenvec[3];TransformMatrix[5]=(GLfloat)eigenvec[4];
<a name="l01278"></a>01278           TransformMatrix[6]=(GLfloat)eigenvec[5];TransformMatrix[7]=(GLfloat)0.0;
<a name="l01279"></a>01279 
<a name="l01280"></a>01280           TransformMatrix[8]=(GLfloat)eigenvec[6];TransformMatrix[9]=(GLfloat)eigenvec[7];
<a name="l01281"></a>01281           TransformMatrix[10]=(GLfloat)eigenvec[8];TransformMatrix[11]=(GLfloat)0.0;
<a name="l01282"></a>01282         
<a name="l01283"></a>01283           TransformMatrix[12]=TransformMatrix[13]=TransformMatrix[14]=0.0;TransformMatrix[15]=(GLfloat)1.0;
<a name="l01284"></a>01284           glMultMatrixf(TransformMatrix);
<a name="l01285"></a>01285           
<a name="l01286"></a>01286           <span class="comment">//Drawing of eigen values lines</span>
<a name="l01287"></a>01287           <span class="keywordflow">if</span>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#af7ffeb4b7690dfecb95daab57165b9c0" title="Flag for showing interaction axes.">EigenAxesFlag</a>)
<a name="l01288"></a>01288           {
<a name="l01289"></a>01289           <span class="comment">//Color red for positive eigenvalue and blue for negative eigenvalue</span>
<a name="l01290"></a>01290           <span class="keywordflow">if</span>(eigen[0]&lt;=0)  glColor3f(0.0f,0.0f,1.0f); <span class="keywordflow">else</span> glColor3f(1.0f,0.0f,0.0f);
<a name="l01291"></a>01291           glPushMatrix();
<a name="l01292"></a>01292           glRotated(90,0,1,0);
<a name="l01293"></a>01293           glTranslatef(0.0f,0.0f,-factor*abs(eigen[0]));
<a name="l01294"></a>01294           glScalef(1.0f,1.0f,2.0*factor*abs(eigen[0]));
<a name="l01295"></a>01295           glCallList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aeb7fd954835139436d3d236eb1faae3f" title="Cylinder with high Resolution for Call list.">CylinderHighRes</a>);
<a name="l01296"></a>01296           glPopMatrix();
<a name="l01297"></a>01297 
<a name="l01298"></a>01298           <span class="comment">//Color red for positive eigenvalue and blue for negative eigenvalue</span>
<a name="l01299"></a>01299           <span class="keywordflow">if</span>(eigen[1]&lt;=0)  glColor3f(0.0f,0.0f,1.0f); <span class="keywordflow">else</span> glColor3f(1.0f,0.0f,0.0f);
<a name="l01300"></a>01300           glPushMatrix();
<a name="l01301"></a>01301           glRotated(-90,1,0,0);
<a name="l01302"></a>01302           glTranslatef(0.0f,0.0f,-factor*abs(eigen[1]));
<a name="l01303"></a>01303           glScalef(1.0f,1.0f,2.0*factor*abs(eigen[1]));
<a name="l01304"></a>01304           glCallList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aeb7fd954835139436d3d236eb1faae3f" title="Cylinder with high Resolution for Call list.">CylinderHighRes</a>);
<a name="l01305"></a>01305           glPopMatrix();
<a name="l01306"></a>01306 
<a name="l01307"></a>01307           <span class="comment">//Color red for positive eigenvalue and blue for negative eigenvalue</span>
<a name="l01308"></a>01308           <span class="keywordflow">if</span>(eigen[2]&lt;=0)  glColor3f(0.0f,0.0f,1.0f); <span class="keywordflow">else</span> glColor3f(1.0f,0.0f,0.0f);
<a name="l01309"></a>01309           glPushMatrix();
<a name="l01310"></a>01310           glRotated(90,0,0,1);
<a name="l01311"></a>01311           glTranslatef(0.0f,0.0f,-factor*abs(eigen[2]));
<a name="l01312"></a>01312           glScalef(1.0f,1.0f,2.0*factor*abs(eigen[2]));
<a name="l01313"></a>01313           glCallList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aeb7fd954835139436d3d236eb1faae3f" title="Cylinder with high Resolution for Call list.">CylinderHighRes</a>);
<a name="l01314"></a>01314           glPopMatrix();
<a name="l01315"></a>01315           }
<a name="l01316"></a>01316 
<a name="l01317"></a>01317 
<a name="l01318"></a>01318           <span class="comment">//Drawing of eigen values ellispoid</span>
<a name="l01319"></a>01319           <span class="keywordflow">if</span>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ac4a2747b4541ead35bf992447bedeec9" title="Flag for showing interaction ellipsoids.">EigenEllipsoidsFlag</a>)
<a name="l01320"></a>01320           {
<a name="l01321"></a>01321           glPushMatrix();
<a name="l01322"></a>01322           glScaled(factor*abs(eigen[0]),  factor*abs(eigen[1]),   factor*abs(eigen[2])); 
<a name="l01323"></a>01323 
<a name="l01324"></a>01324           <span class="comment">//Setting up the material and coloring of the ellipsoids</span>
<a name="l01325"></a>01325           GLfloat material[4];
<a name="l01326"></a>01326       material[0] =(GLfloat)color[0]; material[1] =(GLfloat)color[1];
<a name="l01327"></a>01327           material[2] =(GLfloat)color[2]; material[3]=  0.7f;
<a name="l01328"></a>01328           GLfloat white[4]={0.8f,0.8f,0.8f,0.0f};
<a name="l01329"></a>01329           glMaterialfv(GL_FRONT, GL_SPECULAR, white);
<a name="l01330"></a>01330       glMaterialfv(GL_FRONT, GL_AMBIENT_AND_DIFFUSE, material);
<a name="l01331"></a>01331 
<a name="l01332"></a>01332           <span class="comment">//Drawing of wire</span>
<a name="l01333"></a>01333           glColor4f((GLfloat)color[0],(GLfloat)color[1],(GLfloat)color[2],(GLfloat)(alpha+0.1f));
<a name="l01334"></a>01334           glCallList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a34348d047f8c3f1be810d93183983481" title="Wired Sphere with low Resolution for Call list.">WiredSphereHighRes</a>);
<a name="l01335"></a>01335 
<a name="l01336"></a>01336       <span class="comment">//Drawing of solid ellispoid</span>
<a name="l01337"></a>01337           glColor4f((GLfloat)color[0],(GLfloat)color[1],(GLfloat)(color[2]+0.1f),(GLfloat)alpha);
<a name="l01338"></a>01338           glCallList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7deebfbc439113126d7980a6a5231560" title="Selected Sphere with high Resolution for Call list.">SelectedSphereHighRes</a>);
<a name="l01339"></a>01339           glPopMatrix();
<a name="l01340"></a>01340           };
<a name="l01341"></a>01341 
<a name="l01342"></a>01342           };
<a name="l01343"></a>01343 
<a name="l01344"></a>01344         glPopMatrix();
<a name="l01345"></a>01345 
<a name="l01346"></a>01346         
<a name="l01347"></a>01347 }
<a name="l01348"></a>01348 <span class="comment"></span>
<a name="l01349"></a>01349 <span class="comment">/**</span>
<a name="l01350"></a>01350 <span class="comment">* @brief Render bonds and j-couplings</span>
<a name="l01351"></a>01351 <span class="comment">*/</span>
<a name="l01352"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a20ad2d00c74c32564330da4b870b327e">01352</a> System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a20ad2d00c74c32564330da4b870b327e" title="Render bonds and j-couplings.">OpenGLForm::COpenGL::Render_Bonds</a>(System::Void)
<a name="l01353"></a>01353 {
<a name="l01354"></a>01354  <span class="keywordtype">double</span> RADDEG = 57.29578;
<a name="l01355"></a>01355 
<a name="l01356"></a>01356   <span class="comment">//Factor for bonds</span>
<a name="l01357"></a>01357  <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ae47a6e56f51e049425e77348cf087b5a" title="Final multiplication factor for the size of ellipsoids.">CBfinfactor</a>=2.0*(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a8235a35f4031b6695623c3cfe403f73e" title="Multiplication factor for the size of ellipsoids.">CBfactor</a>-0.5)*(<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMax[InteractionKind::CBond]-1.6f)+1.6f;
<a name="l01358"></a>01358 
<a name="l01359"></a>01359  <span class="comment">//Factor for J-couplings</span>
<a name="l01360"></a>01360  <span class="keywordtype">double</span> absMax=(abs(<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMax[<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8eada7dd200d6a013dee8d3ce94d259065f">InteractionKind::Jcoupling</a>])&lt;
<a name="l01361"></a>01361          abs(<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMin[<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8eada7dd200d6a013dee8d3ce94d259065f">InteractionKind::Jcoupling</a>]))*
<a name="l01362"></a>01362          abs(<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMin[<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8eada7dd200d6a013dee8d3ce94d259065f">InteractionKind::Jcoupling</a>])+
<a name="l01363"></a>01363          (abs(<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMax[<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8eada7dd200d6a013dee8d3ce94d259065f">InteractionKind::Jcoupling</a>])&gt;
<a name="l01364"></a>01364          abs(<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMin[<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8eada7dd200d6a013dee8d3ce94d259065f">InteractionKind::Jcoupling</a>]))*
<a name="l01365"></a>01365          abs(<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMax[<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8eada7dd200d6a013dee8d3ce94d259065f">InteractionKind::Jcoupling</a>]);
<a name="l01366"></a>01366 
<a name="l01367"></a>01367  <span class="comment">//Not perfect but good enough</span>
<a name="l01368"></a>01368  <span class="comment">//if min&lt;0 and max&gt;0 then absmin=0;</span>
<a name="l01369"></a>01369  <span class="keywordtype">double</span> absMin=(1-<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMax[InteractionKind::Jcoupling]&gt;0 &amp;&amp;
<a name="l01370"></a>01370          <a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMin[InteractionKind::Jcoupling]&lt;0)*
<a name="l01371"></a>01371          ((abs(<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMax[<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8eada7dd200d6a013dee8d3ce94d259065f">InteractionKind::Jcoupling</a>])&gt;
<a name="l01372"></a>01372          abs(<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMin[<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8eada7dd200d6a013dee8d3ce94d259065f">InteractionKind::Jcoupling</a>]))*
<a name="l01373"></a>01373          abs(<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMin[<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8eada7dd200d6a013dee8d3ce94d259065f">InteractionKind::Jcoupling</a>])+
<a name="l01374"></a>01374          (abs(<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMax[<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8eada7dd200d6a013dee8d3ce94d259065f">InteractionKind::Jcoupling</a>])&lt;
<a name="l01375"></a>01375          abs(<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMin[<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8eada7dd200d6a013dee8d3ce94d259065f">InteractionKind::Jcoupling</a>]))*
<a name="l01376"></a>01376          abs(<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMax[<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8eada7dd200d6a013dee8d3ce94d259065f">InteractionKind::Jcoupling</a>]));
<a name="l01377"></a>01377 
<a name="l01378"></a>01378  <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6011b3b97869f450965a777171762ae4">JCfinfactor</a>= <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a1782f41a5c8ffb35aa6704dfb68d9f21">JCfactor</a>*absMax;
<a name="l01379"></a>01379 
<a name="l01380"></a>01380  <span class="comment">//Loop over all the interactions to draw bond like interactions</span>
<a name="l01381"></a>01381  <span class="keywordflow">for each</span>(<span class="keywordtype">int</span> i <span class="keywordflow">in</span> <a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;Keys)
<a name="l01382"></a>01382  {
<a name="l01383"></a>01383          <span class="comment">//Chemical bonds represented as cylinder without bases</span>
<a name="l01384"></a>01384          <span class="keywordflow">if</span>(((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;IntKind==<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8ea1203807f6d26bc8df1724b77efbcf351">InteractionKind::CBond</a> &amp;&amp; <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7fd00e0dce38f247c53b463fb332a364" title="Flags for showing kind of interactions.">CBFlag</a>)
<a name="l01385"></a>01385          {
<a name="l01386"></a>01386                  <span class="comment">//Calculate the distance</span>
<a name="l01387"></a>01387                  <span class="keywordtype">double</span> distance=((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;matrix3x3[0];
<a name="l01388"></a>01388                  
<a name="l01389"></a>01389                  <span class="comment">//For bonds only smaller from the factor of the trackbar</span>
<a name="l01390"></a>01390                  <span class="keywordflow">if</span>((distance-<a class="code" href="_open_g_l_8cpp.html#af637d148c7b4f533fe2b0ab4705ceb46">epsilo</a>)&lt;=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ae47a6e56f51e049425e77348cf087b5a" title="Final multiplication factor for the size of ellipsoids.">CBfinfactor</a>)
<a name="l01391"></a>01391                  {
<a name="l01392"></a>01392                          glPushMatrix();
<a name="l01393"></a>01393                          <a class="code" href="class_atom.html">Atom</a>^ A=((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;A;
<a name="l01394"></a>01394                          <a class="code" href="class_atom.html">Atom</a>^ B=((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;B;
<a name="l01395"></a>01395 
<a name="l01396"></a>01396                          <span class="comment">//Origin of the bond</span>
<a name="l01397"></a>01397                          glTranslatef((GLfloat)A-&gt;<a class="code" href="class_atom.html#a9adaaa1c67caa251c7c3f9b5753cfced" title="Property x coordinate position of the atom.">X</a>,(GLfloat)A-&gt;<a class="code" href="class_atom.html#ad121a01910fb0f6511a963de4d89460d" title="Property y coordinate position of the atom.">Y</a>,(GLfloat)A-&gt;<a class="code" href="class_atom.html#aa0c17b25aa4c710115c74b173c756a9b" title="Property z coordinate position of the atom.">Z</a>);
<a name="l01398"></a>01398 
<a name="l01399"></a>01399                          <span class="comment">//Orientation</span>
<a name="l01400"></a>01400                          <span class="keywordtype">double</span> az = atan2 ((B-&gt;<a class="code" href="class_atom.html#ad121a01910fb0f6511a963de4d89460d" title="Property y coordinate position of the atom.">Y</a>-A-&gt;<a class="code" href="class_atom.html#ad121a01910fb0f6511a963de4d89460d" title="Property y coordinate position of the atom.">Y</a>), (B-&gt;<a class="code" href="class_atom.html#a9adaaa1c67caa251c7c3f9b5753cfced" title="Property x coordinate position of the atom.">X</a>-A-&gt;<a class="code" href="class_atom.html#a9adaaa1c67caa251c7c3f9b5753cfced" title="Property x coordinate position of the atom.">X</a>)) * RADDEG;
<a name="l01401"></a>01401                          <span class="keywordtype">double</span> el = asin  ((B-&gt;<a class="code" href="class_atom.html#aa0c17b25aa4c710115c74b173c756a9b" title="Property z coordinate position of the atom.">Z</a>-A-&gt;<a class="code" href="class_atom.html#aa0c17b25aa4c710115c74b173c756a9b" title="Property z coordinate position of the atom.">Z</a>) / distance) * RADDEG;
<a name="l01402"></a>01402                          glRotated ( az, 0,0,1);
<a name="l01403"></a>01403                          glRotated (-el, 0,1,0);
<a name="l01404"></a>01404                          glRotatef ( 90, 0,1,0);
<a name="l01405"></a>01405 
<a name="l01406"></a>01406                          <span class="comment">//Coloring</span>
<a name="l01407"></a>01407                          glColor3f((GLfloat)<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a80217ae357b897a5bae6d1821bb68f56">CBcolor</a>[0],(GLfloat)CBcolor[1], (GLfloat)CBcolor[2]);
<a name="l01408"></a>01408 
<a name="l01409"></a>01409                          <span class="comment">//If bond is hydrogen bond(between this elements) draw from small spheres</span>
<a name="l01410"></a>01410                          <span class="keywordflow">if</span>(((A-&gt;<a class="code" href="class_atom.html#a14a6785b5d26d50fe23d617c95b2585d" title="Property isotope of the atom.">isotope</a>-&gt;<a class="code" href="class_isotope.html#ae44f2dfdec36f8d7934ac152b7deefd6" title="Name of element.">Element</a>==<span class="stringliteral">&quot;O&quot;</span> || A-&gt;<a class="code" href="class_atom.html#a14a6785b5d26d50fe23d617c95b2585d" title="Property isotope of the atom.">isotope</a>-&gt;<a class="code" href="class_isotope.html#ae44f2dfdec36f8d7934ac152b7deefd6" title="Name of element.">Element</a>==<span class="stringliteral">&quot;F&quot;</span> || A-&gt;<a class="code" href="class_atom.html#a14a6785b5d26d50fe23d617c95b2585d" title="Property isotope of the atom.">isotope</a>-&gt;<a class="code" href="class_isotope.html#ae44f2dfdec36f8d7934ac152b7deefd6" title="Name of element.">Element</a>==<span class="stringliteral">&quot;N&quot;</span>) &amp;&amp;
<a name="l01411"></a>01411                                  B-&gt;<a class="code" href="class_atom.html#a14a6785b5d26d50fe23d617c95b2585d" title="Property isotope of the atom.">isotope</a>-&gt;<a class="code" href="class_isotope.html#ae44f2dfdec36f8d7934ac152b7deefd6" title="Name of element.">Element</a>==<span class="stringliteral">&quot;H&quot;</span>) ||
<a name="l01412"></a>01412                                  ((B-&gt;<a class="code" href="class_atom.html#a14a6785b5d26d50fe23d617c95b2585d" title="Property isotope of the atom.">isotope</a>-&gt;<a class="code" href="class_isotope.html#ae44f2dfdec36f8d7934ac152b7deefd6" title="Name of element.">Element</a>==<span class="stringliteral">&quot;O&quot;</span> || B-&gt;<a class="code" href="class_atom.html#a14a6785b5d26d50fe23d617c95b2585d" title="Property isotope of the atom.">isotope</a>-&gt;<a class="code" href="class_isotope.html#ae44f2dfdec36f8d7934ac152b7deefd6" title="Name of element.">Element</a>==<span class="stringliteral">&quot;F&quot;</span> || B-&gt;<a class="code" href="class_atom.html#a14a6785b5d26d50fe23d617c95b2585d" title="Property isotope of the atom.">isotope</a>-&gt;<a class="code" href="class_isotope.html#ae44f2dfdec36f8d7934ac152b7deefd6" title="Name of element.">Element</a>==<span class="stringliteral">&quot;N&quot;</span>) &amp;&amp;
<a name="l01413"></a>01413                                  A-&gt;<a class="code" href="class_atom.html#a14a6785b5d26d50fe23d617c95b2585d" title="Property isotope of the atom.">isotope</a>-&gt;<a class="code" href="class_isotope.html#ae44f2dfdec36f8d7934ac152b7deefd6" title="Name of element.">Element</a>==<span class="stringliteral">&quot;H&quot;</span>) )
<a name="l01414"></a>01414                          {
<a name="l01415"></a>01415                                  <span class="comment">//Spheres only for distances bigger than 1.2f</span>
<a name="l01416"></a>01416                                  <span class="keywordflow">if</span>((distance-<a class="code" href="_open_g_l_8cpp.html#af637d148c7b4f533fe2b0ab4705ceb46">epsilo</a>)&gt;=1.2f &amp;&amp; (distance-<a class="code" href="_open_g_l_8cpp.html#af637d148c7b4f533fe2b0ab4705ceb46">epsilo</a>)&lt;=2.5f)
<a name="l01417"></a>01417                                          <span class="keywordflow">for</span>(<span class="keywordtype">float</span> j=0.0;j&lt;distance;j+=0.075f)
<a name="l01418"></a>01418                                          {
<a name="l01419"></a>01419                                                  glPushMatrix();
<a name="l01420"></a>01420                                                  glTranslatef((GLfloat)0.0f,(GLfloat)0.0f, (GLfloat)j);
<a name="l01421"></a>01421                                                  glScalef((GLfloat)0.035,(GLfloat)0.035, (GLfloat)0.035);
<a name="l01422"></a>01422                                                  <span class="keywordflow">if</span>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ab71e341d370590f578bfb2b9156fb21a" title="Flag for using low resolution during rotation.">LowRes</a>) glCallList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a8c8b656575b35919a95692d6f22d2382" title="Sphere with low Resolution for Call list.">SphereLowRes</a>); <span class="keywordflow">else</span> glCallList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a368cb340baf71ed4692e561f0a692b18" title="Sphere with high Resolution for Call list.">SphereHighRes</a>);
<a name="l01423"></a>01423                                                  glPopMatrix();
<a name="l01424"></a>01424                                          }
<a name="l01425"></a>01425                                  <span class="keywordflow">else</span> <span class="keywordflow">if</span>((distance-<a class="code" href="_open_g_l_8cpp.html#af637d148c7b4f533fe2b0ab4705ceb46">epsilo</a>)&lt;1.2f)
<a name="l01426"></a>01426                                  {
<a name="l01427"></a>01427                                          glScalef(1.0,1.0, distance);
<a name="l01428"></a>01428                                          <span class="keywordflow">if</span>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ab71e341d370590f578bfb2b9156fb21a" title="Flag for using low resolution during rotation.">LowRes</a>) glCallList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a58b1f3c4ddcabb1ecad737d1b0ec8ee4" title="Cylinder with low Resolution for Call list.">CylinderLowRes</a>); <span class="keywordflow">else</span> glCallList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aeb7fd954835139436d3d236eb1faae3f" title="Cylinder with high Resolution for Call list.">CylinderHighRes</a>);
<a name="l01429"></a>01429                                  }
<a name="l01430"></a>01430                          }
<a name="l01431"></a>01431                          <span class="keywordflow">else</span>
<a name="l01432"></a>01432                          {
<a name="l01433"></a>01433                                  glScalef(1.0,1.0, distance);
<a name="l01434"></a>01434                                  <span class="keywordflow">if</span>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ab71e341d370590f578bfb2b9156fb21a" title="Flag for using low resolution during rotation.">LowRes</a>) glCallList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a58b1f3c4ddcabb1ecad737d1b0ec8ee4" title="Cylinder with low Resolution for Call list.">CylinderLowRes</a>); <span class="keywordflow">else</span> glCallList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aeb7fd954835139436d3d236eb1faae3f" title="Cylinder with high Resolution for Call list.">CylinderHighRes</a>);
<a name="l01435"></a>01435                          }
<a name="l01436"></a>01436 
<a name="l01437"></a>01437                          glPopMatrix();
<a name="l01438"></a>01438                  };
<a name="l01439"></a>01439          };
<a name="l01440"></a>01440 
<a name="l01441"></a>01441    <span class="comment">//J-couplings are represented as dashed cylinder with bases</span>
<a name="l01442"></a>01442          <span class="keywordflow">if</span>(((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;IntKind==<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8eada7dd200d6a013dee8d3ce94d259065f">InteractionKind::Jcoupling</a> &amp;&amp; <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a38fcd62b067631ddbf9a246de902a60d">JCFlag</a>)
<a name="l01443"></a>01443          {
<a name="l01444"></a>01444                  <span class="comment">//For j-couplings only larger from the factor of the trackbar</span>
<a name="l01445"></a>01445                  <span class="keywordflow">if</span>(abs(((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;matrix3x3[0])&gt;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6011b3b97869f450965a777171762ae4">JCfinfactor</a>) 
<a name="l01446"></a>01446                  {
<a name="l01447"></a>01447                          glPushMatrix();
<a name="l01448"></a>01448                          <a class="code" href="class_atom.html">Atom</a>^ A=((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;A;
<a name="l01449"></a>01449                          <a class="code" href="class_atom.html">Atom</a>^ B=((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;B;
<a name="l01450"></a>01450                          <span class="keywordtype">double</span> distance=sqrt((A-&gt;<a class="code" href="class_atom.html#a9adaaa1c67caa251c7c3f9b5753cfced" title="Property x coordinate position of the atom.">X</a>-B-&gt;<a class="code" href="class_atom.html#a9adaaa1c67caa251c7c3f9b5753cfced" title="Property x coordinate position of the atom.">X</a>)*(A-&gt;<a class="code" href="class_atom.html#a9adaaa1c67caa251c7c3f9b5753cfced" title="Property x coordinate position of the atom.">X</a>-B-&gt;<a class="code" href="class_atom.html#a9adaaa1c67caa251c7c3f9b5753cfced" title="Property x coordinate position of the atom.">X</a>)+(A-&gt;<a class="code" href="class_atom.html#ad121a01910fb0f6511a963de4d89460d" title="Property y coordinate position of the atom.">Y</a>-B-&gt;<a class="code" href="class_atom.html#ad121a01910fb0f6511a963de4d89460d" title="Property y coordinate position of the atom.">Y</a>)*(A-&gt;<a class="code" href="class_atom.html#ad121a01910fb0f6511a963de4d89460d" title="Property y coordinate position of the atom.">Y</a>-B-&gt;<a class="code" href="class_atom.html#ad121a01910fb0f6511a963de4d89460d" title="Property y coordinate position of the atom.">Y</a>)+(A-&gt;<a class="code" href="class_atom.html#aa0c17b25aa4c710115c74b173c756a9b" title="Property z coordinate position of the atom.">Z</a>-B-&gt;<a class="code" href="class_atom.html#aa0c17b25aa4c710115c74b173c756a9b" title="Property z coordinate position of the atom.">Z</a>)*(A-&gt;<a class="code" href="class_atom.html#aa0c17b25aa4c710115c74b173c756a9b" title="Property z coordinate position of the atom.">Z</a>-B-&gt;<a class="code" href="class_atom.html#aa0c17b25aa4c710115c74b173c756a9b" title="Property z coordinate position of the atom.">Z</a>));
<a name="l01451"></a>01451 
<a name="l01452"></a>01452                          <span class="comment">//Origin of the bond</span>
<a name="l01453"></a>01453                          glTranslatef((GLfloat)A-&gt;<a class="code" href="class_atom.html#a9adaaa1c67caa251c7c3f9b5753cfced" title="Property x coordinate position of the atom.">X</a>,(GLfloat)A-&gt;<a class="code" href="class_atom.html#ad121a01910fb0f6511a963de4d89460d" title="Property y coordinate position of the atom.">Y</a>,(GLfloat)A-&gt;<a class="code" href="class_atom.html#aa0c17b25aa4c710115c74b173c756a9b" title="Property z coordinate position of the atom.">Z</a>);
<a name="l01454"></a>01454 
<a name="l01455"></a>01455                          <span class="comment">//Orientation</span>
<a name="l01456"></a>01456                          <span class="keywordtype">double</span> az = atan2 ((B-&gt;<a class="code" href="class_atom.html#ad121a01910fb0f6511a963de4d89460d" title="Property y coordinate position of the atom.">Y</a>-A-&gt;<a class="code" href="class_atom.html#ad121a01910fb0f6511a963de4d89460d" title="Property y coordinate position of the atom.">Y</a>), (B-&gt;<a class="code" href="class_atom.html#a9adaaa1c67caa251c7c3f9b5753cfced" title="Property x coordinate position of the atom.">X</a>-A-&gt;<a class="code" href="class_atom.html#a9adaaa1c67caa251c7c3f9b5753cfced" title="Property x coordinate position of the atom.">X</a>)) * RADDEG;
<a name="l01457"></a>01457                          <span class="keywordtype">double</span> el = asin  ((B-&gt;<a class="code" href="class_atom.html#aa0c17b25aa4c710115c74b173c756a9b" title="Property z coordinate position of the atom.">Z</a>-A-&gt;<a class="code" href="class_atom.html#aa0c17b25aa4c710115c74b173c756a9b" title="Property z coordinate position of the atom.">Z</a>) / distance) * RADDEG;
<a name="l01458"></a>01458                          glRotated ( az, 0,0,1);
<a name="l01459"></a>01459                          glRotated (-el, 0,1,0);
<a name="l01460"></a>01460                          glRotatef ( 90, 0,1,0);
<a name="l01461"></a>01461 
<a name="l01462"></a>01462                          <span class="comment">//Factor for Coloring</span>
<a name="l01463"></a>01463                          <span class="keywordtype">double</span> magn=(abs(((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;matrix3x3[0])-absMin)/(absMax-absMin);
<a name="l01464"></a>01464                          glColor3f((GLfloat)(magn*<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a068b18861200cc701d3ad19e0424ee59" title="RGB Matrices for the color of interaction kind.">JCcolor</a>[3]+(1.0-magn)*<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a068b18861200cc701d3ad19e0424ee59" title="RGB Matrices for the color of interaction kind.">JCcolor</a>[0]),
<a name="l01465"></a>01465                                            (GLfloat)(magn*JCcolor[4]+(1.0-magn)*JCcolor[1]),
<a name="l01466"></a>01466                                            (GLfloat)(magn*JCcolor[5]+(1.0-magn)*JCcolor[2]));
<a name="l01467"></a>01467 
<a name="l01468"></a>01468                          <span class="comment">//Draw the dashed cylinders</span>
<a name="l01469"></a>01469                          <span class="keywordflow">for</span>(<span class="keywordtype">float</span> j=0.0;j&lt;distance;j+=0.2f)
<a name="l01470"></a>01470                          {
<a name="l01471"></a>01471                                  glPushMatrix();
<a name="l01472"></a>01472                                  glTranslatef((GLfloat)0.0f,(GLfloat)0.0f, (GLfloat)j);
<a name="l01473"></a>01473                                  <span class="keywordflow">if</span>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ab71e341d370590f578bfb2b9156fb21a" title="Flag for using low resolution during rotation.">LowRes</a>) glCallList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a35476e4bb57870e9301c2ed1e37e8fd5" title="Cylinder with bases with low Resolution for Call list.">FullCylinderLowRes</a>); <span class="keywordflow">else</span> glCallList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aab3df0cf966ad05fc94eb69385c9daa0" title="Cylinder with bases with high Resolution for Call list.">FullCylinderHighRes</a>);
<a name="l01474"></a>01474                                  glPopMatrix();
<a name="l01475"></a>01475 
<a name="l01476"></a>01476                          };
<a name="l01477"></a>01477 
<a name="l01478"></a>01478                          glPopMatrix();
<a name="l01479"></a>01479                  };
<a name="l01480"></a>01480          };
<a name="l01481"></a>01481  };
<a name="l01482"></a>01482 
<a name="l01483"></a>01483 }
<a name="l01484"></a>01484 <span class="preprocessor">#pragma endregion</span>
<a name="l01485"></a>01485 <span class="preprocessor"></span><span class="comment"></span>
<a name="l01486"></a>01486 <span class="comment">/////Render electron cloud plane//////////</span>
<a name="l01487"></a>01487 <span class="comment"></span><span class="preprocessor">#pragma region Render electron cloud plane</span>
<a name="l01488"></a>01488 <span class="preprocessor"></span><span class="comment">/**</span>
<a name="l01489"></a>01489 <span class="comment">* @brief Render electron cloud plane. Usually a verysmall number of electron are drawn,</span>
<a name="l01490"></a>01490 <span class="comment">* so not so much optimization is needed</span>
<a name="l01491"></a>01491 <span class="comment">*/</span>
<a name="l01492"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6f98dd2f1244759dd296c0afe49552f6">01492</a> System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6f98dd2f1244759dd296c0afe49552f6" title="Render electron cloud plane. Usually a verysmall number of electron are drawn, so not so much optimiz...">OpenGLForm::COpenGL::Render_Electrons</a>()
<a name="l01493"></a>01493 {       
<a name="l01494"></a>01494          <span class="keywordtype">double</span> RADDEG = 57.29578;
<a name="l01495"></a>01495 
<a name="l01496"></a>01496         <span class="comment">//Render Floor </span>
<a name="l01497"></a>01497     <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a8599ba4db2c35ea771a17a2657a29692" title="Render a plane with name &amp;quot;electrons&amp;quot; in z and y coordinates.">Render_Floor</a>(-15, 1);
<a name="l01498"></a>01498 
<a name="l01499"></a>01499         <span class="comment">//Set Clip Pane</span>
<a name="l01500"></a>01500         glColor4f(1, 1, 1, 0.05f);
<a name="l01501"></a>01501         glEnable(GL_STENCIL_TEST);      <span class="comment">//Enable using the stencil buffer</span>
<a name="l01502"></a>01502         glColorMask(0, 0, 0, 0);        <span class="comment">//Disable drawing colors to the screen</span>
<a name="l01503"></a>01503         glDepthMask(<span class="keyword">false</span>); 
<a name="l01504"></a>01504         glDisable(GL_DEPTH_TEST);       <span class="comment">//Disable depth testing</span>
<a name="l01505"></a>01505 
<a name="l01506"></a>01506 
<a name="l01507"></a>01507         glStencilOp(GL_REPLACE, GL_REPLACE, GL_REPLACE);
<a name="l01508"></a>01508         glStencilFunc(GL_ALWAYS, 1, 0xffffffff);
<a name="l01509"></a>01509 
<a name="l01510"></a>01510         glDepthMask(<span class="keyword">true</span>); 
<a name="l01511"></a>01511         glColorMask(1, 1, 1, 1); <span class="comment">//Enable drawing colors to the screen</span>
<a name="l01512"></a>01512         glEnable(GL_DEPTH_TEST); <span class="comment">//Enable depth testing</span>
<a name="l01513"></a>01513         <span class="comment">//Make the stencil test pass only when the pixel is 1 in the stencil buffer</span>
<a name="l01514"></a>01514         glStencilFunc(GL_EQUAL, 1, 1);
<a name="l01515"></a>01515         glStencilOp(GL_KEEP, GL_KEEP, GL_KEEP); <span class="comment">//Make the stencil buffer not change</span>
<a name="l01516"></a>01516 
<a name="l01517"></a>01517         <span class="keywordtype">double</span> eqr[] = {0.0f,-1.0f, 0.0f, -18.0f};  
<a name="l01518"></a>01518         glEnable(GL_CLIP_PLANE0);                       <span class="comment">// Enable Clip Plane For Removing Artifacts</span>
<a name="l01519"></a>01519         <span class="comment">// (When The Object Crosses The Floor)</span>
<a name="l01520"></a>01520         glClipPlane(GL_CLIP_PLANE0, eqr);               <span class="comment">// Equation For Reflected Objects</span>
<a name="l01521"></a>01521 
<a name="l01522"></a>01522         
<a name="l01523"></a>01523         <span class="comment">//Matrices for Electrons</span>
<a name="l01524"></a>01524         ArrayList^ ElectronIndex=<span class="keyword">gcnew</span> ArrayList();
<a name="l01525"></a>01525         ArrayList^ Xcoord=<span class="keyword">gcnew</span> ArrayList();
<a name="l01526"></a>01526         ArrayList^ Ycoord=<span class="keyword">gcnew</span> ArrayList();
<a name="l01527"></a>01527         ArrayList^ Zcoord=<span class="keyword">gcnew</span> ArrayList();
<a name="l01528"></a>01528         ArrayList^ index=<span class="keyword">gcnew</span> ArrayList();
<a name="l01529"></a>01529 
<a name="l01530"></a>01530         <span class="comment">//Find electron and IDs of electron and seve in a array</span>
<a name="l01531"></a>01531         <span class="keywordflow">for each</span>(<span class="keywordtype">int</span> ii <span class="keywordflow">in</span> <a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;Keys)
<a name="l01532"></a>01532         { 
<a name="l01533"></a>01533                 <span class="keywordflow">if</span>(((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a9cd907838c4fbe6b254818e17e7bf8f8" title="Current system model.">SystemModel</a>-&gt;<a class="code" href="class_model.html#a477773d6666e62796fc46fc2bfaaf650" title="The collection of atoms in the model.">AtomCollection</a>[ii])-&gt;isotope-&gt;Element==<span class="stringliteral">&quot;e&quot;</span>) 
<a name="l01534"></a>01534                 {
<a name="l01535"></a>01535                         ElectronIndex-&gt;Add(((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a9cd907838c4fbe6b254818e17e7bf8f8" title="Current system model.">SystemModel</a>-&gt;<a class="code" href="class_model.html#a477773d6666e62796fc46fc2bfaaf650" title="The collection of atoms in the model.">AtomCollection</a>[ii]));
<a name="l01536"></a>01536                         index-&gt;Add(((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a9cd907838c4fbe6b254818e17e7bf8f8" title="Current system model.">SystemModel</a>-&gt;<a class="code" href="class_model.html#a477773d6666e62796fc46fc2bfaaf650" title="The collection of atoms in the model.">AtomCollection</a>[ii])-&gt;ID);
<a name="l01537"></a>01537                 }
<a name="l01538"></a>01538         };
<a name="l01539"></a>01539 
<a name="l01540"></a>01540         <span class="comment">//Calculate coordinates of electron. These are calculated according to: 2-in line, </span>
<a name="l01541"></a>01541         <span class="comment">// 3-in triangle, &gt;4-in quad</span>
<a name="l01542"></a>01542         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ii=0;ii&lt;ElectronIndex-&gt;Count;ii++)
<a name="l01543"></a>01543         {
<a name="l01544"></a>01544 
<a name="l01545"></a>01545                 Xcoord-&gt;Add(-7.0f*!((ElectronIndex-&gt;Count)%2 &amp;&amp;(ElectronIndex-&gt;Count-1==ii))+14.0f*(ii%2));
<a name="l01546"></a>01546                 Ycoord-&gt;Add(-25.0f);
<a name="l01547"></a>01547                 Zcoord-&gt;Add(-80.0f-10.0f*((ElectronIndex-&gt;Count-1)/2)+20.0f*(ii/2));
<a name="l01548"></a>01548         };
<a name="l01549"></a>01549         
<a name="l01550"></a>01550         <span class="comment">//Loop over all electrons</span>
<a name="l01551"></a>01551         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ii=0;ii&lt;ElectronIndex-&gt;Count;ii++)
<a name="l01552"></a>01552         {
<a name="l01553"></a>01553                 
<a name="l01554"></a>01554                 glPushMatrix();
<a name="l01555"></a>01555                 glTranslated(Convert::ToDouble(Xcoord[ii]),
<a name="l01556"></a>01556                                          Convert::ToDouble(Ycoord[ii]),
<a name="l01557"></a>01557                                          Convert::ToDouble(Zcoord[ii]));
<a name="l01558"></a>01558 <span class="comment"></span>
<a name="l01559"></a>01559 <span class="comment">                ///////////////////////////////////////</span>
<a name="l01560"></a>01560 <span class="comment"></span>                <span class="comment">//Draw the exchange couplings without any rotation on them</span>
<a name="l01561"></a>01561 
<a name="l01562"></a>01562                 glDisable(GL_LIGHTING);
<a name="l01563"></a>01563 
<a name="l01564"></a>01564                 <span class="comment">//Calcalate max for exchange coupling</span>
<a name="l01565"></a>01565                 <span class="keywordtype">double</span> absMax=(abs(<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMax[<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8ea89fe455d57ae52cfe608090a0ffe2979">InteractionKind::Exchange</a>])&lt;
<a name="l01566"></a>01566                         abs(<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMin[<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8ea89fe455d57ae52cfe608090a0ffe2979">InteractionKind::Exchange</a>]))*
<a name="l01567"></a>01567                         abs(<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMin[<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8ea89fe455d57ae52cfe608090a0ffe2979">InteractionKind::Exchange</a>])+
<a name="l01568"></a>01568                         (abs(<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMax[<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8ea89fe455d57ae52cfe608090a0ffe2979">InteractionKind::Exchange</a>])&gt;
<a name="l01569"></a>01569                         abs(<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMin[<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8ea89fe455d57ae52cfe608090a0ffe2979">InteractionKind::Exchange</a>]))*
<a name="l01570"></a>01570                         abs(<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMax[<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8ea89fe455d57ae52cfe608090a0ffe2979">InteractionKind::Exchange</a>]);
<a name="l01571"></a>01571                 
<a name="l01572"></a>01572                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ab48bf5d8d6d434cb7989d0b43a1764c0">ECfinfactor</a>= <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a9c0396e7c649b1fc08390be9d045c20f">ECfactor</a>*absMax;
<a name="l01573"></a>01573 
<a name="l01574"></a>01574                 <span class="comment">//Loop over all interaction to draw Exchange couplings</span>
<a name="l01575"></a>01575                 <span class="keywordflow">for each</span>(<span class="keywordtype">int</span> jj <span class="keywordflow">in</span> <a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;Keys)
<a name="l01576"></a>01576                 {
<a name="l01577"></a>01577                         <span class="comment">//Draw exchange coupling</span>
<a name="l01578"></a>01578                         <span class="keywordflow">if</span>(((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[jj])-&gt;IntKind==<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8ea89fe455d57ae52cfe608090a0ffe2979">InteractionKind::Exchange</a> &amp;&amp; <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aa88a55e4dc4b4150121add8c84bda00d">ECFlag</a> &amp;&amp;
<a name="l01579"></a>01579                                 ((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[jj])-&gt;A==((<a class="code" href="class_atom.html">Atom</a>^)ElectronIndex[ii]))
<a name="l01580"></a>01580                         {
<a name="l01581"></a>01581                                 <span class="comment">//Coordinates of the first electron</span>
<a name="l01582"></a>01582                                 <span class="keywordtype">double</span> AX=Convert::ToDouble(Xcoord[ii]);
<a name="l01583"></a>01583                             <span class="keywordtype">double</span> AY=Convert::ToDouble(Ycoord[ii]);
<a name="l01584"></a>01584                                 <span class="keywordtype">double</span> AZ=Convert::ToDouble(Zcoord[ii]);
<a name="l01585"></a>01585 
<a name="l01586"></a>01586                                 <span class="comment">//Find the coordinates of the second electron </span>
<a name="l01587"></a>01587                                 <span class="keywordtype">int</span> kk;
<a name="l01588"></a>01588                                 <span class="keywordtype">int</span> test=((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[jj])-&gt;B-&gt;ID;
<a name="l01589"></a>01589                                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0;k&lt;ElectronIndex-&gt;Count;k++) 
<a name="l01590"></a>01590                                 {
<a name="l01591"></a>01591                                         <span class="keywordflow">if</span>(Convert::ToInt32(index[k])==((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[jj])-&gt;B-&gt;ID)
<a name="l01592"></a>01592                                         {
<a name="l01593"></a>01593                                                 kk=k;
<a name="l01594"></a>01594                                         }
<a name="l01595"></a>01595                                 }
<a name="l01596"></a>01596                                 <span class="keywordtype">double</span> BX=Convert::ToDouble(Xcoord[kk]);
<a name="l01597"></a>01597                                 <span class="keywordtype">double</span> BY=Convert::ToDouble(Ycoord[kk]);
<a name="l01598"></a>01598                                 <span class="keywordtype">double</span> BZ=Convert::ToDouble(Zcoord[kk]);
<a name="l01599"></a>01599 
<a name="l01600"></a>01600 
<a name="l01601"></a>01601                                 glPushMatrix();
<a name="l01602"></a>01602                                 <a class="code" href="class_atom.html">Atom</a>^ A=((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[jj])-&gt;A;
<a name="l01603"></a>01603                                 <a class="code" href="class_atom.html">Atom</a>^ B=((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[jj])-&gt;B;
<a name="l01604"></a>01604                                 <span class="comment">//Calculate distance </span>
<a name="l01605"></a>01605                                 <span class="keywordtype">double</span> distance=sqrt((AX-BX)*(AX-BX)+(AY-BY)*(AY-BY)+(AZ-BZ)*(AZ-BZ));
<a name="l01606"></a>01606                                 <span class="keywordflow">if</span> (distance&lt;0.000001) distance=1.0;
<a name="l01607"></a>01607 
<a name="l01608"></a>01608                                 <span class="comment">//Origin of the bond</span>
<a name="l01609"></a>01609                                 glTranslatef((GLfloat)A-&gt;<a class="code" href="class_atom.html#a9adaaa1c67caa251c7c3f9b5753cfced" title="Property x coordinate position of the atom.">X</a>,(GLfloat)A-&gt;<a class="code" href="class_atom.html#ad121a01910fb0f6511a963de4d89460d" title="Property y coordinate position of the atom.">Y</a>,(GLfloat)A-&gt;<a class="code" href="class_atom.html#aa0c17b25aa4c710115c74b173c756a9b" title="Property z coordinate position of the atom.">Z</a>);
<a name="l01610"></a>01610 
<a name="l01611"></a>01611                                 <span class="comment">//Orientation</span>
<a name="l01612"></a>01612                                 <span class="keywordtype">double</span> az = atan2 ((BY-AY), (BX-AX)) * RADDEG;
<a name="l01613"></a>01613                                 <span class="keywordtype">double</span> el = asin  ((BZ-AZ) / distance) * RADDEG;
<a name="l01614"></a>01614                                 glRotated ( az, 0,0,1);
<a name="l01615"></a>01615                                 glRotated (-el, 0,1,0);
<a name="l01616"></a>01616                                 glRotatef ( 90, 0,1,0);
<a name="l01617"></a>01617 
<a name="l01618"></a>01618                                 <span class="comment">//Factor for Coloring</span>
<a name="l01619"></a>01619                                 <span class="keywordtype">double</span> magn=(((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[jj])-&gt;matrix3x3[0]-
<a name="l01620"></a>01620                                         <a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMin[InteractionKind::Exchange])/(
<a name="l01621"></a>01621                                         <a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMax[<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8ea89fe455d57ae52cfe608090a0ffe2979">InteractionKind::Exchange</a>]-
<a name="l01622"></a>01622                                         <a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMin[<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8ea89fe455d57ae52cfe608090a0ffe2979">InteractionKind::Exchange</a>]);
<a name="l01623"></a>01623                                 glColor3f((GLfloat)(magn*<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ae225fe838d6e93271a0f14604d0f74c5">ECcolor</a>[3]+(1.0-magn)*<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ae225fe838d6e93271a0f14604d0f74c5">ECcolor</a>[0]),
<a name="l01624"></a>01624                                                   (GLfloat)(magn*ECcolor[4]+(1.0-magn)*ECcolor[1]),
<a name="l01625"></a>01625                                                   (GLfloat)(magn*ECcolor[5]+(1.0-magn)*ECcolor[2]));
<a name="l01626"></a>01626 
<a name="l01627"></a>01627                                 <span class="comment">//Draw the spring if bigger than the exchange coupling factor of trackbar</span>
<a name="l01628"></a>01628                                 <span class="keywordflow">if</span>(abs(((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[jj])-&gt;matrix3x3[0])&gt;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ab48bf5d8d6d434cb7989d0b43a1764c0">ECfinfactor</a>)
<a name="l01629"></a>01629                                 {
<a name="l01630"></a>01630                                         glLineWidth((GLfloat)4.0);
<a name="l01631"></a>01631 
<a name="l01632"></a>01632                                         <span class="comment">//Draw a spring</span>
<a name="l01633"></a>01633                                         glBegin(GL_LINE_STRIP);
<a name="l01634"></a>01634                                         <span class="keywordtype">int</span> steps=100;
<a name="l01635"></a>01635                                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;steps;i++)
<a name="l01636"></a>01636                                         glVertex3f((GLfloat)(0.8*cos(i*distance/(steps/5))),
<a name="l01637"></a>01637                                                            (GLfloat)(0.8*sin(i*distance/(steps/5))),
<a name="l01638"></a>01638                                                            (GLfloat)(i*distance/steps));
<a name="l01639"></a>01639 
<a name="l01640"></a>01640                                         
<a name="l01641"></a>01641                                         glEnd();
<a name="l01642"></a>01642 
<a name="l01643"></a>01643                                         <span class="comment">// Back to default</span>
<a name="l01644"></a>01644                                         glLineWidth((GLfloat)1.0);
<a name="l01645"></a>01645                                 };
<a name="l01646"></a>01646 
<a name="l01647"></a>01647                                 glPopMatrix();
<a name="l01648"></a>01648                         }
<a name="l01649"></a>01649 
<a name="l01650"></a>01650                 }
<a name="l01651"></a>01651 
<a name="l01652"></a>01652                 glEnable(GL_LIGHTING);
<a name="l01653"></a>01653 <span class="comment"></span>
<a name="l01654"></a>01654 <span class="comment">                /////////////////////////////////////</span>
<a name="l01655"></a>01655 <span class="comment"></span>                <span class="comment">//Draw the rest thing rotating them</span>
<a name="l01656"></a>01656                 glMultMatrixf(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a700170133b4fb855f3e86cd187d0d6a6" title="Current matrix for transformation used for migration to OpenGL format.">TransformMat</a>);
<a name="l01657"></a>01657                 glColor3f(0.7f,0.5f,0.7f);
<a name="l01658"></a>01658 
<a name="l01659"></a>01659                 <span class="comment">//Draw metaballs/electron</span>
<a name="l01660"></a>01660                 glPushMatrix();
<a name="l01661"></a>01661                 glTranslated(0.40f,-0.6f,-0.3f); <span class="comment">//For centering Metaball</span>
<a name="l01662"></a>01662                 glScaled(0.4,0.4,0.4);
<a name="l01663"></a>01663                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a5afbd1374f5c155cf0b59fa898c8dfbb" title="Final Render and orientation of a metaball.">Render_MetaBalls</a>();     
<a name="l01664"></a>01664                 glPopMatrix();
<a name="l01665"></a>01665 
<a name="l01666"></a>01666                 <span class="comment">//Render electron ID</span>
<a name="l01667"></a>01667                 <span class="keywordflow">if</span>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aea9bc7ab4d1f1cb9f91b2fa4fd9d7d28" title="Flag for showing ID of all atoms.">AtomIDFlag</a>)  <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a198db840c47578a0a2bbc10f132ed9f7" title="Renders OpenGL text of the integer number ID in distance radius from a point lied in (x...">Render_IDText</a>(0.0, 0.0, 0.0,2.0f, ((<a class="code" href="class_atom.html">Atom</a>^)ElectronIndex[ii])-&gt;getID());
<a name="l01668"></a>01668 
<a name="l01669"></a>01669                 <span class="comment">//Draw interactions elllipsoids of electrons</span>
<a name="l01670"></a>01670                 glBlendFunc (GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
<a name="l01671"></a>01671                 glEnable (GL_BLEND);
<a name="l01672"></a>01672                 glDepthMask(GL_FALSE);
<a name="l01673"></a>01673                 
<a name="l01674"></a>01674                 <span class="comment">//Calculate the factors for g-tensor and zero-field</span>
<a name="l01675"></a>01675                 <span class="keywordtype">double</span> validminCB=3.0f; <span class="comment">//standard</span>
<a name="l01676"></a>01676                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a8a1d695004e7cc224820f663e6f726cb">GTfinfactor</a>= <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a022a3a713d0801b7427cabca634a3ec3">GTfactor</a>*validminCB/(abs(<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMax[<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8ea002c54e14f8b8cc5a33e76e39d67a6a0">InteractionKind::GTensor</a>])&gt;
<a name="l01677"></a>01677                         <a class="code" href="_open_g_l_8cpp.html#af637d148c7b4f533fe2b0ab4705ceb46">epsilo</a> ?
<a name="l01678"></a>01678                         (<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMax[InteractionKind::GTensor]) 
<a name="l01679"></a>01679                         : 1.0f);
<a name="l01680"></a>01680                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#acbc31c0451fb3299ce01f9b730456d19" title="Final multiplication factor for the size of ellipsoids.">ZFfinfactor</a>= <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a1e7566b011cd74b57ad1f52d4dc0b09e" title="Multiplication factor for the size of ellipsoids.">ZFfactor</a>*validminCB/(abs(<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMax[<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8ea26da56330c608adf3b3477986a12735f">InteractionKind::ZFS</a>])&gt;
<a name="l01681"></a>01681                         <a class="code" href="_open_g_l_8cpp.html#af637d148c7b4f533fe2b0ab4705ceb46">epsilo</a> ?
<a name="l01682"></a>01682                         (<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;InterKindMax[InteractionKind::ZFS]) 
<a name="l01683"></a>01683                         : 1.0f);
<a name="l01684"></a>01684 
<a name="l01685"></a>01685                 <span class="comment">//Loop over interactions to find g-tensors and zero-fields</span>
<a name="l01686"></a>01686                 <span class="keywordflow">for each</span>(<span class="keywordtype">int</span> jj <span class="keywordflow">in</span> <a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;Keys)
<a name="l01687"></a>01687                 {
<a name="l01688"></a>01688                         <span class="keywordflow">if</span> (((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[jj])-&gt;IntKind==<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8ea002c54e14f8b8cc5a33e76e39d67a6a0">InteractionKind::GTensor</a> &amp;&amp; <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a13624261209264386df1cde404b1ed6e">GTFlag</a> &amp;&amp;
<a name="l01689"></a>01689                                 ((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[jj])-&gt;A==((<a class="code" href="class_atom.html">Atom</a>^)ElectronIndex[ii]))
<a name="l01690"></a>01690                                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a1395bfff5e5f8c5dbbbcf9587a99da1a" title="Render translucent ellispoid and eigen values axes.">Render_Atom_Properties</a>(0.0, 0.0, 0.0,
<a name="l01691"></a>01691                                 ((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[jj])-&gt;dcm, 
<a name="l01692"></a>01692                                 ((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[jj])-&gt;eigen, 
<a name="l01693"></a>01693                                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a8a1d695004e7cc224820f663e6f726cb">GTfinfactor</a>, <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#af51a221898a9ac610830c56110ededfd">GTcolor</a>, 0.6f, jj);
<a name="l01694"></a>01694 
<a name="l01695"></a>01695                         <span class="keywordflow">if</span> (((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[jj])-&gt;IntKind==<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8ea26da56330c608adf3b3477986a12735f">InteractionKind::ZFS</a> &amp;&amp; <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a5d940879e95fc2974a27fb24d55bce89" title="Flags for showing kind of interactions.">ZFFlag</a> &amp;&amp;
<a name="l01696"></a>01696                                 ((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[jj])-&gt;A==((<a class="code" href="class_atom.html">Atom</a>^)ElectronIndex[ii]))
<a name="l01697"></a>01697                                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a1395bfff5e5f8c5dbbbcf9587a99da1a" title="Render translucent ellispoid and eigen values axes.">Render_Atom_Properties</a>(0.0, 0.0, 0.0,
<a name="l01698"></a>01698                                 ((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[jj])-&gt;dcm, 
<a name="l01699"></a>01699                                 ((<a class="code" href="class_tensor.html">Tensor</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[jj])-&gt;eigen, 
<a name="l01700"></a>01700                                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#acbc31c0451fb3299ce01f9b730456d19" title="Final multiplication factor for the size of ellipsoids.">ZFfinfactor</a>, <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a00dd073770344c298e61f4bc233346f0" title="RGB Matrices for the color of interaction kind.">ZFcolor</a>, 0.6f, jj);
<a name="l01701"></a>01701                 }
<a name="l01702"></a>01702 
<a name="l01703"></a>01703                 glPopMatrix();
<a name="l01704"></a>01704 
<a name="l01705"></a>01705                 glDepthMask(GL_TRUE);
<a name="l01706"></a>01706         };
<a name="l01707"></a>01707         
<a name="l01708"></a>01708         <span class="comment">//Deactivate finally the clip pane</span>
<a name="l01709"></a>01709         GLfloat white[4]={0.8f,0.8f,0.8f,0.0f};
<a name="l01710"></a>01710         glMaterialfv(GL_FRONT, GL_SPECULAR, white);
<a name="l01711"></a>01711         glDisable(GL_STENCIL_TEST); <span class="comment">//Disable using the stencil buffer</span>
<a name="l01712"></a>01712         glDisable(GL_CLIP_PLANE0);  
<a name="l01713"></a>01713 
<a name="l01714"></a>01714         
<a name="l01715"></a>01715 
<a name="l01716"></a>01716         
<a name="l01717"></a>01717 
<a name="l01718"></a>01718 }
<a name="l01719"></a>01719 <span class="comment"></span>
<a name="l01720"></a>01720 <span class="comment">/**</span>
<a name="l01721"></a>01721 <span class="comment">* @brief Render a plane with name &quot;electrons&quot; in z and y coordinates</span>
<a name="l01722"></a>01722 <span class="comment">* @param y Coordinate y.</span>
<a name="l01723"></a>01723 <span class="comment">* @param z Coordinate z.</span>
<a name="l01724"></a>01724 <span class="comment">*/</span>
<a name="l01725"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a8599ba4db2c35ea771a17a2657a29692">01725</a> System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a8599ba4db2c35ea771a17a2657a29692" title="Render a plane with name &amp;quot;electrons&amp;quot; in z and y coordinates.">OpenGLForm::COpenGL::Render_Floor</a>(<span class="keywordtype">int</span> z ,<span class="keywordtype">int</span> y)
<a name="l01726"></a>01726 {
<a name="l01727"></a>01727 
<a name="l01728"></a>01728         <span class="comment">//Blend the floor onto the screen</span>
<a name="l01729"></a>01729         glDisable(GL_DEPTH_TEST);
<a name="l01730"></a>01730         glEnable (GL_BLEND);
<a name="l01731"></a>01731         glBlendFunc (GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
<a name="l01732"></a>01732         glColor4f(0, 0, 0, 0.85f);
<a name="l01733"></a>01733 
<a name="l01734"></a>01734         glPushMatrix();
<a name="l01735"></a>01735         <span class="keywordtype">int</span> FLOOR_SIZE=200; <span class="comment">//size of the plane</span>
<a name="l01736"></a>01736         glBegin(GL_QUADS);
<a name="l01737"></a>01737         glNormal3d(0, 0, 1);
<a name="l01738"></a>01738         glVertex3d(-y*FLOOR_SIZE / 2, z, y*FLOOR_SIZE / 2);
<a name="l01739"></a>01739         glVertex3d(-y*FLOOR_SIZE / 2, z, -y*FLOOR_SIZE / 2);
<a name="l01740"></a>01740         glVertex3d(y*FLOOR_SIZE / 2, z, -y*FLOOR_SIZE / 2);
<a name="l01741"></a>01741         glVertex3d(y*FLOOR_SIZE / 2, z, y*FLOOR_SIZE / 2);
<a name="l01742"></a>01742         glEnd();
<a name="l01743"></a>01743         glPopMatrix();
<a name="l01744"></a>01744 
<a name="l01745"></a>01745         glDisable (GL_BLEND);
<a name="l01746"></a>01746         glEnable(GL_DEPTH_TEST);
<a name="l01747"></a>01747 
<a name="l01748"></a>01748         <span class="comment">//Render &quot;electrons&quot; name///////////////////////////////////////////////////</span>
<a name="l01749"></a>01749         glMatrixMode(GL_PROJECTION);
<a name="l01750"></a>01750         glPushMatrix();
<a name="l01751"></a>01751         glLoadIdentity();
<a name="l01752"></a>01752         gluOrtho2D(0.0, (GLfloat)mWidth, 0.0,(GLfloat)<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc3d9b1f8036a70a3312fabf2337805" title="Width and Height of the OpenGL Window.">mHeight</a>);
<a name="l01753"></a>01753         glMatrixMode(GL_MODELVIEW);
<a name="l01754"></a>01754         glPushMatrix();
<a name="l01755"></a>01755         glLoadIdentity();
<a name="l01756"></a>01756         
<a name="l01757"></a>01757         glListBase(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#abfca7bb825b247d0cae1266b7976d548" title="Fonts for OpenGL text.">nFontList</a>);
<a name="l01758"></a>01758         glDisable(GL_DEPTH_TEST);
<a name="l01759"></a>01759         glDisable(GL_LIGHTING);
<a name="l01760"></a>01760 
<a name="l01761"></a>01761         <span class="comment">//Write the name in a string before givng it to OpenGL machinery</span>
<a name="l01762"></a>01762         <span class="keywordtype">char</span> buf[10];
<a name="l01763"></a>01763         glColor3f(1.0f, 1.0f, 1.0f);
<a name="l01764"></a>01764         glRasterPos2i((GLint)10, (GLint)12);
<a name="l01765"></a>01765         sprintf_s(buf,<span class="stringliteral">&quot;ELECTRONS&quot;</span>);
<a name="l01766"></a>01766         glCallLists (9, GL_UNSIGNED_BYTE, &amp;buf);
<a name="l01767"></a>01767 
<a name="l01768"></a>01768         glEnable(GL_LIGHTING);
<a name="l01769"></a>01769         glEnable(GL_DEPTH_TEST);
<a name="l01770"></a>01770 
<a name="l01771"></a>01771         glMatrixMode(GL_PROJECTION); <span class="comment">//swapped this with...</span>
<a name="l01772"></a>01772         glPopMatrix();
<a name="l01773"></a>01773         glMatrixMode(GL_MODELVIEW); <span class="comment">//...this</span>
<a name="l01774"></a>01774         glPopMatrix();
<a name="l01775"></a>01775 
<a name="l01776"></a>01776 }
<a name="l01777"></a>01777 <span class="comment"></span>
<a name="l01778"></a>01778 <span class="comment">/**</span>
<a name="l01779"></a>01779 <span class="comment">* @brief Initiallizing and creating a metaball of spesific shape</span>
<a name="l01780"></a>01780 <span class="comment">*/</span>
<a name="l01781"></a>01781 System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a780db12637b2756c1d9de939998cadff">OpenGLForm::COpenGL::Init_Metaballs</a>()
<a name="l01782"></a>01782 {
<a name="l01783"></a>01783         <span class="keyword">const</span> <span class="keywordtype">int</span> minGridSize=10;
<a name="l01784"></a>01784         <span class="keywordtype">int</span> gridSize=20; <span class="comment">//Was 40, changed for speed</span>
<a name="l01785"></a>01785         <span class="keyword">const</span> <span class="keywordtype">int</span> numMetaballs=8;
<a name="l01786"></a>01786         <a class="code" href="class_m_e_t_a_b_a_l_l.html">METABALL</a> metaballs[numMetaballs];
<a name="l01787"></a>01787 
<a name="l01788"></a>01788         <span class="comment">//set up grid</span>
<a name="l01789"></a>01789         <span class="keywordflow">if</span>(!<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a54ea8233ca3aa9b851137cce9eba2e87" title="Cube grid for use from metaballs object.">cubeGrid</a>-&gt;<a class="code" href="class_c_u_b_e___g_r_i_d.html#a9f9d7fc001e0bb86c3e48dbaf6a1e3b0">CreateMemory</a>()){};
<a name="l01790"></a>01790     <span class="comment">//          return false;</span>
<a name="l01791"></a>01791         <span class="keywordflow">if</span>(!<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a54ea8233ca3aa9b851137cce9eba2e87" title="Cube grid for use from metaballs object.">cubeGrid</a>-&gt;<a class="code" href="class_c_u_b_e___g_r_i_d.html#ad0b8c602a05bff4a90fd835f0d19911e">Init</a>(gridSize)){};
<a name="l01792"></a>01792         <span class="comment">//              return false;</span>
<a name="l01793"></a>01793 
<a name="l01794"></a>01794         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;numMetaballs; i++)
<a name="l01795"></a>01795                 metaballs[i].Init(<a class="code" href="class_v_e_c_t_o_r3_d.html">VECTOR3D</a>(0.0f, 0.0f, 0.0f), 5.0f+float(i));
<a name="l01796"></a>01796 
<a name="l01797"></a>01797         <span class="comment">//Using 8 balls putting them &quot;carefully&quot; randomly  </span>
<a name="l01798"></a>01798         metaballs[0].<a class="code" href="class_m_e_t_a_b_a_l_l.html#adf7e7af1f1021c729be585df70c66dc5">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6ec6a85d5fdb1a68bcba0b079069f257" title="member variables">x</a>=-6.0f;
<a name="l01799"></a>01799         metaballs[0].<a class="code" href="class_m_e_t_a_b_a_l_l.html#adf7e7af1f1021c729be585df70c66dc5">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a7bd9c5db7df88934ad6ca9215e9e2152">y</a>=0.0f;
<a name="l01800"></a>01800         metaballs[0].<a class="code" href="class_m_e_t_a_b_a_l_l.html#adf7e7af1f1021c729be585df70c66dc5">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6c216b4ddf820b7d7e1df679562fdf03">z</a>=0.0f;
<a name="l01801"></a>01801 
<a name="l01802"></a>01802         metaballs[1].<a class="code" href="class_m_e_t_a_b_a_l_l.html#adf7e7af1f1021c729be585df70c66dc5">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6ec6a85d5fdb1a68bcba0b079069f257" title="member variables">x</a>=6.0f;
<a name="l01803"></a>01803         metaballs[1].<a class="code" href="class_m_e_t_a_b_a_l_l.html#adf7e7af1f1021c729be585df70c66dc5">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a7bd9c5db7df88934ad6ca9215e9e2152">y</a>=0.0f;
<a name="l01804"></a>01804         metaballs[1].<a class="code" href="class_m_e_t_a_b_a_l_l.html#adf7e7af1f1021c729be585df70c66dc5">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6c216b4ddf820b7d7e1df679562fdf03">z</a>=0.0f;
<a name="l01805"></a>01805 
<a name="l01806"></a>01806         metaballs[2].<a class="code" href="class_m_e_t_a_b_a_l_l.html#adf7e7af1f1021c729be585df70c66dc5">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6ec6a85d5fdb1a68bcba0b079069f257" title="member variables">x</a>=0.0f;
<a name="l01807"></a>01807         metaballs[2].<a class="code" href="class_m_e_t_a_b_a_l_l.html#adf7e7af1f1021c729be585df70c66dc5">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a7bd9c5db7df88934ad6ca9215e9e2152">y</a>=5.0f;
<a name="l01808"></a>01808         metaballs[2].<a class="code" href="class_m_e_t_a_b_a_l_l.html#adf7e7af1f1021c729be585df70c66dc5">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6c216b4ddf820b7d7e1df679562fdf03">z</a>=0.0f;
<a name="l01809"></a>01809 
<a name="l01810"></a>01810         metaballs[3].<a class="code" href="class_m_e_t_a_b_a_l_l.html#adf7e7af1f1021c729be585df70c66dc5">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6ec6a85d5fdb1a68bcba0b079069f257" title="member variables">x</a>=0.0f;
<a name="l01811"></a>01811         metaballs[3].<a class="code" href="class_m_e_t_a_b_a_l_l.html#adf7e7af1f1021c729be585df70c66dc5">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a7bd9c5db7df88934ad6ca9215e9e2152">y</a>=-6.5f;
<a name="l01812"></a>01812         metaballs[3].<a class="code" href="class_m_e_t_a_b_a_l_l.html#adf7e7af1f1021c729be585df70c66dc5">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6c216b4ddf820b7d7e1df679562fdf03">z</a>=0.0f;
<a name="l01813"></a>01813 
<a name="l01814"></a>01814         metaballs[4].<a class="code" href="class_m_e_t_a_b_a_l_l.html#adf7e7af1f1021c729be585df70c66dc5">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6ec6a85d5fdb1a68bcba0b079069f257" title="member variables">x</a>=0.0f;
<a name="l01815"></a>01815         metaballs[4].<a class="code" href="class_m_e_t_a_b_a_l_l.html#adf7e7af1f1021c729be585df70c66dc5">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a7bd9c5db7df88934ad6ca9215e9e2152">y</a>=0.0f;
<a name="l01816"></a>01816         metaballs[4].<a class="code" href="class_m_e_t_a_b_a_l_l.html#adf7e7af1f1021c729be585df70c66dc5">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6c216b4ddf820b7d7e1df679562fdf03">z</a>=5.0f;
<a name="l01817"></a>01817 
<a name="l01818"></a>01818         metaballs[5].<a class="code" href="class_m_e_t_a_b_a_l_l.html#adf7e7af1f1021c729be585df70c66dc5">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6ec6a85d5fdb1a68bcba0b079069f257" title="member variables">x</a>=0.0f;
<a name="l01819"></a>01819         metaballs[5].<a class="code" href="class_m_e_t_a_b_a_l_l.html#adf7e7af1f1021c729be585df70c66dc5">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a7bd9c5db7df88934ad6ca9215e9e2152">y</a>=0.0f;
<a name="l01820"></a>01820         metaballs[5].<a class="code" href="class_m_e_t_a_b_a_l_l.html#adf7e7af1f1021c729be585df70c66dc5">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6c216b4ddf820b7d7e1df679562fdf03">z</a>=-6.0f;
<a name="l01821"></a>01821 
<a name="l01822"></a>01822         metaballs[6].<a class="code" href="class_m_e_t_a_b_a_l_l.html#adf7e7af1f1021c729be585df70c66dc5">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6ec6a85d5fdb1a68bcba0b079069f257" title="member variables">x</a>=6.0f;
<a name="l01823"></a>01823         metaballs[6].<a class="code" href="class_m_e_t_a_b_a_l_l.html#adf7e7af1f1021c729be585df70c66dc5">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a7bd9c5db7df88934ad6ca9215e9e2152">y</a>=6.0f;
<a name="l01824"></a>01824         metaballs[6].<a class="code" href="class_m_e_t_a_b_a_l_l.html#adf7e7af1f1021c729be585df70c66dc5">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6c216b4ddf820b7d7e1df679562fdf03">z</a>=6.0f;
<a name="l01825"></a>01825 
<a name="l01826"></a>01826         metaballs[7].<a class="code" href="class_m_e_t_a_b_a_l_l.html#adf7e7af1f1021c729be585df70c66dc5">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6ec6a85d5fdb1a68bcba0b079069f257" title="member variables">x</a>=-5.0f;
<a name="l01827"></a>01827         metaballs[7].<a class="code" href="class_m_e_t_a_b_a_l_l.html#adf7e7af1f1021c729be585df70c66dc5">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a7bd9c5db7df88934ad6ca9215e9e2152">y</a>=5.0f;
<a name="l01828"></a>01828         metaballs[7].<a class="code" href="class_m_e_t_a_b_a_l_l.html#adf7e7af1f1021c729be585df70c66dc5">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6c216b4ddf820b7d7e1df679562fdf03">z</a>=5.0f;
<a name="l01829"></a>01829 
<a name="l01830"></a>01830                 <span class="comment">//clear the field</span>
<a name="l01831"></a>01831         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a54ea8233ca3aa9b851137cce9eba2e87" title="Cube grid for use from metaballs object.">cubeGrid</a>-&gt;<a class="code" href="class_c_u_b_e___g_r_i_d.html#a70f0e03352a7bba2868148c707933aea">numVertices</a>; i++)
<a name="l01832"></a>01832         {
<a name="l01833"></a>01833                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a54ea8233ca3aa9b851137cce9eba2e87" title="Cube grid for use from metaballs object.">cubeGrid</a>-&gt;<a class="code" href="class_c_u_b_e___g_r_i_d.html#a27fcf9d6f6bf68f4eb9f046443dbc41c">vertices</a>[i].<a class="code" href="class_c_u_b_e___g_r_i_d___v_e_r_t_e_x.html#aba3551ff97435d98861327d20d61c8b4">value</a>=0.0f;
<a name="l01834"></a>01834                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a54ea8233ca3aa9b851137cce9eba2e87" title="Cube grid for use from metaballs object.">cubeGrid</a>-&gt;<a class="code" href="class_c_u_b_e___g_r_i_d.html#a27fcf9d6f6bf68f4eb9f046443dbc41c">vertices</a>[i].<a class="code" href="class_c_u_b_e___g_r_i_d___v_e_r_t_e_x.html#a7671e563f550ba0dc0f18b5c7a71e7b7" title="the value of the scalar field at this point">normal</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a85d84ac8002a7d5d2c408f2002aea0ed">LoadZero</a>();
<a name="l01835"></a>01835         }
<a name="l01836"></a>01836 
<a name="l01837"></a>01837         <span class="comment">//evaluate the scalar field at each point</span>
<a name="l01838"></a>01838         <a class="code" href="class_v_e_c_t_o_r3_d.html">VECTOR3D</a> ballToPoint;
<a name="l01839"></a>01839         <span class="keywordtype">float</span> squaredRadius;
<a name="l01840"></a>01840         <a class="code" href="class_v_e_c_t_o_r3_d.html">VECTOR3D</a> ballPosition;
<a name="l01841"></a>01841         <span class="keywordtype">float</span> normalScale;
<a name="l01842"></a>01842 
<a name="l01843"></a>01843         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;numMetaballs; i++)
<a name="l01844"></a>01844         {
<a name="l01845"></a>01845                 squaredRadius=metaballs[i].<a class="code" href="class_m_e_t_a_b_a_l_l.html#a165c88999407ea0f29bde3e1a3b84dbe">squaredRadius</a>;
<a name="l01846"></a>01846                 ballPosition=metaballs[i].<a class="code" href="class_m_e_t_a_b_a_l_l.html#adf7e7af1f1021c729be585df70c66dc5">position</a>;
<a name="l01847"></a>01847 
<a name="l01848"></a>01848                 <span class="comment">//VC++6 standard does not inline functions</span>
<a name="l01849"></a>01849                 <span class="comment">//by inlining these maually, in this performance-critical area,</span>
<a name="l01850"></a>01850                 <span class="comment">//almost a 100% increase in speed is found</span>
<a name="l01851"></a>01851                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a54ea8233ca3aa9b851137cce9eba2e87" title="Cube grid for use from metaballs object.">cubeGrid</a>-&gt;<a class="code" href="class_c_u_b_e___g_r_i_d.html#a70f0e03352a7bba2868148c707933aea">numVertices</a>; j++)
<a name="l01852"></a>01852                 {
<a name="l01853"></a>01853                         <span class="comment">//ballToPoint=cubeGrid.vertices[j].position-ballPosition;</span>
<a name="l01854"></a>01854                         ballToPoint.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6ec6a85d5fdb1a68bcba0b079069f257" title="member variables">x</a>=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a54ea8233ca3aa9b851137cce9eba2e87" title="Cube grid for use from metaballs object.">cubeGrid</a>-&gt;<a class="code" href="class_c_u_b_e___g_r_i_d.html#a27fcf9d6f6bf68f4eb9f046443dbc41c">vertices</a>[j].<a class="code" href="class_c_u_b_e___g_r_i_d___v_e_r_t_e_x.html#a00c724d66417bbb626c6eacf05f88d51">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6ec6a85d5fdb1a68bcba0b079069f257" title="member variables">x</a>-ballPosition.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6ec6a85d5fdb1a68bcba0b079069f257" title="member variables">x</a>;
<a name="l01855"></a>01855                         ballToPoint.<a class="code" href="class_v_e_c_t_o_r3_d.html#a7bd9c5db7df88934ad6ca9215e9e2152">y</a>=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a54ea8233ca3aa9b851137cce9eba2e87" title="Cube grid for use from metaballs object.">cubeGrid</a>-&gt;<a class="code" href="class_c_u_b_e___g_r_i_d.html#a27fcf9d6f6bf68f4eb9f046443dbc41c">vertices</a>[j].<a class="code" href="class_c_u_b_e___g_r_i_d___v_e_r_t_e_x.html#a00c724d66417bbb626c6eacf05f88d51">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a7bd9c5db7df88934ad6ca9215e9e2152">y</a>-ballPosition.<a class="code" href="class_v_e_c_t_o_r3_d.html#a7bd9c5db7df88934ad6ca9215e9e2152">y</a>;
<a name="l01856"></a>01856                         ballToPoint.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6c216b4ddf820b7d7e1df679562fdf03">z</a>=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a54ea8233ca3aa9b851137cce9eba2e87" title="Cube grid for use from metaballs object.">cubeGrid</a>-&gt;<a class="code" href="class_c_u_b_e___g_r_i_d.html#a27fcf9d6f6bf68f4eb9f046443dbc41c">vertices</a>[j].<a class="code" href="class_c_u_b_e___g_r_i_d___v_e_r_t_e_x.html#a00c724d66417bbb626c6eacf05f88d51">position</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6c216b4ddf820b7d7e1df679562fdf03">z</a>-ballPosition.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6c216b4ddf820b7d7e1df679562fdf03">z</a>;
<a name="l01857"></a>01857 
<a name="l01858"></a>01858                         <span class="comment">//get squared distance from ball to point</span>
<a name="l01859"></a>01859                         <span class="comment">//float squaredDistance=ballToPoint.GetSquaredLength();</span>
<a name="l01860"></a>01860                         <span class="keywordtype">float</span> squaredDistance=  ballToPoint.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6ec6a85d5fdb1a68bcba0b079069f257" title="member variables">x</a>*ballToPoint.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6ec6a85d5fdb1a68bcba0b079069f257" title="member variables">x</a> +
<a name="l01861"></a>01861                                 ballToPoint.<a class="code" href="class_v_e_c_t_o_r3_d.html#a7bd9c5db7df88934ad6ca9215e9e2152">y</a>*ballToPoint.<a class="code" href="class_v_e_c_t_o_r3_d.html#a7bd9c5db7df88934ad6ca9215e9e2152">y</a> +
<a name="l01862"></a>01862                                 ballToPoint.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6c216b4ddf820b7d7e1df679562fdf03">z</a>*ballToPoint.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6c216b4ddf820b7d7e1df679562fdf03">z</a>;
<a name="l01863"></a>01863                         <span class="keywordflow">if</span>(squaredDistance==0.0f)
<a name="l01864"></a>01864                                 squaredDistance=0.0001f;
<a name="l01865"></a>01865 
<a name="l01866"></a>01866                         <span class="comment">//value = r^2/d^2</span>
<a name="l01867"></a>01867                         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a54ea8233ca3aa9b851137cce9eba2e87" title="Cube grid for use from metaballs object.">cubeGrid</a>-&gt;<a class="code" href="class_c_u_b_e___g_r_i_d.html#a27fcf9d6f6bf68f4eb9f046443dbc41c">vertices</a>[j].<a class="code" href="class_c_u_b_e___g_r_i_d___v_e_r_t_e_x.html#aba3551ff97435d98861327d20d61c8b4">value</a>+=squaredRadius/squaredDistance;
<a name="l01868"></a>01868 
<a name="l01869"></a>01869                         <span class="comment">//normal = (r^2 * v)/d^4</span>
<a name="l01870"></a>01870                         normalScale=squaredRadius/(squaredDistance*squaredDistance);
<a name="l01871"></a>01871                         <span class="comment">//cubeGrid.vertices[j].normal+=ballToPoint*normalScale;</span>
<a name="l01872"></a>01872                         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a54ea8233ca3aa9b851137cce9eba2e87" title="Cube grid for use from metaballs object.">cubeGrid</a>-&gt;<a class="code" href="class_c_u_b_e___g_r_i_d.html#a27fcf9d6f6bf68f4eb9f046443dbc41c">vertices</a>[j].<a class="code" href="class_c_u_b_e___g_r_i_d___v_e_r_t_e_x.html#a7671e563f550ba0dc0f18b5c7a71e7b7" title="the value of the scalar field at this point">normal</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6ec6a85d5fdb1a68bcba0b079069f257" title="member variables">x</a>+=ballToPoint.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6ec6a85d5fdb1a68bcba0b079069f257" title="member variables">x</a>*normalScale;
<a name="l01873"></a>01873                         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a54ea8233ca3aa9b851137cce9eba2e87" title="Cube grid for use from metaballs object.">cubeGrid</a>-&gt;<a class="code" href="class_c_u_b_e___g_r_i_d.html#a27fcf9d6f6bf68f4eb9f046443dbc41c">vertices</a>[j].<a class="code" href="class_c_u_b_e___g_r_i_d___v_e_r_t_e_x.html#a7671e563f550ba0dc0f18b5c7a71e7b7" title="the value of the scalar field at this point">normal</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a7bd9c5db7df88934ad6ca9215e9e2152">y</a>+=ballToPoint.<a class="code" href="class_v_e_c_t_o_r3_d.html#a7bd9c5db7df88934ad6ca9215e9e2152">y</a>*normalScale;
<a name="l01874"></a>01874                         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a54ea8233ca3aa9b851137cce9eba2e87" title="Cube grid for use from metaballs object.">cubeGrid</a>-&gt;<a class="code" href="class_c_u_b_e___g_r_i_d.html#a27fcf9d6f6bf68f4eb9f046443dbc41c">vertices</a>[j].<a class="code" href="class_c_u_b_e___g_r_i_d___v_e_r_t_e_x.html#a7671e563f550ba0dc0f18b5c7a71e7b7" title="the value of the scalar field at this point">normal</a>.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6c216b4ddf820b7d7e1df679562fdf03">z</a>+=ballToPoint.<a class="code" href="class_v_e_c_t_o_r3_d.html#a6c216b4ddf820b7d7e1df679562fdf03">z</a>*normalScale;
<a name="l01875"></a>01875                 }
<a name="l01876"></a>01876         }
<a name="l01877"></a>01877 
<a name="l01878"></a>01878 }
<a name="l01879"></a>01879 <span class="comment"></span>
<a name="l01880"></a>01880 <span class="comment">/**</span>
<a name="l01881"></a>01881 <span class="comment">* @brief Final Render and orientation of a metaball </span>
<a name="l01882"></a>01882 <span class="comment">*/</span>
<a name="l01883"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a5afbd1374f5c155cf0b59fa898c8dfbb">01883</a> System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a5afbd1374f5c155cf0b59fa898c8dfbb" title="Final Render and orientation of a metaball.">OpenGLForm::COpenGL::Render_MetaBalls</a>()
<a name="l01884"></a>01884 {
<a name="l01885"></a>01885         <span class="keywordtype">float</span> threshold=1.1f;
<a name="l01886"></a>01886         <span class="keywordtype">float</span> TransformMatrix[16];
<a name="l01887"></a>01887 
<a name="l01888"></a>01888 
<a name="l01889"></a>01889         <span class="comment">//Set orientation &quot;randomly nice&quot;</span>
<a name="l01890"></a>01890         glPushMatrix();
<a name="l01891"></a>01891         TransformMatrix[0]=(GLfloat)0.5159281;TransformMatrix[1]=(GLfloat)0.8540189;
<a name="l01892"></a>01892         TransformMatrix[2]=(GLfloat)0.06682559; TransformMatrix[3]=(GLfloat)0.0;
<a name="l01893"></a>01893 
<a name="l01894"></a>01894         TransformMatrix[4]=(GLfloat)-0.6884727;TransformMatrix[5]=(GLfloat)0.4598062;
<a name="l01895"></a>01895         TransformMatrix[6]=(GLfloat)-0.5608736;TransformMatrix[7]=(GLfloat)0.0;
<a name="l01896"></a>01896 
<a name="l01897"></a>01897         TransformMatrix[8]=(GLfloat)-0.5097246;TransformMatrix[9]=(GLfloat)0.2433634;
<a name="l01898"></a>01898         TransformMatrix[10]=(GLfloat)0.8251974;TransformMatrix[11]=(GLfloat)0.0;
<a name="l01899"></a>01899 
<a name="l01900"></a>01900         TransformMatrix[12]=TransformMatrix[13]=TransformMatrix[14]=0.0;TransformMatrix[15]=(GLfloat)1.0;
<a name="l01901"></a>01901         glMultMatrixf(TransformMatrix);
<a name="l01902"></a>01902 
<a name="l01903"></a>01903         glScalef(0.5f, 0.5f, 0.5f);
<a name="l01904"></a>01904         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a54ea8233ca3aa9b851137cce9eba2e87" title="Cube grid for use from metaballs object.">cubeGrid</a>-&gt;<a class="code" href="class_c_u_b_e___g_r_i_d.html#a29d386d94a0b7965443c481ca7dcd27e">DrawSurface</a>(threshold);
<a name="l01905"></a>01905 
<a name="l01906"></a>01906         glPopMatrix();
<a name="l01907"></a>01907 
<a name="l01908"></a>01908 
<a name="l01909"></a>01909 }
<a name="l01910"></a>01910 <span class="preprocessor">#pragma endregion</span>
<a name="l01911"></a>01911 <span class="preprocessor"></span><span class="comment"></span>
<a name="l01912"></a>01912 <span class="comment">/////Render Navigation axes///////////////</span>
<a name="l01913"></a>01913 <span class="comment"></span><span class="preprocessor">#pragma region Render Navigation axes</span>
<a name="l01914"></a>01914 <span class="preprocessor"></span><span class="comment">/**</span>
<a name="l01915"></a>01915 <span class="comment">* @brief Render of navigation axes in the edge fo the window</span>
<a name="l01916"></a>01916 <span class="comment">*/</span>
<a name="l01917"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ab5bbb674e0e4ea78f14ae0868a245e4d">01917</a> System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ab5bbb674e0e4ea78f14ae0868a245e4d" title="Render of navigation axes in the edge fo the window.">OpenGLForm::COpenGL::Render_Navigation</a>()
<a name="l01918"></a>01918 {
<a name="l01919"></a>01919         GLint viewport[4]; <span class="comment">//var to hold the viewport info</span>
<a name="l01920"></a>01920         GLdouble modelview[16]; <span class="comment">//var to hold the modelview info</span>
<a name="l01921"></a>01921         GLdouble projection[16]; <span class="comment">//var to hold the projection matrix info</span>
<a name="l01922"></a>01922         GLfloat winX, winY, winZ; <span class="comment">//variables to hold screen x,y,z coordinates</span>
<a name="l01923"></a>01923         GLdouble worldX, worldY, worldZ; <span class="comment">//variables to hold world x,y,z coordinates</span>
<a name="l01924"></a>01924         <span class="keywordtype">float</span> scalesize=15*0.75;  <span class="comment">//size of the Navigation Axes</span>
<a name="l01925"></a>01925 
<a name="l01926"></a>01926         glDisable(GL_FOG);
<a name="l01927"></a>01927         
<a name="l01928"></a>01928         <span class="comment">//Extract coordinates form OpenGL</span>
<a name="l01929"></a>01929         glGetDoublev( GL_MODELVIEW_MATRIX, modelview ); <span class="comment">//get the modelview info</span>
<a name="l01930"></a>01930         glGetDoublev( GL_PROJECTION_MATRIX, projection ); <span class="comment">//get the projection matrix info</span>
<a name="l01931"></a>01931         glGetIntegerv( GL_VIEWPORT, viewport ); <span class="comment">//get the viewport info</span>
<a name="l01932"></a>01932 
<a name="l01933"></a>01933         <span class="comment">//Setting the postion of navigation axes</span>
<a name="l01934"></a>01934         winX = (GLfloat) 0.05*mWidth;
<a name="l01935"></a>01935         winY = (GLfloat) 0.10*<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc3d9b1f8036a70a3312fabf2337805" title="Width and Height of the OpenGL Window.">mHeight</a>;
<a name="l01936"></a>01936         winZ = (GLfloat) 0.995;
<a name="l01937"></a>01937 
<a name="l01938"></a>01938         <span class="comment">//get the world coordinates from the screen coordinates</span>
<a name="l01939"></a>01939         gluUnProject( winX, winY, winZ, modelview, projection, viewport, &amp;worldX, &amp;worldY, &amp;worldZ);
<a name="l01940"></a>01940 
<a name="l01941"></a>01941         <span class="comment">// DRAW WORLD ORIGIN AXIS</span>
<a name="l01942"></a>01942         glPushMatrix();
<a name="l01943"></a>01943         glShadeModel(GL_SMOOTH);
<a name="l01944"></a>01944         glTranslated(worldX, worldY, worldZ);
<a name="l01945"></a>01945         glScalef(scalesize,scalesize,scalesize);
<a name="l01946"></a>01946         gluQuadricDrawStyle(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>, GLU_FILL);
<a name="l01947"></a>01947     gluQuadricNormals(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>, GLU_SMOOTH );
<a name="l01948"></a>01948 
<a name="l01949"></a>01949         <span class="comment">//X-Axis</span>
<a name="l01950"></a>01950         glPushMatrix();
<a name="l01951"></a>01951         glColor3f(0.0,1.0,0.0);
<a name="l01952"></a>01952         glRotated(-90, 1,0,0);
<a name="l01953"></a>01953         glTranslated(0,0,1);
<a name="l01954"></a>01954         gluCylinder(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,0.15,0.0001,0.1,20,20);  <span class="comment">//Axis</span>
<a name="l01955"></a>01955         glTranslated(0,0,-1);
<a name="l01956"></a>01956         gluCylinder(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,0.1,0.1,1.0,20,20);  <span class="comment">//Head of Arrow</span>
<a name="l01957"></a>01957         glPopMatrix();
<a name="l01958"></a>01958 
<a name="l01959"></a>01959         <span class="comment">//Y-Axis</span>
<a name="l01960"></a>01960         glPushMatrix();
<a name="l01961"></a>01961         glColor3f(0.0,0.0,1.0);
<a name="l01962"></a>01962         glRotated(90,0 ,0,1);
<a name="l01963"></a>01963         glTranslated(0,0,1);
<a name="l01964"></a>01964         gluCylinder(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,0.15,0.0001,0.1,20,20);  <span class="comment">//Axis</span>
<a name="l01965"></a>01965         glTranslated(0,0,-1);
<a name="l01966"></a>01966         gluCylinder(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,0.1,0.1,1.0,20,20);  <span class="comment">//Head of Arrow</span>
<a name="l01967"></a>01967         glPopMatrix();
<a name="l01968"></a>01968 
<a name="l01969"></a>01969         <span class="comment">//Z-Axis</span>
<a name="l01970"></a>01970         glPushMatrix();
<a name="l01971"></a>01971         glColor3f(1.0,0.0,0.0);
<a name="l01972"></a>01972         glRotated(90, 0,1,0);
<a name="l01973"></a>01973         glTranslated(0,0,1);
<a name="l01974"></a>01974         gluCylinder(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,0.15,0.0001,0.1,20,20);  <span class="comment">//Axis</span>
<a name="l01975"></a>01975         glTranslated(0,0,-1);
<a name="l01976"></a>01976         gluCylinder(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,0.1,0.1,1.0,20,20);  <span class="comment">//Head of Arrow</span>
<a name="l01977"></a>01977         glPopMatrix();
<a name="l01978"></a>01978 
<a name="l01979"></a>01979         glPopMatrix();
<a name="l01980"></a>01980 
<a name="l01981"></a>01981         glEnable(GL_FOG);
<a name="l01982"></a>01982 }
<a name="l01983"></a>01983 <span class="preprocessor">#pragma endregion</span>
<a name="l01984"></a>01984 <span class="preprocessor"></span><span class="comment"></span>
<a name="l01985"></a>01985 <span class="comment">///// Selection Buffer///////////////////</span>
<a name="l01986"></a>01986 <span class="comment"></span><span class="preprocessor">#pragma region Selection Buffer</span>
<a name="l01987"></a>01987 <span class="preprocessor"></span><span class="comment">/**</span>
<a name="l01988"></a>01988 <span class="comment">* @brief Render a selection buffer according to the position of the mouse.</span>
<a name="l01989"></a>01989 <span class="comment">* @param MouseX Mouse pointer x Coordinate.</span>
<a name="l01990"></a>01990 <span class="comment">* @param MouseY Mouse pointer y Coordinate.</span>
<a name="l01991"></a>01991 <span class="comment">*/</span>
<a name="l01992"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#afb019bd36c94e7c907ed9c771d400755">01992</a> System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#afb019bd36c94e7c907ed9c771d400755" title="Render a selection buffer according to the position of the mouse.">OpenGLForm::COpenGL::SelectionBuffer</a>(GLfloat MouseX,GLfloat MouseY)
<a name="l01993"></a>01993 {   
<a name="l01994"></a>01994            
<a name="l01995"></a>01995         <span class="keywordtype">long</span> len=1024;
<a name="l01996"></a>01996     GLuint* selectBuf=<span class="keyword">new</span> GLuint[len];
<a name="l01997"></a>01997         GLint viewport[4];
<a name="l01998"></a>01998     GLint mHits;
<a name="l01999"></a>01999 
<a name="l02000"></a>02000 
<a name="l02001"></a>02001         <span class="comment">//Set viewport and selection buffer</span>
<a name="l02002"></a>02002         glGetIntegerv(GL_VIEWPORT, viewport);
<a name="l02003"></a>02003         glSelectBuffer(len, selectBuf);
<a name="l02004"></a>02004 
<a name="l02005"></a>02005     <span class="comment">//Set render mode and initialize names</span>
<a name="l02006"></a>02006     glRenderMode(GL_SELECT);
<a name="l02007"></a>02007         glInitNames();
<a name="l02008"></a>02008     glPushName(-1);
<a name="l02009"></a>02009 
<a name="l02010"></a>02010         
<a name="l02011"></a>02011         <span class="comment">//For setting perspective</span>
<a name="l02012"></a>02012     glMatrixMode (GL_PROJECTION);
<a name="l02013"></a>02013     <span class="comment">//glPushMatrix ();</span>
<a name="l02014"></a>02014     glLoadIdentity ();
<a name="l02015"></a>02015    
<a name="l02016"></a>02016 
<a name="l02017"></a>02017         <span class="comment">//Create 5x5 pixel picking region near cursor location and perspective</span>
<a name="l02018"></a>02018     gluPickMatrix ((GLdouble) MouseX, (GLdouble) (viewport[3] - MouseY), 5.0, 5.0, viewport);
<a name="l02019"></a>02019  
<a name="l02020"></a>02020 
<a name="l02021"></a>02021         <span class="comment">//If using stereo, use right eye</span>
<a name="l02022"></a>02022         <span class="keywordflow">if</span>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ab7c488998482ef56d60f94fbddbd0879" title="Flag for stero viewing.">stereoview</a>) <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a89ada71ba19ad35316eb8cb304e63edc" title="Calculates the transformation matrix and parameters for double or quad buffer display.">Calc_eye</a>(2, <span class="keyword">false</span>);
<a name="l02023"></a>02023           <span class="keywordflow">else</span> <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a89ada71ba19ad35316eb8cb304e63edc" title="Calculates the transformation matrix and parameters for double or quad buffer display.">Calc_eye</a>(0, <span class="keyword">false</span>);
<a name="l02024"></a>02024         
<a name="l02025"></a>02025         <span class="comment">//Zoom &amp; Translation, Rotation and Centering</span>
<a name="l02026"></a>02026         glTranslatef((GLfloat)(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a57d3101b26d87de937bdff2467cddad8">TranslX</a>/abs(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a2e614255469c48a1d3a7949936d8fcfb" title="Value of Zooming -distance for the center, focal pont.">Zoom</a>)), (GLfloat)(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a345fefcc950cf66b9e17ea12cc03e40c" title="Translation X, Y of model.">TranslY</a>/abs(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a2e614255469c48a1d3a7949936d8fcfb" title="Value of Zooming -distance for the center, focal pont.">Zoom</a>)),(GLfloat) <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a2e614255469c48a1d3a7949936d8fcfb" title="Value of Zooming -distance for the center, focal pont.">Zoom</a>);
<a name="l02027"></a>02027         glMultMatrixf(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a700170133b4fb855f3e86cd187d0d6a6" title="Current matrix for transformation used for migration to OpenGL format.">TransformMat</a>);
<a name="l02028"></a>02028         glTranslatef((GLfloat)(-(<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;MaxX+<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;MinX)/2.0f),
<a name="l02029"></a>02029                          (GLfloat)(-(<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;MaxY+<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;MinY)/2.0f),
<a name="l02030"></a>02030                          (GLfloat)(-(<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;MaxZ+<a class="code" href="_open_g_l_8cpp.html#add78908b4e23fccb7f395c641ac9966d">MainCollection</a>-&gt;MinZ)/2.0f));
<a name="l02031"></a>02031 
<a name="l02032"></a>02032         glCallList(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a91d4b461b8d993b4ee65e940d284a5de" title="Rendering All atoms for Call list.">AllAtoms</a>);
<a name="l02033"></a>02033 
<a name="l02034"></a>02034     <span class="comment">//Finish Rendering but not swapp buffer(not needed to see it!)</span>
<a name="l02035"></a>02035     glFlush();
<a name="l02036"></a>02036 
<a name="l02037"></a>02037         <span class="comment">//Find number of 3D objects hitted</span>
<a name="l02038"></a>02038     mHits=glRenderMode (GL_RENDER);
<a name="l02039"></a>02039          
<a name="l02040"></a>02040 
<a name="l02041"></a>02041         <span class="keywordflow">if</span> (mHits) <span class="comment">//For number of selected atoms more than 0</span>
<a name="l02042"></a>02042         {
<a name="l02043"></a>02043                 <span class="keywordtype">int</span> n=0;
<a name="l02044"></a>02044                 <span class="keywordtype">double</span> minz=selectBuf[1];
<a name="l02045"></a>02045 
<a name="l02046"></a>02046                 <span class="comment">//Find the minimum of the second element of each group of 4 elements</span>
<a name="l02047"></a>02047                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=1;i&lt;mHits;i++) <span class="keywordflow">if</span> (selectBuf[1+i*4]&lt;minz) 
<a name="l02048"></a>02048                 {
<a name="l02049"></a>02049                         n=i;
<a name="l02050"></a>02050                         minz=selectBuf[1+i*4];
<a name="l02051"></a>02051                 };
<a name="l02052"></a>02052                 
<a name="l02053"></a>02053                 <span class="comment">//Select the minimum and take the ID of the 3d object saved in the fourth element</span>
<a name="l02054"></a>02054                 <span class="keywordflow">if</span>((<span class="keywordtype">int</span>)selectBuf[3+n*4]&gt;-1) <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7825b349b38f128d4a98b6b45b95051c" title="Atom to be selected.">ToBeSelectedAtom</a>=selectBuf[3+n*4];
<a name="l02055"></a>02055         }
<a name="l02056"></a>02056         <span class="keywordflow">else</span> <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7825b349b38f128d4a98b6b45b95051c" title="Atom to be selected.">ToBeSelectedAtom</a>=-1; <span class="comment">//Nothing selected</span>
<a name="l02057"></a>02057         
<a name="l02058"></a>02058 }
<a name="l02059"></a>02059 <span class="preprocessor">#pragma endregion</span>
<a name="l02060"></a>02060 <span class="preprocessor"></span><span class="comment"></span>
<a name="l02061"></a>02061 <span class="comment">///// Mouse Handlers/////////////////////</span>
<a name="l02062"></a>02062 <span class="comment"></span><span class="preprocessor">#pragma region Mouse Handlers</span>
<a name="l02063"></a>02063 <span class="preprocessor"></span><span class="comment">/**</span>
<a name="l02064"></a>02064 <span class="comment">* @brief Delete the selected atom in OpneGL panel.</span>
<a name="l02065"></a>02065 <span class="comment">* @param sender The usual sender object for Event Handlers.</span>
<a name="l02066"></a>02066 <span class="comment">* @param e The usual EventArguments object for Event Handlers.</span>
<a name="l02067"></a>02067 <span class="comment">*/</span>
<a name="l02068"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6f16d5a949cf392f9beb3992b91c4ff0">02068</a> <span class="keywordtype">void</span>  <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6f16d5a949cf392f9beb3992b91c4ff0" title="Delete the selected atom in OpneGL panel.">OpenGLForm::COpenGL::Del_KeyDown</a>(System::Object^  sender, System::Windows::Forms::KeyEventArgs^  e) 
<a name="l02069"></a>02069 {
<a name="l02070"></a>02070         <span class="comment">// For coordinates columns, determine whether the keystroke is the delete button.</span>
<a name="l02071"></a>02071         <span class="keywordflow">if</span> (e-&gt;KeyCode == Keys::Delete &amp;&amp; <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#af517cdc2e6b8e972e1297cb3281e8c15" title="ID of Selected Atom- zero indexed as coming from OpenGL machinery.">SelectedAtom</a>&gt;-1)
<a name="l02072"></a>02072         {
<a name="l02073"></a>02073                 ((<a class="code" href="class_spinach_g_u_i_1_1_main_form.html" title="Summary for MainForm.">SpinachGUI::MainForm</a>^)<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a904cf12aa0803e2da3a727cdb68392c4" title="Related to MainForm of Application.">mainForm</a>)-&gt;dataGridView1-&gt;Rows-&gt;RemoveAt(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#af517cdc2e6b8e972e1297cb3281e8c15" title="ID of Selected Atom- zero indexed as coming from OpenGL machinery.">SelectedAtom</a>);
<a name="l02074"></a>02074         };
<a name="l02075"></a>02075 
<a name="l02076"></a>02076  }
<a name="l02077"></a>02077 <span class="comment"></span>
<a name="l02078"></a>02078 <span class="comment">/**</span>
<a name="l02079"></a>02079 <span class="comment">* @brief Used for focus of the OpenGL panel when context menu closes.</span>
<a name="l02080"></a>02080 <span class="comment">* @param sender The usual sender object for Event Handlers.</span>
<a name="l02081"></a>02081 <span class="comment">* @param e The usual EventArguments object for Event Handlers.</span>
<a name="l02082"></a>02082 <span class="comment">*/</span>
<a name="l02083"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aea8f06c9be3254700bbff00c9155039e">02083</a> <span class="keywordtype">void</span> <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aea8f06c9be3254700bbff00c9155039e" title="Used for focus of the OpenGL panel when context menu closes.">OpenGLForm::COpenGL::OnMouseEnter</a>(System::Object^ sender, System::EventArgs^  e)
<a name="l02084"></a>02084 {
<a name="l02085"></a>02085         this-&gt;Focus();
<a name="l02086"></a>02086         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a9458a706c34bb3e65cddc4a9c6e3a6f6" title="Flag used for context menu showing.">focused</a>=<span class="keyword">true</span>;
<a name="l02087"></a>02087         
<a name="l02088"></a>02088 }
<a name="l02089"></a>02089 <span class="comment"></span>
<a name="l02090"></a>02090 <span class="comment">/**</span>
<a name="l02091"></a>02091 <span class="comment">* @brief Used for unfocus of the OpenGL panel when context menu opens.</span>
<a name="l02092"></a>02092 <span class="comment">* @param sender The usual sender object for Event Handlers.</span>
<a name="l02093"></a>02093 <span class="comment">* @param e The usual EventArguments object for Event Handlers.</span>
<a name="l02094"></a>02094 <span class="comment">*/</span>
<a name="l02095"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a03617be335007b1b445475d0b5316e2d">02095</a> <span class="keywordtype">void</span> <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a03617be335007b1b445475d0b5316e2d" title="Used for unfocus of the OpenGL panel when context menu opens.">OpenGLForm::COpenGL::OnMouseLeave</a>(System::Object^ sender, System::EventArgs^  e)
<a name="l02096"></a>02096 {
<a name="l02097"></a>02097         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a9458a706c34bb3e65cddc4a9c6e3a6f6" title="Flag used for context menu showing.">focused</a>=<span class="keyword">false</span>;
<a name="l02098"></a>02098 }
<a name="l02099"></a>02099 <span class="comment"></span>
<a name="l02100"></a>02100 <span class="comment">/**</span>
<a name="l02101"></a>02101 <span class="comment">* @brief For handling the wheel rotation of the mouse and used for zooming of the model.</span>
<a name="l02102"></a>02102 <span class="comment">* @param sender The usual sender object for Event Handlers.</span>
<a name="l02103"></a>02103 <span class="comment">* @param e The usual EventArguments object for Event Handlers.</span>
<a name="l02104"></a>02104 <span class="comment">*/</span>
<a name="l02105"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aa4e3269ebac6026328e8ae6d7a78a187">02105</a> <span class="keywordtype">void</span> <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aa4e3269ebac6026328e8ae6d7a78a187" title="For handling the wheel rotation of the mouse and used for zooming of the model.">OpenGLForm::COpenGL::OnMouseWheel</a>(System::Object^  sender, System::Windows::Forms::MouseEventArgs^  e)
<a name="l02106"></a>02106 {
<a name="l02107"></a>02107         <span class="comment">//Zooming using the wheel of the mouse</span>
<a name="l02108"></a>02108         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a2e614255469c48a1d3a7949936d8fcfb" title="Value of Zooming -distance for the center, focal pont.">Zoom</a> += e-&gt;Delta/(WHEEL_DELTA/1);
<a name="l02109"></a>02109         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a4269a637342af6fb3add0853e1301da6" title="Final Render routine.">Render</a>();       
<a name="l02110"></a>02110 }
<a name="l02111"></a>02111 <span class="comment"></span>
<a name="l02112"></a>02112 <span class="comment">/**</span>
<a name="l02113"></a>02113 <span class="comment">* @brief When the mouse move inside the OpenGL panel.</span>
<a name="l02114"></a>02114 <span class="comment">* @param sender The usual sender object for Event Handlers.</span>
<a name="l02115"></a>02115 <span class="comment">* @param e The usual EventArguments object for Event Handlers.</span>
<a name="l02116"></a>02116 <span class="comment">*/</span>
<a name="l02117"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#abbc977e84098903b10a5e5884dacb257">02117</a> <span class="keywordtype">void</span> <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#abbc977e84098903b10a5e5884dacb257" title="When the mouse move inside the OpenGL panel.">OpenGLForm::COpenGL::OnMouseMove</a>(System::Object^  sender, System::Windows::Forms::MouseEventArgs^  e)
<a name="l02118"></a>02118 {  
<a name="l02119"></a>02119   <span class="comment">//In order to not confused with the travelling</span>
<a name="l02120"></a>02120   <span class="keywordflow">if</span>(!((<a class="code" href="class_spinach_g_u_i_1_1_main_form.html" title="Summary for MainForm.">SpinachGUI::MainForm</a>^)<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a904cf12aa0803e2da3a727cdb68392c4" title="Related to MainForm of Application.">mainForm</a>)-&gt;OpenGLtimer-&gt;Enabled)
<a name="l02121"></a>02121         {
<a name="l02122"></a>02122         <span class="comment">//For creating selecting buffer and finding the 3D object ID</span>
<a name="l02123"></a>02123         <span class="keywordflow">if</span>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a0f0330d51c3dd60a65da76dc533d177e" title="Flag for selecting atoms.">SelectFlag</a>) <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#afb019bd36c94e7c907ed9c771d400755" title="Render a selection buffer according to the position of the mouse.">SelectionBuffer</a>((GLfloat) e-&gt;X, (GLfloat) e-&gt;Y);
<a name="l02124"></a>02124 
<a name="l02125"></a>02125         <span class="comment">//Left mouse Button Rotation</span>
<a name="l02126"></a>02126         <span class="keywordflow">if</span>( e-&gt;Button == ::MouseButtons::Left) 
<a name="l02127"></a>02127         {
<a name="l02128"></a>02128                 <span class="comment">//Use of ArcBall drag</span>
<a name="l02129"></a>02129                 <a class="code" href="_arc_ball_8h.html#a033a9295a5bb2ad95d49746035acebd8">Quat4fT</a>^ ThisQuat=<span class="keyword">gcnew</span> <a class="code" href="_arc_ball_8h.html#a033a9295a5bb2ad95d49746035acebd8">Quat4fT</a>();
<a name="l02130"></a>02130                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6047be0a1d94c1951881b54d4934774c" title="Current Mouse pointer coordinates.">MousePt</a>-&gt;X=(GLfloat) e-&gt;X;
<a name="l02131"></a>02131                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6047be0a1d94c1951881b54d4934774c" title="Current Mouse pointer coordinates.">MousePt</a>-&gt;Y=(GLfloat) e-&gt;Y;
<a name="l02132"></a>02132                 <a class="code" href="class_arc_ball.html">ArcBall</a>-&gt;drag(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#abe65d93638e760b31401f9bbe9505def" title="Margins for the Arcball algorithm.">ArcMargin</a>+<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6047be0a1d94c1951881b54d4934774c" title="Current Mouse pointer coordinates.">MousePt</a>, ThisQuat);
<a name="l02133"></a>02133 
<a name="l02134"></a>02134                 <span class="comment">// Update End Vector And Get Rotation As Quaternion</span>
<a name="l02135"></a>02135                 <a class="code" href="_arc_ball_8h.html#aeeb7b890be518c022bc4a810c56c8077">Matrix3fSetRotationFromQuat4f</a>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>, ThisQuat);               <span class="comment">// Convert Quaternion Into Matrix3fT</span>
<a name="l02136"></a>02136                 <a class="code" href="_arc_ball_8h.html#acb57ef06e4525274278fb34043f4abe6">Matrix3fMulMatrix3f</a>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>, <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a07e1ebf14aaebe563443d2923e6b4d61">LastRot</a>);                             <span class="comment">// Accumulate Last Rotation Into This One</span>
<a name="l02137"></a>02137                 <a class="code" href="_arc_ball_8h.html#a6f77a608653f4967c2b3c39a1781ab85">Matrix4fSetRotationFromMatrix3f</a>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7c7dab54909a1cd693ed759fc2b5c39b" title="Current matrix for transformation.">Transform</a>, <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>);
<a name="l02138"></a>02138                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aeab1376cc77c0a6a9923941d9348781a" title="Converts Matrix4fT form to C++ native matrix form for OpenGL use.">ConMat</a>();
<a name="l02139"></a>02139         }       
<a name="l02140"></a>02140         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(e-&gt;Button == ::MouseButtons::Right) <span class="comment">//Right mouse Button Translation</span>
<a name="l02141"></a>02141         {
<a name="l02142"></a>02142                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a07e1ebf14aaebe563443d2923e6b4d61">LastRot</a>;
<a name="l02143"></a>02143                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a57d3101b26d87de937bdff2467cddad8">TranslX</a>+=(-<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6047be0a1d94c1951881b54d4934774c" title="Current Mouse pointer coordinates.">MousePt</a>-&gt;X+e-&gt;X);
<a name="l02144"></a>02144                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a345fefcc950cf66b9e17ea12cc03e40c" title="Translation X, Y of model.">TranslY</a>+=(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6047be0a1d94c1951881b54d4934774c" title="Current Mouse pointer coordinates.">MousePt</a>-&gt;Y-e-&gt;Y);
<a name="l02145"></a>02145                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6047be0a1d94c1951881b54d4934774c" title="Current Mouse pointer coordinates.">MousePt</a>-&gt;X=(GLfloat) e-&gt;X;
<a name="l02146"></a>02146                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6047be0a1d94c1951881b54d4934774c" title="Current Mouse pointer coordinates.">MousePt</a>-&gt;Y=(GLfloat) e-&gt;Y;
<a name="l02147"></a>02147         };
<a name="l02148"></a>02148 
<a name="l02149"></a>02149         <span class="comment">//Render normally without change or redraw ellispoids if the </span>
<a name="l02150"></a>02150         <span class="comment">//selected atom has deactivated interaction showing.</span>
<a name="l02151"></a>02151         <span class="keywordflow">if</span>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a0f9cb0f634625db9ac37118d7314a044" title="Flag for showing the interaction of the selected atom.">SelectedAtomsInteractionsFlag</a>) <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a4269a637342af6fb3add0853e1301da6" title="Final Render routine.">Render</a>();     
<a name="l02152"></a>02152         <span class="keywordflow">else</span>
<a name="l02153"></a>02153         {
<a name="l02154"></a>02154                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ac8df7bacc4115db6119fb22eb76239f9" title="Updates the display list of the components of the system and renders at the end.">UpdateDisplay</a>(<a class="code" href="_open_g_l_8h.html#a0957e0df001dd796895b75f947daddb2a0e25d788d277d642072209cdb5bc3d91">UpdateType::BONDS_LIKE</a>);
<a name="l02155"></a>02155                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ac8df7bacc4115db6119fb22eb76239f9" title="Updates the display list of the components of the system and renders at the end.">UpdateDisplay</a>(<a class="code" href="_open_g_l_8h.html#a0957e0df001dd796895b75f947daddb2a8beed90e57a4475297c26db8bc77d8eb">UpdateType::ELLIPSOIDS</a>);
<a name="l02156"></a>02156         };
<a name="l02157"></a>02157 
<a name="l02158"></a>02158   };
<a name="l02159"></a>02159 }
<a name="l02160"></a>02160 <span class="comment"></span>
<a name="l02161"></a>02161 <span class="comment">/**</span>
<a name="l02162"></a>02162 <span class="comment">* @brief When a mouse button is down but not yet up.</span>
<a name="l02163"></a>02163 <span class="comment">* @param sender The usual sender object for Event Handlers.</span>
<a name="l02164"></a>02164 <span class="comment">* @param e The usual EventArguments object for Event Handlers.</span>
<a name="l02165"></a>02165 <span class="comment">*/</span>
<a name="l02166"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a84908477a9382e961bbe2e8434a51e4c">02166</a> <span class="keywordtype">void</span> <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a84908477a9382e961bbe2e8434a51e4c" title="When a mouse button is down but not yet up.">OpenGLForm::COpenGL::OnMouseDown</a>(System::Object^  sender, System::Windows::Forms::MouseEventArgs^  e)
<a name="l02167"></a>02167 {
<a name="l02168"></a>02168         <span class="comment">//Prepare Context menu empting it</span>
<a name="l02169"></a>02169         this-&gt;ContextMenuStrip=<span class="keyword">nullptr</span>;
<a name="l02170"></a>02170 
<a name="l02171"></a>02171         <span class="comment">//Update the selection in the Atom&#39;s Table</span>
<a name="l02172"></a>02172         <span class="keywordflow">if</span>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a0f0330d51c3dd60a65da76dc533d177e" title="Flag for selecting atoms.">SelectFlag</a>)
<a name="l02173"></a>02173         {
<a name="l02174"></a>02174                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#af517cdc2e6b8e972e1297cb3281e8c15" title="ID of Selected Atom- zero indexed as coming from OpenGL machinery.">SelectedAtom</a>=<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7825b349b38f128d4a98b6b45b95051c" title="Atom to be selected.">ToBeSelectedAtom</a>;
<a name="l02175"></a>02175                 ((<a class="code" href="class_spinach_g_u_i_1_1_main_form.html" title="Summary for MainForm.">SpinachGUI::MainForm</a>^)<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a904cf12aa0803e2da3a727cdb68392c4" title="Related to MainForm of Application.">mainForm</a>)-&gt;dataGridView1-&gt;ClearSelection();
<a name="l02176"></a>02176                 <span class="keywordflow">if</span>(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7825b349b38f128d4a98b6b45b95051c" title="Atom to be selected.">ToBeSelectedAtom</a>&gt;-1) 
<a name="l02177"></a>02177                         ((<a class="code" href="class_spinach_g_u_i_1_1_main_form.html" title="Summary for MainForm.">SpinachGUI::MainForm</a>^)<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a904cf12aa0803e2da3a727cdb68392c4" title="Related to MainForm of Application.">mainForm</a>)-&gt;dataGridView1-&gt;Rows[<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#af517cdc2e6b8e972e1297cb3281e8c15" title="ID of Selected Atom- zero indexed as coming from OpenGL machinery.">SelectedAtom</a>]-&gt;Selected=<span class="keyword">true</span>;             
<a name="l02178"></a>02178 
<a name="l02179"></a>02179         };
<a name="l02180"></a>02180 
<a name="l02181"></a>02181         <span class="comment">//Save the initial point when the mouse clicks</span>
<a name="l02182"></a>02182         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6047be0a1d94c1951881b54d4934774c" title="Current Mouse pointer coordinates.">MousePt</a>-&gt;X  = (GLfloat) e-&gt;X;
<a name="l02183"></a>02183         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6047be0a1d94c1951881b54d4934774c" title="Current Mouse pointer coordinates.">MousePt</a>-&gt;Y  = (GLfloat) e-&gt;Y;
<a name="l02184"></a>02184 
<a name="l02185"></a>02185 
<a name="l02186"></a>02186         <span class="keywordflow">if</span> (e-&gt;Button == ::MouseButtons::Left || e-&gt;Button == ::MouseButtons::Right) 
<a name="l02187"></a>02187         {
<a name="l02188"></a>02188                 <span class="comment">//Create context menu</span>
<a name="l02189"></a>02189                 <span class="keywordflow">if</span>((<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7825b349b38f128d4a98b6b45b95051c" title="Atom to be selected.">ToBeSelectedAtom</a>&gt;-1) &amp;&amp;  e-&gt;Button == ::MouseButtons::Right)
<a name="l02190"></a>02190                 {
<a name="l02191"></a>02191                         <span class="comment">//Cleaning the contect menu</span>
<a name="l02192"></a>02192                         this-&gt;ContextMenuStrip=((<a class="code" href="class_spinach_g_u_i_1_1_main_form.html" title="Summary for MainForm.">SpinachGUI::MainForm</a>^)<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a904cf12aa0803e2da3a727cdb68392c4" title="Related to MainForm of Application.">mainForm</a>)-&gt;OpenGLcontextMenu;
<a name="l02193"></a>02193                         this-&gt;ContextMenuStrip-&gt;Items-&gt;Clear();
<a name="l02194"></a>02194 
<a name="l02195"></a>02195                         <span class="comment">//Creating the menu items of the context menu</span>
<a name="l02196"></a>02196                         <span class="keywordflow">for each</span>(<span class="keywordtype">int</span> i <span class="keywordflow">in</span> <a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>-&gt;Keys)
<a name="l02197"></a>02197                         {
<a name="l02198"></a>02198                                 <span class="comment">//Create items only for the selected atom and no bond ones</span>
<a name="l02199"></a>02199                                 <span class="keywordflow">if</span>(((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;IntKind!=<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8ea1203807f6d26bc8df1724b77efbcf351">InteractionKind::CBond</a> &amp;&amp;
<a name="l02200"></a>02200                                         (((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;A-&gt;getID()==<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7825b349b38f128d4a98b6b45b95051c" title="Atom to be selected.">ToBeSelectedAtom</a>+1 ||
<a name="l02201"></a>02201                                         ((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;B-&gt;getID()==<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7825b349b38f128d4a98b6b45b95051c" title="Atom to be selected.">ToBeSelectedAtom</a>+1))
<a name="l02202"></a>02202                                 {
<a name="l02203"></a>02203                                         this-&gt;ContextMenuStrip-&gt;Items-&gt;Add(<span class="stringliteral">&quot;Edit &quot;</span> + ((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;IntKind.ToString()+
<a name="l02204"></a>02204                                                 <span class="stringliteral">&quot; (ID: &quot;</span>+((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;getID()+<span class="stringliteral">&quot;)&quot;</span>);
<a name="l02205"></a>02205                                         this-&gt;ContextMenuStrip-&gt;Items[this-&gt;ContextMenuStrip-&gt;Items-&gt;Count-1]-&gt;Tag=
<a name="l02206"></a>02206                                                 ((<a class="code" href="class_interaction.html">Interaction</a>^)<a class="code" href="_open_g_l_8cpp.html#a96a5793dd5f9f8ab3facae072a87745e">MainICollection</a>[i])-&gt;getID();
<a name="l02207"></a>02207                                 };
<a name="l02208"></a>02208                         };
<a name="l02209"></a>02209                 };
<a name="l02210"></a>02210 
<a name="l02211"></a>02211                 <span class="comment">//For faster rendering</span>
<a name="l02212"></a>02212                 <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ab71e341d370590f578bfb2b9156fb21a" title="Flag for using low resolution during rotation.">LowRes</a>=<span class="keyword">true</span>; 
<a name="l02213"></a>02213                 <span class="comment">//Arcball initial position</span>
<a name="l02214"></a>02214                 <a class="code" href="class_arc_ball.html">ArcBall</a>-&gt;click(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#abe65d93638e760b31401f9bbe9505def" title="Margins for the Arcball algorithm.">ArcMargin</a>+<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a6047be0a1d94c1951881b54d4934774c" title="Current Mouse pointer coordinates.">MousePt</a>);
<a name="l02215"></a>02215         };
<a name="l02216"></a>02216 
<a name="l02217"></a>02217         <span class="comment">//Update roation matrix</span>
<a name="l02218"></a>02218         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a07e1ebf14aaebe563443d2923e6b4d61">LastRot</a> = <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc2ce753d82be7573fee6c4db98c970" title="Matrix with last rotation and current rotation.">ThisRot</a>;      
<a name="l02219"></a>02219 
<a name="l02220"></a>02220         <span class="comment">//Good for checking if mouse moved during the mouse down</span>
<a name="l02221"></a>02221         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#abbc977e84098903b10a5e5884dacb257" title="When the mouse move inside the OpenGL panel.">OnMouseMove</a>(sender,e);
<a name="l02222"></a>02222 
<a name="l02223"></a>02223         <span class="comment">//For updating the mouse icon</span>
<a name="l02224"></a>02224         ((<a class="code" href="class_spinach_g_u_i_1_1_main_form.html" title="Summary for MainForm.">SpinachGUI::MainForm</a>^)<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a904cf12aa0803e2da3a727cdb68392c4" title="Related to MainForm of Application.">mainForm</a>)-&gt;OnMouseDownOpenGL(sender,e);
<a name="l02225"></a>02225 }
<a name="l02226"></a>02226 <span class="comment"></span>
<a name="l02227"></a>02227 <span class="comment">/**</span>
<a name="l02228"></a>02228 <span class="comment">* @brief When a mouse button is up after down.</span>
<a name="l02229"></a>02229 <span class="comment">* @param sender The usual sender object for Event Handlers.</span>
<a name="l02230"></a>02230 <span class="comment">* @param e The usual EventArguments object for Event Handlers.</span>
<a name="l02231"></a>02231 <span class="comment">*/</span>
<a name="l02232"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a1659288e97079ed5c8bca7ed6092764e">02232</a> <span class="keywordtype">void</span> <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a1659288e97079ed5c8bca7ed6092764e" title="When a mouse button is up after down.">OpenGLForm::COpenGL::OnMouseUp</a>(System::Object^  sender, System::Windows::Forms::MouseEventArgs^  e)
<a name="l02233"></a>02233 {
<a name="l02234"></a>02234         <span class="comment">//Back to high resolution</span>
<a name="l02235"></a>02235         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ab71e341d370590f578bfb2b9156fb21a" title="Flag for using low resolution during rotation.">LowRes</a>=<span class="keyword">false</span>;
<a name="l02236"></a>02236 
<a name="l02237"></a>02237         <span class="comment">//For updating the mouse icon</span>
<a name="l02238"></a>02238         ((<a class="code" href="class_spinach_g_u_i_1_1_main_form.html" title="Summary for MainForm.">SpinachGUI::MainForm</a>^)<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a904cf12aa0803e2da3a727cdb68392c4" title="Related to MainForm of Application.">mainForm</a>)-&gt;OnMouseUpOpenGL(sender,e);
<a name="l02239"></a>02239 
<a name="l02240"></a>02240         <span class="comment">//Dangerous crashes the program, but good for mesuring full speed of FPS when you click</span>
<a name="l02241"></a>02241         <span class="comment">//while(true) Render();</span>
<a name="l02242"></a>02242 }
<a name="l02243"></a>02243 
<a name="l02244"></a>02244 <span class="preprocessor">#pragma endregion</span>
<a name="l02245"></a>02245 <span class="preprocessor"></span><span class="comment"></span>
<a name="l02246"></a>02246 <span class="comment">///// Setting OpenGL System/////////////</span>
<a name="l02247"></a>02247 <span class="comment"></span><span class="preprocessor">#pragma region Setting OpenGL System</span>
<a name="l02248"></a>02248 <span class="preprocessor"></span><span class="comment">/**</span>
<a name="l02249"></a>02249 <span class="comment">* @brief Setting Pixel Format for OpenGL.</span>
<a name="l02250"></a>02250 <span class="comment">* @param hdc Windows machinery object.</span>
<a name="l02251"></a>02251 <span class="comment">*/</span>
<a name="l02252"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#af67305a63bf493e87a223cffe49f8c91">02252</a> GLint <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#af67305a63bf493e87a223cffe49f8c91" title="Setting Pixel Format for OpenGL.">OpenGLForm::COpenGL::MySetPixelFormat</a>(HDC hdc)
<a name="l02253"></a>02253 {
<a name="l02254"></a>02254         <span class="keyword">static</span>  PIXELFORMATDESCRIPTOR pfd=                              <span class="comment">// pfd Tells Windows How We Want Things To Be</span>
<a name="l02255"></a>02255         {
<a name="l02256"></a>02256                 <span class="keyword">sizeof</span>(PIXELFORMATDESCRIPTOR),                          <span class="comment">// Size Of This Pixel Format Descriptor</span>
<a name="l02257"></a>02257                 1,                                                                                      <span class="comment">// Version Number</span>
<a name="l02258"></a>02258                 PFD_DRAW_TO_WINDOW |                                            <span class="comment">// Format Must Support Window</span>
<a name="l02259"></a>02259                 PFD_SUPPORT_OPENGL |                                            <span class="comment">// Format Must Support OpenGL</span>
<a name="l02260"></a>02260                 PFD_DOUBLEBUFFER,                                                       <span class="comment">// Must Support Double Buffering</span>
<a name="l02261"></a>02261                 PFD_TYPE_RGBA,                                                          <span class="comment">// Request An RGBA Format</span>
<a name="l02262"></a>02262                 32,                                                                                 <span class="comment">// Select Our Color Depth</span>
<a name="l02263"></a>02263                 0, 0, 0, 0, 0, 0,                                                       <span class="comment">// Color Bits Ignored</span>
<a name="l02264"></a>02264                 0,                                                                                      <span class="comment">// No Alpha Buffer</span>
<a name="l02265"></a>02265                 0,                                                                                      <span class="comment">// Shift Bit Ignored</span>
<a name="l02266"></a>02266                 0,                                                                                      <span class="comment">// No Accumulation Buffer</span>
<a name="l02267"></a>02267                 0, 0, 0, 0,                                                                     <span class="comment">// Accumulation Bits Ignored</span>
<a name="l02268"></a>02268                 32,                                                                                     <span class="comment">// 16Bit Z-Buffer (Depth Buffer)  </span>
<a name="l02269"></a>02269                 0,                                                                                      <span class="comment">// No Stencil Buffer</span>
<a name="l02270"></a>02270                 0,                                                                                      <span class="comment">// No Auxiliary Buffer</span>
<a name="l02271"></a>02271                 PFD_MAIN_PLANE,                                                         <span class="comment">// Main Drawing Layer</span>
<a name="l02272"></a>02272                 0,                                                                                      <span class="comment">// Reserved</span>
<a name="l02273"></a>02273                 0, 0, 0                                                                         <span class="comment">// Layer Masks Ignored</span>
<a name="l02274"></a>02274         };
<a name="l02275"></a>02275 
<a name="l02276"></a>02276         GLboolean StereoSupport;
<a name="l02277"></a>02277         glGetBooleanv(GL_STEREO,&amp;StereoSupport);
<a name="l02278"></a>02278         <span class="keywordflow">if</span>(StereoSupport)       pfd.dwFlags |= PFD_STEREO;
<a name="l02279"></a>02279 
<a name="l02280"></a>02280         GLint  iPixelFormat; 
<a name="l02281"></a>02281 
<a name="l02282"></a>02282         <span class="comment">// get the device context&#39;s best, available pixel format match </span>
<a name="l02283"></a>02283         <span class="keywordflow">if</span>((iPixelFormat = ChoosePixelFormat(hdc, &amp;pfd)) == 0)
<a name="l02284"></a>02284         {
<a name="l02285"></a>02285                 MessageBox::Show(<span class="stringliteral">&quot;ChoosePixelFormat Failed&quot;</span>);
<a name="l02286"></a>02286                 <span class="keywordflow">return</span> 0;
<a name="l02287"></a>02287         }
<a name="l02288"></a>02288 
<a name="l02289"></a>02289         <span class="comment">// make that match the device context&#39;s current pixel format </span>
<a name="l02290"></a>02290         <span class="keywordflow">if</span>(SetPixelFormat(hdc, iPixelFormat, &amp;pfd) == FALSE)
<a name="l02291"></a>02291         {
<a name="l02292"></a>02292                 MessageBox::Show(<span class="stringliteral">&quot;SetPixelFormat Failed&quot;</span>);
<a name="l02293"></a>02293                 <span class="keywordflow">return</span> 0;
<a name="l02294"></a>02294         }
<a name="l02295"></a>02295 
<a name="l02296"></a>02296         <span class="keywordflow">if</span>((<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a60e074720c45e7292ab21c9ae64c71d7" title="For OpenGL window panel.">m_hglrc</a> = wglCreateContext(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a12341750588558dacd3daf1b8408a6ef" title="For OpenGL window panel.">m_hDC</a>)) == NULL)
<a name="l02297"></a>02297         {
<a name="l02298"></a>02298                 MessageBox::Show(<span class="stringliteral">&quot;wglCreateContext Failed&quot;</span>);
<a name="l02299"></a>02299                 <span class="keywordflow">return</span> 0;
<a name="l02300"></a>02300         }
<a name="l02301"></a>02301 
<a name="l02302"></a>02302         <span class="keywordflow">if</span>((wglMakeCurrent(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a12341750588558dacd3daf1b8408a6ef" title="For OpenGL window panel.">m_hDC</a>, <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a60e074720c45e7292ab21c9ae64c71d7" title="For OpenGL window panel.">m_hglrc</a>)) == NULL)
<a name="l02303"></a>02303         {
<a name="l02304"></a>02304                 MessageBox::Show(<span class="stringliteral">&quot;wglMakeCurrent Failed&quot;</span>);
<a name="l02305"></a>02305                 <span class="keywordflow">return</span> 0;
<a name="l02306"></a>02306         }
<a name="l02307"></a>02307         <span class="comment">//wglswapI</span>
<a name="l02308"></a>02308         
<a name="l02309"></a>02309         <span class="keywordflow">return</span> 1;
<a name="l02310"></a>02310 }
<a name="l02311"></a>02311 <span class="comment"></span>
<a name="l02312"></a>02312 <span class="comment">/**</span>
<a name="l02313"></a>02313 <span class="comment">* @brief Setting Forn Format for OpenGL.</span>
<a name="l02314"></a>02314 <span class="comment">* @param hdc Windows machinery object.</span>
<a name="l02315"></a>02315 <span class="comment">*/</span>
<a name="l02316"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a965de1dd6551873a8812cf19accbd94a">02316</a> GLint <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a965de1dd6551873a8812cf19accbd94a" title="Setting Forn Format for OpenGL.">OpenGLForm::COpenGL::MySetFontFormat</a>(HDC hdc)
<a name="l02317"></a>02317 {
<a name="l02318"></a>02318  
<a name="l02319"></a>02319  <span class="comment">// Set up the Font characteristics</span>
<a name="l02320"></a>02320  HFONT hFont;
<a name="l02321"></a>02321  LOGFONT logfont;
<a name="l02322"></a>02322 
<a name="l02323"></a>02323  logfont.lfHeight = -20;
<a name="l02324"></a>02324  logfont.lfWidth = 0;
<a name="l02325"></a>02325  logfont.lfEscapement = 0;
<a name="l02326"></a>02326  logfont.lfOrientation = 0;
<a name="l02327"></a>02327  <span class="comment">//logfont.lfWeight = FW_BOLD;</span>
<a name="l02328"></a>02328  logfont.lfItalic = FALSE;
<a name="l02329"></a>02329  logfont.lfUnderline = FALSE;
<a name="l02330"></a>02330  logfont.lfStrikeOut = FALSE;
<a name="l02331"></a>02331  logfont.lfCharSet = ANSI_CHARSET;
<a name="l02332"></a>02332  logfont.lfOutPrecision = OUT_DEFAULT_PRECIS;
<a name="l02333"></a>02333  logfont.lfClipPrecision = CLIP_DEFAULT_PRECIS;
<a name="l02334"></a>02334  logfont.lfQuality = DEFAULT_QUALITY;
<a name="l02335"></a>02335  logfont.lfPitchAndFamily = DEFAULT_PITCH;
<a name="l02336"></a>02336  wcscpy_s(logfont.lfFaceName,L<span class="stringliteral">&quot;Arial&quot;</span>);
<a name="l02337"></a>02337  <span class="comment">//_tcsncpy_s(logfont.lfFaceName, LF_FACESIZE, _T(&quot;Arial&quot;), 7);  </span>
<a name="l02338"></a>02338  <span class="comment">// Create the font and display list</span>
<a name="l02339"></a>02339  hFont = CreateFontIndirect(&amp;logfont);
<a name="l02340"></a>02340  
<a name="l02341"></a>02341  SelectObject (hdc, hFont);
<a name="l02342"></a>02342  <span class="comment">// Create display lists for glyphs 0 through 128</span>
<a name="l02343"></a>02343  <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#abfca7bb825b247d0cae1266b7976d548" title="Fonts for OpenGL text.">nFontList</a> = glGenLists(128);
<a name="l02344"></a>02344 
<a name="l02345"></a>02345  wglUseFontBitmaps(hdc, 0, 128, <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#abfca7bb825b247d0cae1266b7976d548" title="Fonts for OpenGL text.">nFontList</a>);
<a name="l02346"></a>02346  DeleteObject(hFont); <span class="comment">// Dont need original font anymore</span>
<a name="l02347"></a>02347  <span class="comment">// Black Background</span>
<a name="l02348"></a>02348  <span class="comment">//glClearColor(0.0f, 0.0f, 0.0f, 1.0f );</span>
<a name="l02349"></a>02349 
<a name="l02350"></a>02350  <span class="keywordflow">return</span> 1;
<a name="l02351"></a>02351 }
<a name="l02352"></a>02352 <span class="comment"></span>
<a name="l02353"></a>02353 <span class="comment">/**</span>
<a name="l02354"></a>02354 <span class="comment">*  @brief Setting Lighting(artistic) Format for OpenGL.</span>
<a name="l02355"></a>02355 <span class="comment">*/</span>
<a name="l02356"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a0430429fa224144c90a4545eccfc9b37">02356</a> System::Void  <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a0430429fa224144c90a4545eccfc9b37" title="Setting Lighting(artistic) Format for OpenGL.">OpenGLForm::COpenGL::MySetLightingFormat</a>(System::Void)
<a name="l02357"></a>02357 {
<a name="l02358"></a>02358   GLfloat  ambient               = (GLfloat) 0.20;
<a name="l02359"></a>02359   GLfloat  diffuse               = (GLfloat) 0.40;
<a name="l02360"></a>02360   GLfloat  specular              = (GLfloat) 0.30;
<a name="l02361"></a>02361   GLfloat ambientLight[] = {ambient/10.0f,ambient/10.0f,ambient/10.f,1.0};
<a name="l02362"></a>02362   GLfloat diffuseLight[] = {diffuse,diffuse,diffuse,1.0};
<a name="l02363"></a>02363   GLfloat specularLight[] = {specular/4.0f,specular/4.0f,specular/4.0f,1.0};
<a name="l02364"></a>02364 
<a name="l02365"></a>02365   <span class="comment">// setting the lighting parameters</span>
<a name="l02366"></a>02366   glLightfv(GL_LIGHT0, GL_AMBIENT, ambientLight);
<a name="l02367"></a>02367   glLightfv(GL_LIGHT0, GL_DIFFUSE, diffuseLight);
<a name="l02368"></a>02368   glLightfv(GL_LIGHT0, GL_SPECULAR, specularLight);
<a name="l02369"></a>02369   glLightfv(GL_LIGHT2, GL_AMBIENT, ambientLight);
<a name="l02370"></a>02370   glLightfv(GL_LIGHT2, GL_DIFFUSE, diffuseLight);
<a name="l02371"></a>02371   glLightfv(GL_LIGHT2, GL_SPECULAR, specularLight);
<a name="l02372"></a>02372   GLfloat position[] = { 0.0f, 0.0f, -1.0f, 1.0f};
<a name="l02373"></a>02373   GLfloat pos[]      = { 20.0f, 0.0f, 200.0f, 1.0f};
<a name="l02374"></a>02374 
<a name="l02375"></a>02375   glLightfv(GL_LIGHT0, GL_POSITION, position);
<a name="l02376"></a>02376   glLightfv(GL_LIGHT2, GL_POSITION, pos);
<a name="l02377"></a>02377   glEnable(GL_LIGHTING);
<a name="l02378"></a>02378   glEnable(GL_LIGHT0);
<a name="l02379"></a>02379   glEnable(GL_LIGHT2);
<a name="l02380"></a>02380 
<a name="l02381"></a>02381   glLightModeli(GL_LIGHT_MODEL_TWO_SIDE, GL_TRUE);
<a name="l02382"></a>02382   glColorMaterial(GL_FRONT_AND_BACK, GL_AMBIENT_AND_DIFFUSE);
<a name="l02383"></a>02383   glEnable(GL_COLOR_MATERIAL);
<a name="l02384"></a>02384   glMaterialfv(GL_FRONT_AND_BACK, GL_SPECULAR, specularLight);
<a name="l02385"></a>02385 
<a name="l02386"></a>02386 }
<a name="l02387"></a>02387 <span class="comment"></span>
<a name="l02388"></a>02388 <span class="comment">/**</span>
<a name="l02389"></a>02389 <span class="comment">* @brief  Initialization of parameters of OpenGL.</span>
<a name="l02390"></a>02390 <span class="comment">*/</span>
<a name="l02391"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aca74db3d732ca1158b1c2f104813770c">02391</a> <span class="keywordtype">bool</span> <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#aca74db3d732ca1158b1c2f104813770c" title="Initialization of parameters of OpenGL.">OpenGLForm::COpenGL::InitGL</a>(GLvoid)                                        <span class="comment">// All setup for opengl goes here</span>
<a name="l02392"></a>02392 {
<a name="l02393"></a>02393 
<a name="l02394"></a>02394         glShadeModel(GL_SMOOTH);                                                        <span class="comment">// Enable smooth shading</span>
<a name="l02395"></a>02395         <span class="comment">//glEnable (GL_BLEND);</span>
<a name="l02396"></a>02396         glBlendFunc (GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
<a name="l02397"></a>02397 
<a name="l02398"></a>02398         glClearColor((GLfloat)<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a59338162d14cc3c1179d6c90290ce450" title="RGB Matrix for the color.">BackgroundColor</a>[0], (GLfloat) BackgroundColor[1],
<a name="l02399"></a>02399                          (GLfloat) BackgroundColor[2],1.0f);    <span class="comment">// White background</span>
<a name="l02400"></a>02400         
<a name="l02401"></a>02401         glEnable(GL_DEPTH_TEST);                                                        <span class="comment">// Enables depth testing</span>
<a name="l02402"></a>02402         glDepthFunc(GL_LEQUAL);                                                         <span class="comment">// The type of depth testing to do</span>
<a name="l02403"></a>02403         glClearDepth(1.0);                                                                      <span class="comment">// Depth buffer setup</span>
<a name="l02404"></a>02404         glClearStencil(0); 
<a name="l02405"></a>02405         glHint(GL_PERSPECTIVE_CORRECTION_HINT, GL_NICEST);      <span class="comment">// Really nice perspective calculations</span>
<a name="l02406"></a>02406         
<a name="l02407"></a>02407         <span class="comment">//More anti-aliasing, not sure if it makes more difference</span>
<a name="l02408"></a>02408         glEnable (GL_LINE_SMOOTH);
<a name="l02409"></a>02409         glHint (GL_LINE_SMOOTH_HINT, GL_NICEST);
<a name="l02410"></a>02410         glEnable (GL_POLYGON_SMOOTH);
<a name="l02411"></a>02411         glHint (GL_POLYGON_SMOOTH_HINT, GL_NICEST);
<a name="l02412"></a>02412 
<a name="l02413"></a>02413         glDepthMask(GL_TRUE);
<a name="l02414"></a>02414         glMaterialf(GL_FRONT, GL_SHININESS, 10.0f);         <span class="comment">//Create a dictionary of colours</span>
<a name="l02415"></a>02415         glEnable(GL_NORMALIZE);
<a name="l02416"></a>02416 
<a name="l02417"></a>02417         glEnable(GL_LIGHTING);                                                                                  <span class="comment">// Enable Lighting</span>
<a name="l02418"></a>02418         glEnable(GL_LIGHT2);
<a name="l02419"></a>02419         glEnable(GL_LIGHT0);    
<a name="l02420"></a>02420         <span class="comment">//glColorMaterial(GL_FRONT_AND_BACK, GL_DIFFUSE);  // Enable Default Light</span>
<a name="l02421"></a>02421         glEnable(GL_COLOR_MATERIAL);
<a name="l02422"></a>02422         glEnable(GL_FOG);
<a name="l02423"></a>02423         glFogi(GL_FOG_MODE, GL_EXP);
<a name="l02424"></a>02424     glFogf(GL_FOG_DENSITY, 0.005f);
<a name="l02425"></a>02425         <span class="comment">//glFogf(GL_FOG_START,   30.0f);</span>
<a name="l02426"></a>02426     <span class="comment">//glFogf(GL_FOG_END,     200.0f);</span>
<a name="l02427"></a>02427         
<a name="l02428"></a>02428 
<a name="l02429"></a>02429         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>=gluNewQuadric();                                                      <span class="comment">// Create A Pointer To The Quadric Object</span>
<a name="l02430"></a>02430         gluQuadricDrawStyle(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a28eec4de60f14204c023d4f2cdf4990c" title="Quadratic object ofr drawing of spheres.">quadratic</a>,GLU_FILL);
<a name="l02431"></a>02431         
<a name="l02432"></a>02432         <span class="comment">//Build the primary display lists</span>
<a name="l02433"></a>02433         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a1c646517d2e8bdcff223af6f3427a1bd" title="Build of Display list for fast Rendering.">BuildDisplayLists</a>();
<a name="l02434"></a>02434         <span class="keywordflow">return</span> TRUE;                                                                            <span class="comment">// Initialisation went ok</span>
<a name="l02435"></a>02435 }
<a name="l02436"></a>02436 <span class="comment"></span>
<a name="l02437"></a>02437 <span class="comment">/**</span>
<a name="l02438"></a>02438 <span class="comment">* @brief  Swap Buffer in OpenGL panel, usually after finishing rendering.</span>
<a name="l02439"></a>02439 <span class="comment">*/</span>
<a name="l02440"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ac1fb86de38cd62d963ead03a0ff4fbb7">02440</a> System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ac1fb86de38cd62d963ead03a0ff4fbb7" title="Swap Buffer in OpenGL panel, usually after finishing rendering.">OpenGLForm::COpenGL::SwapOpenGLBuffers</a>(System::Void)
<a name="l02441"></a>02441 {
<a name="l02442"></a>02442         SwapBuffers(<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a12341750588558dacd3daf1b8408a6ef" title="For OpenGL window panel.">m_hDC</a>) ;
<a name="l02443"></a>02443 }
<a name="l02444"></a>02444 <span class="comment"></span>
<a name="l02445"></a>02445 <span class="comment">/**</span>
<a name="l02446"></a>02446 <span class="comment">* @brief Resize of the windows containing the OpenGL panel.</span>
<a name="l02447"></a>02447 <span class="comment">* @param parentForm The parent Windows form.</span>
<a name="l02448"></a>02448 <span class="comment">* @param origin Point of origin.</span>
<a name="l02449"></a>02449 <span class="comment">* @param iWidth Width of window.</span>
<a name="l02450"></a>02450 <span class="comment">* @param iHeight Height of window.</span>
<a name="l02451"></a>02451 <span class="comment">*/</span>
<a name="l02452"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#adabbd17b83de330503aa2cd7851c1ad8">02452</a> System::Void <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#adabbd17b83de330503aa2cd7851c1ad8" title="Resize of the windows containing the OpenGL panel.">OpenGLForm::COpenGL::ReSizeWindow</a>(Form ^ parentForm, System::Drawing::Point origin, GLsizei iWidth, GLsizei iHeight)
<a name="l02453"></a>02453 {
<a name="l02454"></a>02454         <span class="comment">//Setting location and size of the panel </span>
<a name="l02455"></a>02455         this-&gt;Location= origin;
<a name="l02456"></a>02456         this-&gt;Height = iHeight;
<a name="l02457"></a>02457         this-&gt;Width = iWidth;
<a name="l02458"></a>02458         mWidth=iWidth;<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc3d9b1f8036a70a3312fabf2337805" title="Width and Height of the OpenGL Window.">mHeight</a>=iHeight;
<a name="l02459"></a>02459 
<a name="l02460"></a>02460         <span class="comment">//Setting the boundaries of ArcBall</span>
<a name="l02461"></a>02461         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#abe65d93638e760b31401f9bbe9505def" title="Margins for the Arcball algorithm.">ArcMargin</a>-&gt;X=(GLfloat)(-0.05*mWidth);
<a name="l02462"></a>02462         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#abe65d93638e760b31401f9bbe9505def" title="Margins for the Arcball algorithm.">ArcMargin</a>-&gt;Y=(GLfloat)(-0.05*<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc3d9b1f8036a70a3312fabf2337805" title="Width and Height of the OpenGL Window.">mHeight</a>);
<a name="l02463"></a>02463         <a class="code" href="class_arc_ball.html">ArcBall</a>-&gt;setBounds((GLfloat)iWidth+2*<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#abe65d93638e760b31401f9bbe9505def" title="Margins for the Arcball algorithm.">ArcMargin</a>-&gt;X,(GLfloat) iHeight+2*<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#abe65d93638e760b31401f9bbe9505def" title="Margins for the Arcball algorithm.">ArcMargin</a>-&gt;Y);
<a name="l02464"></a>02464         
<a name="l02465"></a>02465         <span class="comment">// Setting the size to the final OpenGl panel</span>
<a name="l02466"></a>02466         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a3ac1de9424a99c228fb52551396b9116" title="Resize the OpenGL panel.">ReSizeGLScene</a>(iWidth, iHeight);
<a name="l02467"></a>02467         <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a4269a637342af6fb3add0853e1301da6" title="Final Render routine.">Render</a>();
<a name="l02468"></a>02468 }
<a name="l02469"></a>02469 <span class="comment"></span>
<a name="l02470"></a>02470 <span class="comment">/**</span>
<a name="l02471"></a>02471 <span class="comment">* @brief Resize the OpenGL panel.</span>
<a name="l02472"></a>02472 <span class="comment">* @param width Width of OpenGL panel.</span>
<a name="l02473"></a>02473 <span class="comment">* @param height Height of OpenGL panel.</span>
<a name="l02474"></a>02474 <span class="comment">*/</span>
<a name="l02475"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a3ac1de9424a99c228fb52551396b9116">02475</a> GLvoid <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a3ac1de9424a99c228fb52551396b9116" title="Resize the OpenGL panel.">OpenGLForm::COpenGL::ReSizeGLScene</a>(GLsizei width, GLsizei height)                
<a name="l02476"></a>02476 {
<a name="l02477"></a>02477         <span class="keywordflow">if</span> (height==0)  height=1;                                                       <span class="comment">// Prevent A Divide By Zero By Making Height Equal One</span>
<a name="l02478"></a>02478         glViewport(0,0,width,height);                                           <span class="comment">// Reset The Current Viewport</span>
<a name="l02479"></a>02479         glMatrixMode(GL_PROJECTION);                                            <span class="comment">// Select The Projection Matrix</span>
<a name="l02480"></a>02480         glLoadIdentity();                                                                       <span class="comment">// Reset The Projection Matrix</span>
<a name="l02481"></a>02481         
<a name="l02482"></a>02482         <span class="comment">// Calculate The Aspect Ratio Of The Window</span>
<a name="l02483"></a>02483         gluPerspective(45.0f,(GLfloat)width/(GLfloat)height,0.1f,300.0f);
<a name="l02484"></a>02484         glMatrixMode(GL_MODELVIEW);                                                     <span class="comment">// Select The Modelview Matrix</span>
<a name="l02485"></a>02485         glLoadIdentity();                                                                       <span class="comment">// Reset The Modelview Matrix</span>
<a name="l02486"></a>02486 }
<a name="l02487"></a>02487 <span class="preprocessor">#pragma endregion</span>
<a name="l02488"></a>02488 <span class="preprocessor"></span><span class="comment"></span>
<a name="l02489"></a>02489 <span class="comment">/////Bitmap export////////////////////</span>
<a name="l02490"></a>02490 <span class="comment"></span><span class="comment">/**</span>
<a name="l02491"></a>02491 <span class="comment">* @brief Export the contens of the  OpenGL panel in a bitmap file.</span>
<a name="l02492"></a>02492 <span class="comment">*/</span>
<a name="l02493"></a><a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ac5d6bf8aa731670ca6444773ed40db8a">02493</a> System::Drawing::Bitmap^  <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#ac5d6bf8aa731670ca6444773ed40db8a" title="Export the contens of the OpenGL panel in a bitmap file.">OpenGLForm::COpenGL::Save_BMP</a>()
<a name="l02494"></a>02494 {
<a name="l02495"></a>02495         <span class="comment">/* //Old Method not working so good</span>
<a name="l02496"></a>02496 <span class="comment">                static int id = 0;</span>
<a name="l02497"></a>02497 <span class="comment">        int xs = mWidth;</span>
<a name="l02498"></a>02498 <span class="comment">        int ys = mHeight-1;</span>
<a name="l02499"></a>02499 <span class="comment">        System::Drawing::Bitmap^ nbitmap=gcnew System::Drawing::Bitmap(xs+1,ys);</span>
<a name="l02500"></a>02500 <span class="comment">        GLubyte *buf = new GLubyte [3*(xs+2)*(ys+2)];</span>
<a name="l02501"></a>02501 <span class="comment"></span>
<a name="l02502"></a>02502 <span class="comment">        if (buf==NULL) {return nbitmap;}</span>
<a name="l02503"></a>02503 <span class="comment"></span>
<a name="l02504"></a>02504 <span class="comment">        bool EyeFlip = false;</span>
<a name="l02505"></a>02505 <span class="comment">        Render();</span>
<a name="l02506"></a>02506 <span class="comment">        //glReadBuffer((!EyeFlip)?GL_BACK:GL_BACK_RIGHT);</span>
<a name="l02507"></a>02507 <span class="comment">        glReadBuffer((!EyeFlip)?GL_FRONT:GL_FRONT_RIGHT);</span>
<a name="l02508"></a>02508 <span class="comment">        glReadPixels(0,2,xs, ys,GL_RGB,GL_UNSIGNED_BYTE, buf);//76</span>
<a name="l02509"></a>02509 <span class="comment"></span>
<a name="l02510"></a>02510 <span class="comment">        int ti;</span>
<a name="l02511"></a>02511 <span class="comment">        for(int i=0;i&lt;5;i++)//Not Perfect but not bad solution</span>
<a name="l02512"></a>02512 <span class="comment">        {</span>
<a name="l02513"></a>02513 <span class="comment">        int temp=(xs+ys/2*(xs+1))*3-i*ys/2;</span>
<a name="l02514"></a>02514 <span class="comment">        if(buf[temp]!=255 || buf[temp+1]!=255 || buf[temp+2]!=255) ti=i;</span>
<a name="l02515"></a>02515 <span class="comment">        }</span>
<a name="l02516"></a>02516 <span class="comment"></span>
<a name="l02517"></a>02517 <span class="comment">        for(int j=0;j&lt;ys;j++){</span>
<a name="l02518"></a>02518 <span class="comment">                for(int i=0;i&lt;(xs+1);i++){</span>
<a name="l02519"></a>02519 <span class="comment">                        nbitmap-&gt;SetPixel(i,ys-1-j,System::Drawing::Color::FromArgb(255,buf[(i+j*(xs+1))*3-ti*j],</span>
<a name="l02520"></a>02520 <span class="comment">                                                                                                                                                        buf[(i+j*(xs+1))*3+1-ti*j],</span>
<a name="l02521"></a>02521 <span class="comment">                                                                                                                                                        buf[(i+j*(xs+1))*3+2-ti*j]));</span>
<a name="l02522"></a>02522 <span class="comment">                }</span>
<a name="l02523"></a>02523 <span class="comment">        };</span>
<a name="l02524"></a>02524 <span class="comment"></span>
<a name="l02525"></a>02525 <span class="comment">        return nbitmap;</span>
<a name="l02526"></a>02526 <span class="comment">        free(buf);</span>
<a name="l02527"></a>02527 <span class="comment">        buf=NULL;</span>
<a name="l02528"></a>02528 <span class="comment">        */</span>
<a name="l02529"></a>02529 
<a name="l02530"></a>02530         <span class="comment">//Create the bitmap file</span>
<a name="l02531"></a>02531         System::Drawing::Bitmap^ bmp = <span class="keyword">gcnew</span> System::Drawing::Bitmap(((<a class="code" href="class_spinach_g_u_i_1_1_main_form.html" title="Summary for MainForm.">SpinachGUI::MainForm</a>^)<a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a904cf12aa0803e2da3a727cdb68392c4" title="Related to MainForm of Application.">mainForm</a>)-&gt;splitContainer2-&gt;Panel1-&gt;ClientSize.Width, 
<a name="l02532"></a>02532                                                                          ((<a class="code" href="class_spinach_g_u_i_1_1_main_form.html" title="Summary for MainForm.">SpinachGUI::MainForm</a>^)mainForm)-&gt;splitContainer2-&gt;Panel1-&gt;ClientSize.Height);
<a name="l02533"></a>02533         <span class="comment">//Create the datat file</span>
<a name="l02534"></a>02534     System::Drawing::Imaging::BitmapData^ data =
<a name="l02535"></a>02535                 bmp-&gt;LockBits(((<a class="code" href="class_spinach_g_u_i_1_1_main_form.html" title="Summary for MainForm.">SpinachGUI::MainForm</a>^)mainForm)-&gt;splitContainer2-&gt;Panel1-&gt;ClientRectangle, 
<a name="l02536"></a>02536                                               System::Drawing::Imaging::ImageLockMode::WriteOnly, 
<a name="l02537"></a>02537                                                           System::Drawing::Imaging::PixelFormat::Format24bppRgb);
<a name="l02538"></a>02538 
<a name="l02539"></a>02539     <span class="comment">//Export OpenGL pixel to the data file        </span>
<a name="l02540"></a>02540         glReadPixels(0, 0, mWidth , <a class="code" href="class_open_g_l_form_1_1_c_open_g_l.html#a7bc3d9b1f8036a70a3312fabf2337805" title="Width and Height of the OpenGL Window.">mHeight</a>, GL_BGR_EXT, GL_UNSIGNED_BYTE, data-&gt;Scan0.ToPointer());
<a name="l02541"></a>02541  
<a name="l02542"></a>02542     <span class="comment">//Move data to bmp and rotate it</span>
<a name="l02543"></a>02543         bmp-&gt;UnlockBits(data);
<a name="l02544"></a>02544     bmp-&gt;RotateFlip(RotateFlipType::RotateNoneFlipY);
<a name="l02545"></a>02545         
<a name="l02546"></a>02546     <span class="keywordflow">return</span> bmp;
<a name="l02547"></a>02547 }
<a name="l02548"></a>02548 
<a name="l02549"></a>02549 
<a name="l02550"></a>02550 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Sat Apr 25 2015 18:33:56 for Spinach GUI by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
