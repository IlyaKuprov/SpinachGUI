<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Spinach GUI: Z:/SpinachGUI/GUI/IO Formats/Gauss.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>Z:/SpinachGUI/GUI/IO Formats/Gauss.cpp</h1>  </div>
</div>
<div class="contents">
<a href="_gauss_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &quot;../StdAfx.h&quot;</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include &quot;<a class="code" href="_gauss_8h.html">Gauss.h</a>&quot;</span>
<a name="l00003"></a>00003 
<a name="l00004"></a>00004 <span class="keyword">using namespace </span>System;
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 <span class="comment">//Definitions</span>
<a name="l00007"></a><a class="code" href="_gauss_8cpp.html#a5cbb61ec3949904f6d01991168849abf">00007</a> <span class="preprocessor">#define InteractionCollection  SystemModel-&gt;InteractionCollection</span>
<a name="l00008"></a><a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">00008</a> <span class="preprocessor"></span><span class="preprocessor">#define AtomCollection  SystemModel-&gt;AtomCollection</span>
<a name="l00009"></a>00009 <span class="preprocessor"></span>
<a name="l00010"></a>00010 <span class="comment">//Definitions of keywords-phrases found in this format</span>
<a name="l00011"></a><a class="code" href="_gauss_8cpp.html#a1bb702f965bf06d3842c6b612abfa014">00011</a> <span class="preprocessor">#define CMD_ISOTOPES1                     &quot;Multiplicity =&quot;//</span>
<a name="l00012"></a><a class="code" href="_gauss_8cpp.html#addc928a467002e4353ac08409f106ecd">00012</a> <span class="preprocessor"></span><span class="preprocessor">#define CMD_ISOTOPES2                 &quot;Distance matrix (angstroms):&quot;//</span>
<a name="l00013"></a><a class="code" href="_gauss_8cpp.html#a6baaf0218fe07fe2edf2786240c91a8c">00013</a> <span class="preprocessor"></span><span class="preprocessor">#define CMD_COORDINATES1          &quot;Standard orientation:&quot;//</span>
<a name="l00014"></a><a class="code" href="_gauss_8cpp.html#aab223ab00e3899df3129cf62c6c4d6d3">00014</a> <span class="preprocessor"></span><span class="preprocessor">#define CMD_COORDINATES2          &quot;Input orientation:&quot;//</span>
<a name="l00015"></a><a class="code" href="_gauss_8cpp.html#a8de9b7e31ab51251c0f4f1abe9065e02">00015</a> <span class="preprocessor"></span><span class="preprocessor">#define CMD_GTENSOR               &quot;g tensor [g = g_e + g_RMC + g_DC + g_OZ/SOC]:&quot;</span>
<a name="l00016"></a><a class="code" href="_gauss_8cpp.html#a38f77315e44ba1aa558ec85d85b9a053">00016</a> <span class="preprocessor"></span><span class="preprocessor">#define CMD_CSTENSOR              &quot;SCF GIAO Magnetic shielding tensor (ppm):&quot;//</span>
<a name="l00017"></a><a class="code" href="_gauss_8cpp.html#a65326e9a00a000b17dea69e0dd2b063a">00017</a> <span class="preprocessor"></span><span class="preprocessor">#define CMD_JCOUPLINGS            &quot;Total nuclear spin-spin coupling J (Hz):&quot;//</span>
<a name="l00018"></a><a class="code" href="_gauss_8cpp.html#ac7d2340c0fdce028e690c2fb73e9e277">00018</a> <span class="preprocessor"></span><span class="preprocessor">#define CMD_ISOCOUPLINGS          &quot;Isotropic Fermi Contact Couplings&quot;</span>
<a name="l00019"></a><a class="code" href="_gauss_8cpp.html#ac30b6f015a4ac764dc8661f66076e6ec">00019</a> <span class="preprocessor"></span><span class="preprocessor">#define CMD_ANISCOUPLINGS         &quot;Anisotropic Spin Dipole Couplings in Principal Axis System&quot;</span>
<a name="l00020"></a><a class="code" href="_gauss_8cpp.html#afe34f2eee4e20974b93d1158a0bc1862">00020</a> <span class="preprocessor"></span><span class="preprocessor">#define CMD_QUADCOUPLINGS         &quot;Nuclear quadrupole coupling constants [Chi] (MHz):&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00022"></a>00022 <span class="comment">/**</span>
<a name="l00023"></a>00023 <span class="comment">*\file Gauss.cpp</span>
<a name="l00024"></a>00024 <span class="comment">*/</span>
<a name="l00025"></a>00025 <span class="comment"></span>
<a name="l00026"></a>00026 <span class="comment">/**</span>
<a name="l00027"></a>00027 <span class="comment">* @brief Constructor of Gauss format</span>
<a name="l00028"></a>00028 <span class="comment">* @param filename Name of the file to be read.</span>
<a name="l00029"></a>00029 <span class="comment">* @param model The model where the imported data will be saved.</span>
<a name="l00030"></a>00030 <span class="comment">*/</span>
<a name="l00031"></a>00031 <a class="code" href="class_gauss.html#aa87fa3b33f6366328dfd13291293e0f8">Gauss::Gauss</a>(System::String^ filename, <a class="code" href="class_model.html">Model</a>^% model)
<a name="l00032"></a>00032 {
<a name="l00033"></a>00033         SystemModel=model;
<a name="l00034"></a>00034         FileName=filename;
<a name="l00035"></a>00035         ReadingFile = <span class="keyword">gcnew</span> StreamReader(filename);
<a name="l00036"></a>00036         IsotropicCollection=<span class="keyword">gcnew</span> ArrayList();
<a name="l00037"></a>00037         Elements= <span class="keyword">gcnew</span> ArrayList();
<a name="l00038"></a>00038         Mass= <span class="keyword">gcnew</span> ArrayList();
<a name="l00039"></a>00039         FormatName=<span class="stringliteral">&quot;Gauss&quot;</span>;
<a name="l00040"></a>00040 }
<a name="l00041"></a>00041 <span class="comment"></span>
<a name="l00042"></a>00042 <span class="comment">/**</span>
<a name="l00043"></a>00043 <span class="comment">* @brief Main function for opening and reading file</span>
<a name="l00044"></a>00044 <span class="comment">* @return Returns false if the format does not seem to be correct.</span>
<a name="l00045"></a>00045 <span class="comment">*/</span>
<a name="l00046"></a><a class="code" href="class_gauss.html#a5c09c8b244a0a2b2f3f0e165ef77fc91">00046</a> <span class="keywordtype">bool</span> <a class="code" href="class_gauss.html#a5c09c8b244a0a2b2f3f0e165ef77fc91" title="Main function for opening and reading file.">Gauss::LoadFile</a>(<span class="keywordtype">void</span>)
<a name="l00047"></a>00047 {
<a name="l00048"></a>00048  String^ Command=<span class="keyword">gcnew</span> String(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00049"></a>00049  <span class="keywordtype">bool</span>  OK = <span class="keyword">true</span>;
<a name="l00050"></a>00050 
<a name="l00051"></a>00051  <span class="comment">//Initializing flags to false, meaning that no any frame was yet read</span>
<a name="l00052"></a>00052  <a class="code" href="class_gauss.html#a7993228e01007ae09fc19f667c31a486" title="Flag for checking if multiple frames is being read for coordinates.">read_onceCO</a>=<span class="keyword">false</span>;
<a name="l00053"></a>00053  <a class="code" href="class_gauss.html#afde4fd23393bd06351acbeaa60a4b189" title="Flag for checking if multiple frames is being read for Chemical shifts.">read_onceCS</a>=<span class="keyword">false</span>;
<a name="l00054"></a>00054  <a class="code" href="class_gauss.html#a219e5b6f9ba9975c3c868cb9a51a06e2" title="Flag for checking if multiple frames is being read for j-couplings.">read_onceJC</a>=<span class="keyword">false</span>;
<a name="l00055"></a>00055  <a class="code" href="class_gauss.html#a5848025f42a6fbadd7a116fa4e5ca9cc" title="Flag for checking if multiple frames is being read for isotropic factors.">read_onceISO</a>=<span class="keyword">false</span>;
<a name="l00056"></a>00056  <a class="code" href="class_gauss.html#af44bf9c137f8841bf717ecd5e3763faf" title="Flag for checking if multiple frames is being read for anisotropic factors.">read_onceANI</a>=<span class="keyword">false</span>;
<a name="l00057"></a>00057  <a class="code" href="class_gauss.html#a763752bd14a2b1fcaab01c4d86fd9ddb" title="Flag for checking if multiple frames is being read for g-tesnors.">read_onceGT</a>=<span class="keyword">false</span>;
<a name="l00058"></a>00058  <a class="code" href="class_gauss.html#a000d482185a05fc4d4bb9e5e05672263" title="Flag for checking if multiple frames is being read for quadropolar couplings.">read_onceQC</a>=<span class="keyword">false</span>;
<a name="l00059"></a>00059 
<a name="l00060"></a>00060  <span class="comment">//Turn off Refreshing for faster importing</span>
<a name="l00061"></a>00061  <a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>-&gt;Refreshing=<span class="keyword">false</span>;
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 
<a name="l00064"></a>00064  <span class="comment">//Read the file</span>
<a name="l00065"></a>00065  <span class="keywordflow">while</span> (!<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a02eb5f8efccd91a84ea7c427613ddce3" title="The stream that has the file which will be read.">ReadingFile</a>-&gt;EndOfStream  &amp;&amp; OK )
<a name="l00066"></a>00066  {
<a name="l00067"></a>00067          Command= <a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>() ;
<a name="l00068"></a>00068 
<a name="l00069"></a>00069          <span class="comment">//Reading different sections of the file according to keywords-phrases</span>
<a name="l00070"></a>00070          <span class="keywordflow">if</span>(OK)
<a name="l00071"></a>00071          {
<a name="l00072"></a>00072                  <span class="comment">//Read isotopes</span>
<a name="l00073"></a>00073                  <span class="keywordflow">if</span> (Command-&gt;Contains(<a class="code" href="_gauss_8cpp.html#a1bb702f965bf06d3842c6b612abfa014">CMD_ISOTOPES1</a>))  
<a name="l00074"></a>00074                  { 
<a name="l00075"></a>00075                          OK=<a class="code" href="class_gauss.html#afbda91eff39b3474f2663af2b767ce8a" title="Main function for opening isotope section and save the elements and mass numbers if exist...">read_ISOTOPES1</a>();
<a name="l00076"></a>00076                  }<span class="comment">//Read isotopes - alternative syntax</span>
<a name="l00077"></a>00077                  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Command-&gt;Contains(<a class="code" href="_gauss_8cpp.html#addc928a467002e4353ac08409f106ecd">CMD_ISOTOPES2</a>))     
<a name="l00078"></a>00078                  {
<a name="l00079"></a>00079                          OK=<a class="code" href="class_gauss.html#aed0fce131672ec670acd20d89b21f7d5" title="Alternative function for opening isotope section and save the elements and mass numbers if exist...">read_ISOTOPES2</a>();
<a name="l00080"></a>00080                  } <span class="comment">//Read coordinates</span>
<a name="l00081"></a>00081                  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Command-&gt;Contains(<a class="code" href="_gauss_8cpp.html#a6baaf0218fe07fe2edf2786240c91a8c">CMD_COORDINATES1</a>) || Command-&gt;Contains(<a class="code" href="_gauss_8cpp.html#aab223ab00e3899df3129cf62c6c4d6d3">CMD_COORDINATES2</a>))   
<a name="l00082"></a>00082                  { 
<a name="l00083"></a>00083                          OK=<a class="code" href="class_gauss.html#a43fd8214ef8b74422fd8a9fc385c1ef2" title="Main function for reading coordinates and add atoms in the collection.">read_COORDINATES</a>(); 
<a name="l00084"></a>00084                          <a class="code" href="class_gauss.html#a7993228e01007ae09fc19f667c31a486" title="Flag for checking if multiple frames is being read for coordinates.">read_onceCO</a>=<span class="keyword">true</span>; <span class="comment">//read at least once</span>
<a name="l00085"></a>00085                  }      <span class="comment">//Read g-tensors</span>
<a name="l00086"></a>00086                  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Command-&gt;Contains(<a class="code" href="_gauss_8cpp.html#a8de9b7e31ab51251c0f4f1abe9065e02">CMD_GTENSOR</a>)) 
<a name="l00087"></a>00087                  {
<a name="l00088"></a>00088                          OK=<a class="code" href="class_gauss.html#ac0da12c4d6300fc6d2ece76efc78bb6d" title="Main function for reading G-tesnor from the file.">read_GTENSOR</a>();
<a name="l00089"></a>00089                          <a class="code" href="class_gauss.html#a763752bd14a2b1fcaab01c4d86fd9ddb" title="Flag for checking if multiple frames is being read for g-tesnors.">read_onceGT</a>=<span class="keyword">true</span>;  <span class="comment">//read at least once</span>
<a name="l00090"></a>00090                  } <span class="comment">//Read Chemical Shields</span>
<a name="l00091"></a>00091                  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Command-&gt;Contains(<a class="code" href="_gauss_8cpp.html#a38f77315e44ba1aa558ec85d85b9a053">CMD_CSTENSOR</a>)) 
<a name="l00092"></a>00092                  {
<a name="l00093"></a>00093                          OK=<a class="code" href="class_gauss.html#abb6fdfc6fe30b908a02d551dee52ed7a" title="Main function for reading Chemical shieldings from the file.">read_CSTENSOR</a>();
<a name="l00094"></a>00094                          <a class="code" href="class_gauss.html#afde4fd23393bd06351acbeaa60a4b189" title="Flag for checking if multiple frames is being read for Chemical shifts.">read_onceCS</a>=<span class="keyword">true</span>; <span class="comment">//read at least once</span>
<a name="l00095"></a>00095                  } <span class="comment">//Read j-couplings</span>
<a name="l00096"></a>00096                  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Command-&gt;Contains(<a class="code" href="_gauss_8cpp.html#a65326e9a00a000b17dea69e0dd2b063a">CMD_JCOUPLINGS</a>)) 
<a name="l00097"></a>00097                  {
<a name="l00098"></a>00098                          OK=<a class="code" href="class_gauss.html#a51254d8385541e17552e4b180c682a1d" title="Main function for reading J-Couplings from the file.">read_JCOUPLINGS</a>();
<a name="l00099"></a>00099                          <a class="code" href="class_gauss.html#a219e5b6f9ba9975c3c868cb9a51a06e2" title="Flag for checking if multiple frames is being read for j-couplings.">read_onceJC</a>=<span class="keyword">true</span>; <span class="comment">//read at least once</span>
<a name="l00100"></a>00100                  } <span class="comment">//Read isotropic factors</span>
<a name="l00101"></a>00101                  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Command-&gt;Contains(<a class="code" href="_gauss_8cpp.html#ac7d2340c0fdce028e690c2fb73e9e277">CMD_ISOCOUPLINGS</a>)) 
<a name="l00102"></a>00102                  {
<a name="l00103"></a>00103                          OK=<a class="code" href="class_gauss.html#a679d98a7e3eae4e1f93034bdd91c790b" title="Function for reading isotropic factors for each atom to used for hyperfine couplings later...">read_ISOCOUPLINGS</a>();
<a name="l00104"></a>00104                          <a class="code" href="class_gauss.html#a5848025f42a6fbadd7a116fa4e5ca9cc" title="Flag for checking if multiple frames is being read for isotropic factors.">read_onceISO</a>=<span class="keyword">true</span>; <span class="comment">//read at least once</span>
<a name="l00105"></a>00105                  } <span class="comment">//Read Quadrupolar couplings</span>
<a name="l00106"></a>00106                  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Command-&gt;Contains(<a class="code" href="_gauss_8cpp.html#afe34f2eee4e20974b93d1158a0bc1862">CMD_QUADCOUPLINGS</a>)) 
<a name="l00107"></a>00107                  {
<a name="l00108"></a>00108                          OK=<a class="code" href="class_gauss.html#ac86ddd5a0b87e15d6d80acba29b302e7" title="Main function for reading Quadrupolar interactions from the file.">read_QUADCOUPLINGS</a>();
<a name="l00109"></a>00109                          <a class="code" href="class_gauss.html#a000d482185a05fc4d4bb9e5e05672263" title="Flag for checking if multiple frames is being read for quadropolar couplings.">read_onceQC</a>=<span class="keyword">true</span>; <span class="comment">//read at least once</span>
<a name="l00110"></a>00110                  } <span class="comment">//Read anisotropic couplings for hfc</span>
<a name="l00111"></a>00111                  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Command-&gt;Contains(<a class="code" href="_gauss_8cpp.html#ac30b6f015a4ac764dc8661f66076e6ec">CMD_ANISCOUPLINGS</a>)) 
<a name="l00112"></a>00112                  {
<a name="l00113"></a>00113                          OK=<a class="code" href="class_gauss.html#a261475e940fc2879d05409c2104a3db2" title="Main function for reading Anisotropic eigenvalues and DCMs and save them as spin rotation couplings i...">read_ANISCOUPLINGS</a>();
<a name="l00114"></a>00114                          <a class="code" href="class_gauss.html#af44bf9c137f8841bf717ecd5e3763faf" title="Flag for checking if multiple frames is being read for anisotropic factors.">read_onceANI</a>=<span class="keyword">true</span>; <span class="comment">//read at least once</span>
<a name="l00115"></a>00115                  }
<a name="l00116"></a>00116 
<a name="l00117"></a>00117          };
<a name="l00118"></a>00118 
<a name="l00119"></a>00119          <span class="comment">//Wrong format inside senctions</span>
<a name="l00120"></a>00120          <span class="keywordflow">if</span>(!OK) <span class="keywordflow">throw</span> <span class="keyword">gcnew</span> Exception(<span class="stringliteral">&quot;Problem in Reading File in Line &quot;</span>+<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a56538396531460cfa299d12a89421c97" title="Function that returns the last line that was read.">LineCount</a>+<span class="stringliteral">&quot;.&quot;</span>) ;
<a name="l00121"></a>00121  };
<a name="l00122"></a>00122 
<a name="l00123"></a>00123  <span class="comment">// Check if Gaussian format, at least one of the section to be read</span>
<a name="l00124"></a>00124  <span class="keywordflow">if</span>(!(<a class="code" href="class_gauss.html#a7993228e01007ae09fc19f667c31a486" title="Flag for checking if multiple frames is being read for coordinates.">read_onceCO</a> || <a class="code" href="class_gauss.html#a763752bd14a2b1fcaab01c4d86fd9ddb" title="Flag for checking if multiple frames is being read for g-tesnors.">read_onceGT</a> || <a class="code" href="class_gauss.html#afde4fd23393bd06351acbeaa60a4b189" title="Flag for checking if multiple frames is being read for Chemical shifts.">read_onceCS</a> ||
<a name="l00125"></a>00125          <a class="code" href="class_gauss.html#a219e5b6f9ba9975c3c868cb9a51a06e2" title="Flag for checking if multiple frames is being read for j-couplings.">read_onceJC</a> || <a class="code" href="class_gauss.html#a5848025f42a6fbadd7a116fa4e5ca9cc" title="Flag for checking if multiple frames is being read for isotropic factors.">read_onceISO</a> || <a class="code" href="class_gauss.html#a000d482185a05fc4d4bb9e5e05672263" title="Flag for checking if multiple frames is being read for quadropolar couplings.">read_onceQC</a> || <a class="code" href="class_gauss.html#af44bf9c137f8841bf717ecd5e3763faf" title="Flag for checking if multiple frames is being read for anisotropic factors.">read_onceANI</a>)) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00126"></a>00126 
<a name="l00127"></a>00127 
<a name="l00128"></a>00128  <span class="comment">//Compine isotropic factor and anisotropic coupligs to create HFC</span>
<a name="l00129"></a>00129  <span class="keywordflow">if</span>(<a class="code" href="class_gauss.html#af44bf9c137f8841bf717ecd5e3763faf" title="Flag for checking if multiple frames is being read for anisotropic factors.">read_onceANI</a> &amp;&amp; <a class="code" href="class_gauss.html#a5848025f42a6fbadd7a116fa4e5ca9cc" title="Flag for checking if multiple frames is being read for isotropic factors.">read_onceISO</a>)
<a name="l00130"></a>00130  {
<a name="l00131"></a>00131          <span class="keywordtype">int</span> electronindex;
<a name="l00132"></a>00132 
<a name="l00133"></a>00133          <span class="comment">//If not any electron, create one and a gtensor</span>
<a name="l00134"></a>00134          <span class="keywordflow">if</span>(<a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>-&gt;get_electron_number()&lt;1)
<a name="l00135"></a>00135          {
<a name="l00136"></a>00136                  <span class="comment">//Create electron</span>
<a name="l00137"></a>00137                  <a class="code" href="class_atom.html">Atom</a>^ nAtom=<span class="keyword">gcnew</span> <a class="code" href="class_atom.html">Atom</a>();
<a name="l00138"></a>00138                  nAtom-&gt;<a class="code" href="class_atom.html#a14a6785b5d26d50fe23d617c95b2585d" title="Property isotope of the atom.">isotope</a>=<a class="code" href="class_isotopes.html#a5d8772910912cbc6667f066a2a8ef531" title="Function for finding the isotope when one of the element, atom number or mass is given.">Isotopes::FindIsotope</a>(<span class="stringliteral">&quot;e&quot;</span>,0, 0); 
<a name="l00139"></a>00139                  nAtom-&gt;<a class="code" href="class_atom.html#a9adaaa1c67caa251c7c3f9b5753cfced" title="Property x coordinate position of the atom.">X</a>=0.0f;
<a name="l00140"></a>00140                  nAtom-&gt;<a class="code" href="class_atom.html#ad121a01910fb0f6511a963de4d89460d" title="Property y coordinate position of the atom.">Y</a>=0.0f;
<a name="l00141"></a>00141                  nAtom-&gt;<a class="code" href="class_atom.html#aa0c17b25aa4c710115c74b173c756a9b" title="Property z coordinate position of the atom.">Z</a>=0.0f;
<a name="l00142"></a>00142 
<a name="l00143"></a>00143                  <span class="comment">//Add electron to collection</span>
<a name="l00144"></a>00144                  <a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>-&gt;Add(nAtom);
<a name="l00145"></a>00145 
<a name="l00146"></a>00146                  <span class="comment">//Save the ID of the electron</span>
<a name="l00147"></a>00147                  electronindex=nAtom-&gt;<a class="code" href="class_atom.html#a542c13cf22cab7bebec4f53198586434" title="Getter for the atom ID.">getID</a>();
<a name="l00148"></a>00148 
<a name="l00149"></a>00149                  <span class="comment">//Create gtensor</span><a class="code" href="class_spinach_g_u_i_1_1_matrix3x3.html"></a>
<a name="l00150"></a>00150 <a class="code" href="class_spinach_g_u_i_1_1_matrix3x3.html">		 ::Matrix3x3</a> ^g_tensor=gcnew ::Matrix3x3();
<a name="l00151"></a>00151                  g_tensor[0]=2.0023f; g_tensor[4]=2.0023f;g_tensor[8]=2.0023f;
<a name="l00152"></a>00152                  g_tensor[1]=0.0f; g_tensor[2]=0.0f; g_tensor[3]=0.0f; 
<a name="l00153"></a>00153                  g_tensor[5]=0.0f; g_tensor[6]=0.0f; g_tensor[7]=0.0f;
<a name="l00154"></a>00154 
<a name="l00155"></a>00155 
<a name="l00156"></a>00156                  <span class="comment">//Try to create new Interaction</span>
<a name="l00157"></a>00157                  <a class="code" href="class_tensor.html">Tensor</a>^ nInteraction;
<a name="l00158"></a>00158                  <span class="keywordflow">try</span>{
<a name="l00159"></a>00159                          nInteraction=<span class="keyword">gcnew</span> <a class="code" href="class_tensor.html">Tensor</a>(nAtom, nAtom,
<a name="l00160"></a>00160                                  <a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8ea002c54e14f8b8cc5a33e76e39d67a6a0">InteractionKind::GTensor</a>, g_tensor);
<a name="l00161"></a>00161                          nInteraction-&gt;<a class="code" href="class_interaction.html#af0b4df61d751c1ddffbfa70843e0c7db" title="Property unit for giving or setting the unit of the interaction.">unit</a>=<a class="code" href="class_units.html#aefde252771ce6c48781414a0ea4aee78">Units::Mi_b</a>;
<a name="l00162"></a>00162                          nInteraction-&gt;<a class="code" href="class_tensor.html#a297aa3cd96e646ffaed3d4547e23ebcb" title="Property matrix3x3 for giving or setting the matrix of the tensor of the interaction.">Frame</a>=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a16ab6e7e7d34bd4bb7d0d32b59f6770a" title="Main function for opening and reading file.">SystemModel</a>-&gt;<a class="code" href="class_model.html#adc069c415325e10c5c452421d0578564" title="The collection of reference frames in the model.">RefFrameCollection</a>[1];
<a name="l00163"></a>00163                  }<span class="comment">//Throws when an invalid interaction is tried to create.</span>
<a name="l00164"></a>00164                  <span class="keywordflow">catch</span>(Exception ^ e)  
<a name="l00165"></a>00165                  { 
<a name="l00166"></a>00166                          <span class="keywordflow">throw</span> <span class="keyword">gcnew</span> Exception(<span class="stringliteral">&quot;Problem in creating gtensor&quot;</span>+e-&gt;Message
<a name="l00167"></a>00167                                  +<span class="stringliteral">&quot;. Problem in Reading File in Line:&quot;</span>+<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8d12e89896c32976b9c28899370b3835">getLineStop</a>()+<span class="stringliteral">&quot; .&quot;</span>);
<a name="l00168"></a>00168                  };
<a name="l00169"></a>00169 
<a name="l00170"></a>00170                  <span class="comment">//Add interaction to collection</span>
<a name="l00171"></a>00171                  <a class="code" href="_gauss_8cpp.html#a5cbb61ec3949904f6d01991168849abf">InteractionCollection</a>-&gt;Add(nInteraction);
<a name="l00172"></a>00172 
<a name="l00173"></a>00173          }
<a name="l00174"></a>00174          <span class="keywordflow">else</span> <span class="comment">//find alectron and save its ID</span>
<a name="l00175"></a>00175                  <span class="keywordflow">for each</span>(<span class="keywordtype">int</span> i <span class="keywordflow">in</span> <a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>-&gt;Keys) 
<a name="l00176"></a>00176                          <span class="keywordflow">if</span>(((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>[i])-&gt;isotope-&gt;Element==<span class="stringliteral">&quot;e&quot;</span>) electronindex=i;
<a name="l00177"></a>00177 
<a name="l00178"></a>00178 
<a name="l00179"></a>00179          <span class="keywordtype">int</span> jj=0;
<a name="l00180"></a>00180 
<a name="l00181"></a>00181          <span class="comment">//Loop over all interactions</span>
<a name="l00182"></a>00182          <span class="keywordflow">for each</span>(<span class="keywordtype">int</span> i <span class="keywordflow">in</span> <span class="keyword">gcnew</span> List&lt;int&gt;(<a class="code" href="_gauss_8cpp.html#a5cbb61ec3949904f6d01991168849abf">InteractionCollection</a>-&gt;Keys)) 
<a name="l00183"></a>00183          {
<a name="l00184"></a>00184                  <span class="comment">//Find the spin rotations in order to change them to HFC</span>
<a name="l00185"></a>00185                  <span class="keywordflow">if</span>(((<a class="code" href="class_interaction.html">Interaction</a> ^)<a class="code" href="_gauss_8cpp.html#a5cbb61ec3949904f6d01991168849abf">InteractionCollection</a>[i])-&gt;IntKind==<a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8ea01b2976fe0597f878c70ed5188fd133e">InteractionKind::spinrotation</a>)
<a name="l00186"></a>00186                  {<a class="code" href="class_spinach_g_u_i_1_1_matrix3x3.html"></a>
<a name="l00187"></a>00187 <a class="code" href="class_spinach_g_u_i_1_1_matrix3x3.html">			 ::Matrix3x3</a> ^ HF_Couplings=gcnew ::Matrix3x3();
<a name="l00188"></a>00188 
<a name="l00189"></a>00189                          <span class="comment">//The interaction matrix of HFC is the anistropix part </span>
<a name="l00190"></a>00190                          <span class="comment">//plus the istropic factor in the diagonal elements</span>
<a name="l00191"></a>00191                          HF_Couplings=((<a class="code" href="class_tensor.html">Tensor</a> ^)<a class="code" href="_gauss_8cpp.html#a5cbb61ec3949904f6d01991168849abf">InteractionCollection</a>[i])-&gt;matrix3x3;
<a name="l00192"></a>00192                          HF_Couplings[0]+=(double)<a class="code" href="class_gauss.html#a628ed7af9de11be3f0e252fecfe7c043" title="Array that saves the isotropic factors.">IsotropicCollection</a>[jj];
<a name="l00193"></a>00193                          HF_Couplings[4]+=(double)<a class="code" href="class_gauss.html#a628ed7af9de11be3f0e252fecfe7c043" title="Array that saves the isotropic factors.">IsotropicCollection</a>[jj];
<a name="l00194"></a>00194                          HF_Couplings[8]+=(double)<a class="code" href="class_gauss.html#a628ed7af9de11be3f0e252fecfe7c043" title="Array that saves the isotropic factors.">IsotropicCollection</a>[jj];
<a name="l00195"></a>00195 
<a name="l00196"></a>00196                          <span class="comment">//Try to create new Interaction</span>
<a name="l00197"></a>00197                          <a class="code" href="class_tensor.html">Tensor</a>^ nInteraction;
<a name="l00198"></a>00198                          <span class="keywordflow">try</span>{
<a name="l00199"></a>00199                                  nInteraction=<span class="keyword">gcnew</span> <a class="code" href="class_tensor.html">Tensor</a>(((<a class="code" href="class_interaction.html">Interaction</a> ^)<a class="code" href="_gauss_8cpp.html#a5cbb61ec3949904f6d01991168849abf">InteractionCollection</a>[i])-&gt;A , 
<a name="l00200"></a>00200                                          (<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>[electronindex],
<a name="l00201"></a>00201                                          <a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8eaa963e6070e2708404c83781a60a9e823">InteractionKind::HFC</a>, 
<a name="l00202"></a>00202                                          HF_Couplings);
<a name="l00203"></a>00203                                  nInteraction-&gt;<a class="code" href="class_interaction.html#af0b4df61d751c1ddffbfa70843e0c7db" title="Property unit for giving or setting the unit of the interaction.">unit</a>=<a class="code" href="class_units.html#afa8199bb56a18f4b9bc05a143645a068">Units::Gauss</a>;
<a name="l00204"></a>00204                                  nInteraction-&gt;<a class="code" href="class_tensor.html#a297aa3cd96e646ffaed3d4547e23ebcb" title="Property matrix3x3 for giving or setting the matrix of the tensor of the interaction.">Frame</a>=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a16ab6e7e7d34bd4bb7d0d32b59f6770a" title="Main function for opening and reading file.">SystemModel</a>-&gt;<a class="code" href="class_model.html#adc069c415325e10c5c452421d0578564" title="The collection of reference frames in the model.">RefFrameCollection</a>[1];
<a name="l00205"></a>00205                          }<span class="comment">//Throws when an invalid interaction is tried to create.</span>
<a name="l00206"></a>00206                          <span class="keywordflow">catch</span>(Exception ^ e)  
<a name="l00207"></a>00207                          { 
<a name="l00208"></a>00208                                  <span class="keywordflow">throw</span> <span class="keyword">gcnew</span> Exception(<span class="stringliteral">&quot;Problem in creating gtensor&quot;</span>+e-&gt;Message
<a name="l00209"></a>00209                                          +<span class="stringliteral">&quot;. Problem in Reading File in Line:&quot;</span>+<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8d12e89896c32976b9c28899370b3835">getLineStop</a>()+<span class="stringliteral">&quot; .&quot;</span>);
<a name="l00210"></a>00210                          };
<a name="l00211"></a>00211 
<a name="l00212"></a>00212                          <span class="comment">//Try to replace existing interaction with new HFC</span>
<a name="l00213"></a>00213                          <span class="keywordflow">try</span>{<a class="code" href="_gauss_8cpp.html#a5cbb61ec3949904f6d01991168849abf">InteractionCollection</a>[i]=nInteraction; jj++;}
<a name="l00214"></a>00214                          <span class="keywordflow">catch</span>(String ^ e)  {<span class="keywordflow">throw</span> <span class="keyword">gcnew</span> Exception(<span class="stringliteral">&quot;Problem in Elements: &quot;</span>+e);}
<a name="l00215"></a>00215                  };
<a name="l00216"></a>00216          };
<a name="l00217"></a>00217  };
<a name="l00218"></a>00218 
<a name="l00219"></a>00219  <span class="comment">//Turn on again Refreshing which causes calculation of bonds</span>
<a name="l00220"></a>00220  <a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>-&gt;Refreshing=<span class="keyword">true</span>;
<a name="l00221"></a>00221  <a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a02eb5f8efccd91a84ea7c427613ddce3" title="The stream that has the file which will be read.">ReadingFile</a>-&gt;Close();
<a name="l00222"></a>00222  <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00223"></a>00223 }
<a name="l00224"></a>00224 <span class="comment"></span>
<a name="l00225"></a>00225 <span class="comment">/**</span>
<a name="l00226"></a>00226 <span class="comment">* @brief Main function for opening  isotope section and save the elements and mass numbers if exist.</span>
<a name="l00227"></a>00227 <span class="comment">* @return Returns false if the format does not seem to be correct.</span>
<a name="l00228"></a>00228 <span class="comment">*/</span>
<a name="l00229"></a><a class="code" href="class_gauss.html#afbda91eff39b3474f2663af2b767ce8a">00229</a> <span class="keywordtype">bool</span> <a class="code" href="class_gauss.html#afbda91eff39b3474f2663af2b767ce8a" title="Main function for opening isotope section and save the elements and mass numbers if exist...">Gauss::read_ISOTOPES1</a>()
<a name="l00230"></a>00230 {
<a name="l00231"></a>00231 
<a name="l00232"></a>00232         <span class="keywordtype">int</span> number=1;   <span class="comment">//number of fields in the a line, here can be anything</span>
<a name="l00233"></a>00233         String^ fileline=<span class="keyword">gcnew</span> String(<span class="stringliteral">&quot;&quot;</span>); <span class="comment">//line</span>
<a name="l00234"></a>00234         array&lt;String^&gt;^numbers = <span class="keyword">nullptr</span>;   <span class="comment">// Matrix of the fields after splitting of a line</span>
<a name="l00235"></a>00235         String^ delimStr = <span class="stringliteral">&quot; ,&quot;</span>;            <span class="comment">//seperator of fields =</span>
<a name="l00236"></a>00236         array&lt;Char&gt;^delimiter = delimStr-&gt;ToCharArray(); <span class="comment">//Conversion to char array     </span>
<a name="l00237"></a>00237 
<a name="l00238"></a>00238         <span class="comment">//Sometimes next line contains the word symbolic, so ignore and read next line</span>
<a name="l00239"></a>00239         <span class="keywordflow">if</span>((fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>())-&gt;Contains(<span class="stringliteral">&quot;Symbolic&quot;</span>)) fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>();
<a name="l00240"></a>00240 
<a name="l00241"></a>00241         <span class="comment">//Read as long as they are more than zero fields in the line</span>
<a name="l00242"></a>00242         <span class="keywordflow">while</span> (!(fileline-&gt;Split(delimiter,StringSplitOptions::RemoveEmptyEntries)-&gt;Length&lt;1))
<a name="l00243"></a>00243         {
<a name="l00244"></a>00244                 <span class="comment">// C                     0.4865   -0.1848    1.3191   //</span>
<a name="l00245"></a>00245                 <span class="comment">//Split the line to a number of fields</span>
<a name="l00246"></a>00246                 numbers = <span class="keyword">nullptr</span>;
<a name="l00247"></a>00247                 numbers=fileline-&gt;Split(delimiter,StringSplitOptions::RemoveEmptyEntries );
<a name="l00248"></a>00248 
<a name="l00249"></a>00249                 <span class="comment">//Check if the number fields is correct</span>
<a name="l00250"></a>00250                 <span class="keywordflow">if</span>(number&gt;numbers-&gt;Length) 
<a name="l00251"></a>00251                 {
<a name="l00252"></a>00252                         <span class="keywordflow">throw</span> <span class="keyword">gcnew</span> Exception(<span class="stringliteral">&quot;Problem in Reading Isotope.&quot;</span>
<a name="l00253"></a>00253                                 +<span class="stringliteral">&quot; Problem in Reading File in Line: &quot;</span>+<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8d12e89896c32976b9c28899370b3835">getLineStop</a>()+<span class="stringliteral">&quot;.&quot;</span>) ;
<a name="l00254"></a>00254                 };
<a name="l00255"></a>00255 
<a name="l00256"></a>00256                 <span class="comment">//Change to capital, for sometims the first letter is not capital</span>
<a name="l00257"></a>00257                 Char^ cap=Char::ToUpper(numbers[0][0]);
<a name="l00258"></a>00258                 numbers[0]=cap+numbers[0]-&gt;Remove(0,1);
<a name="l00259"></a>00259 
<a name="l00260"></a>00260                 <span class="comment">//Add element to the element array</span>
<a name="l00261"></a>00261                 <a class="code" href="class_gauss.html#a23f542949be4a0962e87062a3e6f4301">Elements</a>-&gt;Add(numbers[0]);
<a name="l00262"></a>00262 
<a name="l00263"></a>00263                 <span class="comment">//Read next line</span>
<a name="l00264"></a>00264                 fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>();
<a name="l00265"></a>00265         };
<a name="l00266"></a>00266 
<a name="l00267"></a>00267         <span class="comment">//We create an array with masses. For the case of &quot; H(Iso=2) &quot; take this number a mass</span>
<a name="l00268"></a>00268         <span class="comment">//else mass of element zero.</span>
<a name="l00269"></a>00269         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="class_gauss.html#a23f542949be4a0962e87062a3e6f4301">Elements</a>-&gt;Count;i++)
<a name="l00270"></a>00270         {
<a name="l00271"></a>00271                 <span class="comment">//Put mass of isotope to  zero if eveything OK</span>
<a name="l00272"></a>00272                 <a class="code" href="class_gauss.html#a8bb535223a670f6bf0e0d64221637dba" title="Arrays that save elements and mass numbers.">Mass</a>-&gt;Add((Int32 ^)0);
<a name="l00273"></a>00273 
<a name="l00274"></a>00274                 <span class="comment">//Check every character in the string of the element</span>
<a name="l00275"></a>00275                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> jj=0;jj&lt;((String^)<a class="code" href="class_gauss.html#a23f542949be4a0962e87062a3e6f4301">Elements</a>[i])-&gt;Length;jj++)
<a name="l00276"></a>00276                 {
<a name="l00277"></a>00277                         <span class="comment">//In case of something is not a letter  or it is a number</span>
<a name="l00278"></a>00278                         <span class="keywordflow">if</span>(!Char::IsLetter(((String^)<a class="code" href="class_gauss.html#a23f542949be4a0962e87062a3e6f4301">Elements</a>[i])[jj]) ||
<a name="l00279"></a>00279                                 Char::IsDigit(((String^)<a class="code" href="class_gauss.html#a23f542949be4a0962e87062a3e6f4301">Elements</a>[i])[jj])) 
<a name="l00280"></a>00280                         {
<a name="l00281"></a>00281                                 <span class="comment">//Find if it contains the word Iso</span>
<a name="l00282"></a>00282                                 <span class="keywordflow">if</span>(((String^)<a class="code" href="class_gauss.html#a23f542949be4a0962e87062a3e6f4301">Elements</a>[i])-&gt;Substring(jj)-&gt;Contains(<span class="stringliteral">&quot;Iso&quot;</span>))
<a name="l00283"></a>00283                                 {
<a name="l00284"></a>00284                                         <span class="comment">//Find index of mass which is where &quot;Iso=&quot; ends</span>
<a name="l00285"></a>00285                                         <span class="keywordtype">int</span> num=((String^)<a class="code" href="class_gauss.html#a23f542949be4a0962e87062a3e6f4301">Elements</a>[i])-&gt;IndexOf(<span class="stringliteral">&quot;Iso&quot;</span>)+4;
<a name="l00286"></a>00286 
<a name="l00287"></a>00287                                         <span class="comment">//Create a substring from this index until the end</span>
<a name="l00288"></a>00288                                         String^ temp=((String^)<a class="code" href="class_gauss.html#a23f542949be4a0962e87062a3e6f4301">Elements</a>[i])-&gt;Substring(num);
<a name="l00289"></a>00289 
<a name="l00290"></a>00290                                         <span class="comment">//Find the first no number character and cut it until the end</span>
<a name="l00291"></a>00291                                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> tt=0; tt&lt;temp-&gt;Length;tt++)
<a name="l00292"></a>00292                                                 <span class="keywordflow">if</span>(!Char::IsDigit(temp[tt])) temp=temp-&gt;Substring(0,tt);
<a name="l00293"></a>00293 
<a name="l00294"></a>00294                                         <span class="comment">//Convert to number</span>
<a name="l00295"></a>00295                                         <a class="code" href="class_gauss.html#a8bb535223a670f6bf0e0d64221637dba" title="Arrays that save elements and mass numbers.">Mass</a>[i]=Int32::Parse(temp);
<a name="l00296"></a>00296                                 }
<a name="l00297"></a>00297 
<a name="l00298"></a>00298                                 <span class="comment">//At the end cut the rest string and keep the beginning only</span>
<a name="l00299"></a>00299                                 <a class="code" href="class_gauss.html#a23f542949be4a0962e87062a3e6f4301">Elements</a>[i]=((String^)<a class="code" href="class_gauss.html#a23f542949be4a0962e87062a3e6f4301">Elements</a>[i])-&gt;Substring(0,jj);
<a name="l00300"></a>00300                         }
<a name="l00301"></a>00301                 }
<a name="l00302"></a>00302         };
<a name="l00303"></a>00303 
<a name="l00304"></a>00304         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00305"></a>00305 }
<a name="l00306"></a>00306 
<a name="l00307"></a>00307 <span class="comment"></span>
<a name="l00308"></a>00308 <span class="comment">/**</span>
<a name="l00309"></a>00309 <span class="comment">* @brief Alternative function for opening  isotope section and save the elements</span>
<a name="l00310"></a>00310 <span class="comment">* and mass numbers if exist. At the end not used</span>
<a name="l00311"></a>00311 <span class="comment">* @return Returns false if the format does not seem to be correct.</span>
<a name="l00312"></a>00312 <span class="comment">*/</span>
<a name="l00313"></a><a class="code" href="class_gauss.html#aed0fce131672ec670acd20d89b21f7d5">00313</a> <span class="keywordtype">bool</span> <a class="code" href="class_gauss.html#aed0fce131672ec670acd20d89b21f7d5" title="Alternative function for opening isotope section and save the elements and mass numbers if exist...">Gauss::read_ISOTOPES2</a>()
<a name="l00314"></a>00314 {
<a name="l00315"></a>00315         <span class="keywordtype">int</span> j=0;
<a name="l00316"></a>00316         <span class="keywordtype">int</span> number=3;   <span class="comment">//number of fields in the a line</span>
<a name="l00317"></a>00317         String^ fileline=<span class="keyword">gcnew</span> String(<span class="stringliteral">&quot;&quot;</span>); <span class="comment">//line</span>
<a name="l00318"></a>00318         array&lt;String^&gt;^numbers = <span class="keyword">nullptr</span>;   <span class="comment">// Matrix of the fields after splitting of a line</span>
<a name="l00319"></a>00319         String^ delimStr = <span class="stringliteral">&quot; ,&quot;</span>;            <span class="comment">//seperator of fields=</span>
<a name="l00320"></a>00320         array&lt;Char&gt;^delimiter = delimStr-&gt;ToCharArray(); <span class="comment">//Conversion to char array     </span>
<a name="l00321"></a>00321         
<a name="l00322"></a>00322         <span class="comment">//                    1          2          3          4          5</span>
<a name="l00323"></a>00323         fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>();
<a name="l00324"></a>00324 
<a name="l00325"></a>00325         <span class="comment">//Read as long as they are thre or more fields in the line</span>
<a name="l00326"></a>00326         <span class="keywordflow">while</span> (!(fileline-&gt;Split(delimiter,StringSplitOptions::RemoveEmptyEntries)-&gt;Length&gt;2))
<a name="l00327"></a>00327         {
<a name="l00328"></a>00328                 <span class="comment">//1  C    0.000000</span>
<a name="l00329"></a>00329                 <span class="comment">//Split the line to a number of fields</span>
<a name="l00330"></a>00330                 numbers = <span class="keyword">nullptr</span>;
<a name="l00331"></a>00331                 numbers=fileline-&gt;Split(delimiter,StringSplitOptions::RemoveEmptyEntries );
<a name="l00332"></a>00332 
<a name="l00333"></a>00333                 <span class="comment">//Check if the numebr fields is correct</span>
<a name="l00334"></a>00334                 <span class="keywordflow">if</span>(number!=numbers-&gt;Length) 
<a name="l00335"></a>00335                 {
<a name="l00336"></a>00336                         <span class="keywordflow">throw</span> <span class="keyword">gcnew</span> Exception(<span class="stringliteral">&quot;Problem in Reading Isotope.&quot;</span>
<a name="l00337"></a>00337                                 +<span class="stringliteral">&quot; Problem in Reading File in Line: &quot;</span>+<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8d12e89896c32976b9c28899370b3835">getLineStop</a>()+<span class="stringliteral">&quot;.&quot;</span>) ;
<a name="l00338"></a>00338                 };
<a name="l00339"></a>00339 
<a name="l00340"></a>00340                 <span class="comment">//If elements and masses was not added in the arrays before,  add them now else overwrite them.</span>
<a name="l00341"></a>00341                 <span class="keywordflow">if</span>(++j==<a class="code" href="class_gauss.html#a23f542949be4a0962e87062a3e6f4301">Elements</a>-&gt;Count) 
<a name="l00342"></a>00342                 {
<a name="l00343"></a>00343                         <a class="code" href="class_gauss.html#a23f542949be4a0962e87062a3e6f4301">Elements</a>-&gt;Add(numbers[1]);
<a name="l00344"></a>00344                         <a class="code" href="class_gauss.html#a8bb535223a670f6bf0e0d64221637dba" title="Arrays that save elements and mass numbers.">Mass</a>-&gt;Add((Int32 ^)0);
<a name="l00345"></a>00345                 }
<a name="l00346"></a>00346                 <span class="keywordflow">else</span> 
<a name="l00347"></a>00347                 {
<a name="l00348"></a>00348                         <a class="code" href="class_gauss.html#a23f542949be4a0962e87062a3e6f4301">Elements</a>[j]=numbers[1];
<a name="l00349"></a>00349                         <a class="code" href="class_gauss.html#a8bb535223a670f6bf0e0d64221637dba" title="Arrays that save elements and mass numbers.">Mass</a>[j]=(Int32 ^)0;
<a name="l00350"></a>00350                 };
<a name="l00351"></a>00351 
<a name="l00352"></a>00352                 <span class="comment">//Read next line</span>
<a name="l00353"></a>00353                 fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>();
<a name="l00354"></a>00354         };
<a name="l00355"></a>00355 
<a name="l00356"></a>00356         <span class="comment">//We create an array with masses. For the case of &quot; H(Iso=2) &quot; take this number a mass</span>
<a name="l00357"></a>00357         <span class="comment">//else mass of element zero.</span>
<a name="l00358"></a>00358         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="class_gauss.html#a23f542949be4a0962e87062a3e6f4301">Elements</a>-&gt;Count;i++)
<a name="l00359"></a>00359         {
<a name="l00360"></a>00360                 <span class="comment">//Check every character in the string of the element</span>
<a name="l00361"></a>00361                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> jj=0;jj&lt;((String^)<a class="code" href="class_gauss.html#a23f542949be4a0962e87062a3e6f4301">Elements</a>[i])-&gt;Length;jj++)
<a name="l00362"></a>00362                 {
<a name="l00363"></a>00363                         <span class="comment">//In case of something is not a letter  or it is a number</span>
<a name="l00364"></a>00364                         <span class="keywordflow">if</span>(!Char::IsLetter(((String^)<a class="code" href="class_gauss.html#a23f542949be4a0962e87062a3e6f4301">Elements</a>[i])[jj]) ||
<a name="l00365"></a>00365                                 Char::IsDigit(((String^)<a class="code" href="class_gauss.html#a23f542949be4a0962e87062a3e6f4301">Elements</a>[i])[jj])) 
<a name="l00366"></a>00366                         {
<a name="l00367"></a>00367                                 <span class="comment">//Find if it contains the word Iso</span>
<a name="l00368"></a>00368                                 <span class="keywordflow">if</span>(((String^)<a class="code" href="class_gauss.html#a23f542949be4a0962e87062a3e6f4301">Elements</a>[i])-&gt;Substring(jj)-&gt;Contains(<span class="stringliteral">&quot;Iso&quot;</span>))
<a name="l00369"></a>00369                                 {
<a name="l00370"></a>00370                                         <span class="comment">//Find index of mass which is where &quot;Iso=&quot; ends</span>
<a name="l00371"></a>00371                                         <span class="keywordtype">int</span> num=((String^)<a class="code" href="class_gauss.html#a23f542949be4a0962e87062a3e6f4301">Elements</a>[i])-&gt;IndexOf(<span class="stringliteral">&quot;Iso&quot;</span>)+4;
<a name="l00372"></a>00372 
<a name="l00373"></a>00373                                         <span class="comment">//Create a substring from this index until the end</span>
<a name="l00374"></a>00374                                         String^ temp=((String^)<a class="code" href="class_gauss.html#a23f542949be4a0962e87062a3e6f4301">Elements</a>[i])-&gt;Substring(num);
<a name="l00375"></a>00375 
<a name="l00376"></a>00376                                         <span class="comment">//Find the first no number character and cut it until the end</span>
<a name="l00377"></a>00377                                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> tt=0; tt&lt;temp-&gt;Length;tt++)
<a name="l00378"></a>00378                                                 <span class="keywordflow">if</span>(!Char::IsDigit(temp[tt])) temp=temp-&gt;Substring(0,tt);
<a name="l00379"></a>00379 
<a name="l00380"></a>00380                                         <span class="comment">//Convert to number</span>
<a name="l00381"></a>00381                                         <a class="code" href="class_gauss.html#a8bb535223a670f6bf0e0d64221637dba" title="Arrays that save elements and mass numbers.">Mass</a>[i]=Int32::Parse(temp);
<a name="l00382"></a>00382                                 }
<a name="l00383"></a>00383 
<a name="l00384"></a>00384                                 <span class="comment">//At the end cut the rest string and keep the beginning only</span>
<a name="l00385"></a>00385                                 <a class="code" href="class_gauss.html#a23f542949be4a0962e87062a3e6f4301">Elements</a>[i]=((String^)<a class="code" href="class_gauss.html#a23f542949be4a0962e87062a3e6f4301">Elements</a>[i])-&gt;Substring(0,jj);
<a name="l00386"></a>00386                         }
<a name="l00387"></a>00387                 }
<a name="l00388"></a>00388         };
<a name="l00389"></a>00389 
<a name="l00390"></a>00390         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00391"></a>00391 }
<a name="l00392"></a>00392 <span class="comment"></span>
<a name="l00393"></a>00393 <span class="comment">/**</span>
<a name="l00394"></a>00394 <span class="comment">* @brief Main function for reading coordinates and add atoms in the collection</span>
<a name="l00395"></a>00395 <span class="comment">* @return Returns false if the format does not seem to be correct.</span>
<a name="l00396"></a>00396 <span class="comment">*/</span>
<a name="l00397"></a><a class="code" href="class_gauss.html#a43fd8214ef8b74422fd8a9fc385c1ef2">00397</a> <span class="keywordtype">bool</span> <a class="code" href="class_gauss.html#a43fd8214ef8b74422fd8a9fc385c1ef2" title="Main function for reading coordinates and add atoms in the collection.">Gauss::read_COORDINATES</a>()
<a name="l00398"></a>00398 {
<a name="l00399"></a>00399         <span class="keywordtype">int</span> number=6;   <span class="comment">//number of fileds in the a line</span>
<a name="l00400"></a>00400         <span class="keywordtype">double</span> value;  <span class="comment">//readedd value</span>
<a name="l00401"></a>00401         String^ fileline=<span class="keyword">gcnew</span> String(<span class="stringliteral">&quot;&quot;</span>); <span class="comment">//line</span>
<a name="l00402"></a>00402         <span class="keywordtype">int</span> AtomID=1;   
<a name="l00403"></a>00403         <span class="keywordtype">int</span> index=0;    <span class="comment">//Index for the elements array</span>
<a name="l00404"></a>00404         <span class="keywordtype">double</span> x,y,z;   <span class="comment">//Coordinates</span>
<a name="l00405"></a>00405 
<a name="l00406"></a>00406         array&lt;String^&gt;^numbers = <span class="keyword">nullptr</span>;   <span class="comment">// Matrix of the fields after splitting of a line</span>
<a name="l00407"></a>00407         String^ delimStr = <span class="stringliteral">&quot; ,=&quot;</span>;            <span class="comment">//seperator of fields</span>
<a name="l00408"></a>00408         array&lt;Char&gt;^delimiter = delimStr-&gt;ToCharArray(); <span class="comment">//Conversion to char array     </span>
<a name="l00409"></a>00409 
<a name="l00410"></a>00410         <span class="comment">// ---------------------------------------------------------------------</span>
<a name="l00411"></a>00411         <span class="comment">// Center     Atomic      Atomic             Coordinates (Angstroms)</span>
<a name="l00412"></a>00412         <span class="comment">// Number     Number       Type             X           Y           Z</span>
<a name="l00413"></a>00413         <span class="comment">// ---------------------------------------------------------------------</span>
<a name="l00414"></a>00414         fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>() ;
<a name="l00415"></a>00415         fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>() ;
<a name="l00416"></a>00416         fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>() ;
<a name="l00417"></a>00417         fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>() ;
<a name="l00418"></a>00418 
<a name="l00419"></a>00419         <span class="comment">//Read until end of section</span>
<a name="l00420"></a>00420         <span class="keywordflow">while</span> (!(fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>())-&gt;Contains(<span class="stringliteral">&quot;--------&quot;</span>))
<a name="l00421"></a>00421         {
<a name="l00422"></a>00422                 <span class="comment">//Split the line to a number of fields</span>
<a name="l00423"></a>00423                 numbers = <span class="keyword">nullptr</span>;
<a name="l00424"></a>00424                 numbers=fileline-&gt;Split(delimiter,StringSplitOptions::RemoveEmptyEntries );
<a name="l00425"></a>00425 
<a name="l00426"></a>00426                 <span class="comment">//Check if the numebr fields is correct</span>
<a name="l00427"></a>00427                 <span class="keywordflow">if</span>(number!=numbers-&gt;Length) 
<a name="l00428"></a>00428                 {
<a name="l00429"></a>00429                         <span class="keywordflow">throw</span> <span class="keyword">gcnew</span> Exception(<span class="stringliteral">&quot;Problem in Reading Coordinates.&quot;</span>
<a name="l00430"></a>00430                                 +<span class="stringliteral">&quot; Problem in Reading File in Line: &quot;</span>+<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8d12e89896c32976b9c28899370b3835">getLineStop</a>()+<span class="stringliteral">&quot;.&quot;</span>) ;
<a name="l00431"></a>00431                 };
<a name="l00432"></a>00432 
<a name="l00433"></a>00433                 <span class="comment">//Try to read coordinates</span>
<a name="l00434"></a>00434                 <span class="keywordflow">if</span> (!Double::TryParse(numbers[3], x) || !Double::TryParse(numbers[4], y ) ||
<a name="l00435"></a>00435                         !Double::TryParse(numbers[5], z ))
<a name="l00436"></a>00436                         <span class="keywordflow">throw</span> <span class="keyword">gcnew</span> Exception(<span class="stringliteral">&quot;Error in Atom coordinates&quot;</span>);
<a name="l00437"></a>00437 
<a name="l00438"></a>00438                 <a class="code" href="class_atom.html">Atom</a>^ nAtom=<span class="keyword">gcnew</span> <a class="code" href="class_atom.html">Atom</a>();
<a name="l00439"></a>00439 
<a name="l00440"></a>00440                 <span class="comment">//Save the new atom and coordinates in the model</span>
<a name="l00441"></a>00441                 nAtom-&gt;<a class="code" href="class_atom.html#a9adaaa1c67caa251c7c3f9b5753cfced" title="Property x coordinate position of the atom.">X</a>=x; nAtom-&gt;<a class="code" href="class_atom.html#ad121a01910fb0f6511a963de4d89460d" title="Property y coordinate position of the atom.">Y</a>=y; nAtom-&gt;<a class="code" href="class_atom.html#aa0c17b25aa4c710115c74b173c756a9b" title="Property z coordinate position of the atom.">Z</a>=z;
<a name="l00442"></a>00442 
<a name="l00443"></a>00443                 <span class="comment">//Find isotope from the elements matrix</span>
<a name="l00444"></a>00444                 <span class="keywordflow">try</span>{
<a name="l00445"></a>00445                         nAtom-&gt;<a class="code" href="class_atom.html#a14a6785b5d26d50fe23d617c95b2585d" title="Property isotope of the atom.">isotope</a>=<a class="code" href="class_isotopes.html#a5d8772910912cbc6667f066a2a8ef531" title="Function for finding the isotope when one of the element, atom number or mass is given.">Isotopes::FindIsotope</a>(((String^) <a class="code" href="class_gauss.html#a23f542949be4a0962e87062a3e6f4301">Elements</a>[index]),
<a name="l00446"></a>00446                                 Convert::ToInt32(numbers[1]), 
<a name="l00447"></a>00447                                 (<span class="keywordtype">int</span>)((Int32^) <a class="code" href="class_gauss.html#a8bb535223a670f6bf0e0d64221637dba" title="Arrays that save elements and mass numbers.">Mass</a>[index]));
<a name="l00448"></a>00448                         index++;
<a name="l00449"></a>00449                 }
<a name="l00450"></a>00450                 <span class="keywordflow">catch</span>(Exception ^ e)
<a name="l00451"></a>00451                 {
<a name="l00452"></a>00452                         <span class="keywordflow">throw</span> <span class="keyword">gcnew</span> Exception(<span class="stringliteral">&quot;Problem in Elements:&quot;</span>+e-&gt;Message
<a name="l00453"></a>00453                                 +<span class="stringliteral">&quot;. Problem in Reading File in Line:&quot;</span>+<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8d12e89896c32976b9c28899370b3835">getLineStop</a>()+<span class="stringliteral">&quot; .&quot;</span>);
<a name="l00454"></a>00454                 }
<a name="l00455"></a>00455 
<a name="l00456"></a>00456                 <span class="comment">//If this is the first time reading this section(read_once==false)</span>
<a name="l00457"></a>00457                 <span class="comment">// just add it in the system else replace the previous frame value(if exists)</span>
<a name="l00458"></a>00458                 <span class="keywordflow">if</span>(<a class="code" href="class_gauss.html#a7993228e01007ae09fc19f667c31a486" title="Flag for checking if multiple frames is being read for coordinates.">read_onceCO</a>) 
<a name="l00459"></a>00459                         <span class="keywordflow">try</span>{<a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>[AtomID]=nAtom; AtomID++;}
<a name="l00460"></a>00460                 <span class="keywordflow">catch</span>(Exception ^ e)  {<span class="keywordflow">throw</span> <span class="keyword">gcnew</span> Exception(<span class="stringliteral">&quot;Problem in Elements: &quot;</span>+e-&gt;Message);}
<a name="l00461"></a>00461                 <span class="keywordflow">else</span> <a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>-&gt;Add(nAtom);
<a name="l00462"></a>00462         };
<a name="l00463"></a>00463 
<a name="l00464"></a>00464         <span class="comment">//Save nuber of atoms</span>
<a name="l00465"></a>00465         <a class="code" href="class_gauss.html#aac17f2fb80d5ca0e9794a54479ff6a44" title="Number of Atoms.">AtomCount</a>=<a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>-&gt;Count;
<a name="l00466"></a>00466 
<a name="l00467"></a>00467         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00468"></a>00468 }
<a name="l00469"></a>00469 <span class="comment"></span>
<a name="l00470"></a>00470 <span class="comment">/**</span>
<a name="l00471"></a>00471 <span class="comment">* @brief Function for reading isotropic factors  for each atom to used for hyperfine couplings later</span>
<a name="l00472"></a>00472 <span class="comment">* @return Returns false if the format does not seem to be correct.</span>
<a name="l00473"></a>00473 <span class="comment">*/</span>
<a name="l00474"></a><a class="code" href="class_gauss.html#a679d98a7e3eae4e1f93034bdd91c790b">00474</a> <span class="keywordtype">bool</span> <a class="code" href="class_gauss.html#a679d98a7e3eae4e1f93034bdd91c790b" title="Function for reading isotropic factors for each atom to used for hyperfine couplings later...">Gauss::read_ISOCOUPLINGS</a>()
<a name="l00475"></a>00475 {
<a name="l00476"></a>00476 
<a name="l00477"></a>00477         <span class="keywordtype">int</span> number=6;   <span class="comment">//number of fields in the a line</span>
<a name="l00478"></a>00478         <span class="keywordtype">double</span> value; <span class="comment">//readed value</span>
<a name="l00479"></a>00479         String^ fileline=<span class="keyword">gcnew</span> String(<span class="stringliteral">&quot;&quot;</span>); <span class="comment">//line</span>
<a name="l00480"></a>00480         <span class="keywordtype">int</span> jj=0;
<a name="l00481"></a>00481         array&lt;String^&gt;^numbers = <span class="keyword">nullptr</span>;   <span class="comment">// Matrix of the fields after splitting of a line</span>
<a name="l00482"></a>00482         String^ delimStr = <span class="stringliteral">&quot; ,=&quot;</span>;            <span class="comment">//seperator of fields</span>
<a name="l00483"></a>00483         array&lt;Char&gt;^delimiter = delimStr-&gt;ToCharArray(); <span class="comment">//Conversion to char array     </span>
<a name="l00484"></a>00484 
<a name="l00485"></a>00485         <span class="comment">//Atom                 a.u.       MegaHertz       Gauss      10(-4) cm-1</span>
<a name="l00486"></a>00486         fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>() ;
<a name="l00487"></a>00487 
<a name="l00488"></a>00488         <span class="comment">//Read until end of section</span>
<a name="l00489"></a>00489         <span class="keywordflow">while</span> (!(fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>())-&gt;Contains(<span class="stringliteral">&quot;--------&quot;</span>))
<a name="l00490"></a>00490         {
<a name="l00491"></a>00491                 <span class="comment">//Split the line to a number of fields</span>
<a name="l00492"></a>00492                 numbers = <span class="keyword">nullptr</span>;
<a name="l00493"></a>00493                 numbers=fileline-&gt;Split(delimiter,StringSplitOptions::RemoveEmptyEntries );
<a name="l00494"></a>00494 
<a name="l00495"></a>00495                 <span class="comment">//Check if the numebr fields is correct</span>
<a name="l00496"></a>00496                 <span class="keywordflow">if</span>(number!=numbers-&gt;Length)
<a name="l00497"></a>00497                 {
<a name="l00498"></a>00498                         <span class="keywordflow">throw</span> <span class="keyword">gcnew</span> Exception(<span class="stringliteral">&quot;Problem in Reading Isotropic couplings&quot;</span>
<a name="l00499"></a>00499                                 +<span class="stringliteral">&quot;. Problem in Reading File in Line: &quot;</span>+<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8d12e89896c32976b9c28899370b3835">getLineStop</a>()+<span class="stringliteral">&quot;.&quot;</span>) ;
<a name="l00500"></a>00500                 };
<a name="l00501"></a>00501 
<a name="l00502"></a>00502                 <span class="comment">//Try to read elements and save in the matrix</span>
<a name="l00503"></a>00503                 <span class="keywordflow">if</span> (!Double::TryParse(numbers[4], value )) 
<a name="l00504"></a>00504                         <span class="keywordflow">throw</span> <span class="keyword">gcnew</span> Exception(<span class="stringliteral">&quot;Problem in Reading Isotropic factor in Line &quot;</span>+
<a name="l00505"></a>00505                         <a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a56538396531460cfa299d12a89421c97" title="Function that returns the last line that was read.">LineCount</a>+<span class="stringliteral">&quot;. The format of field(double) is incorrect.&quot;</span>);
<a name="l00506"></a>00506 
<a name="l00507"></a>00507                 <span class="comment">//If this is the first time reading this section(read_once==false)</span>
<a name="l00508"></a>00508                 <span class="comment">// just add it in the system else replace the previous frame value(if exists)</span>
<a name="l00509"></a>00509                 <span class="keywordflow">if</span>(<a class="code" href="class_gauss.html#a5848025f42a6fbadd7a116fa4e5ca9cc" title="Flag for checking if multiple frames is being read for isotropic factors.">read_onceISO</a>) 
<a name="l00510"></a>00510                         <span class="keywordflow">try</span>{<a class="code" href="class_gauss.html#a628ed7af9de11be3f0e252fecfe7c043" title="Array that saves the isotropic factors.">IsotropicCollection</a>[jj]=value; jj++;}
<a name="l00511"></a>00511                 <span class="keywordflow">catch</span>(String ^ e)  {<span class="keywordflow">throw</span> <span class="keyword">gcnew</span> Exception(<span class="stringliteral">&quot;Problem in Elements: &quot;</span>+e);}
<a name="l00512"></a>00512                 <span class="keywordflow">else</span>  <a class="code" href="class_gauss.html#a628ed7af9de11be3f0e252fecfe7c043" title="Array that saves the isotropic factors.">IsotropicCollection</a>-&gt;Add(value);
<a name="l00513"></a>00513         };
<a name="l00514"></a>00514 
<a name="l00515"></a>00515         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00516"></a>00516 }
<a name="l00517"></a>00517 <span class="comment"></span>
<a name="l00518"></a>00518 <span class="comment">/**</span>
<a name="l00519"></a>00519 <span class="comment">* @brief Main function for reading J-Couplings from the file</span>
<a name="l00520"></a>00520 <span class="comment">* @return Returns false if the format does not seem to be correct.</span>
<a name="l00521"></a>00521 <span class="comment">*/</span>
<a name="l00522"></a><a class="code" href="class_gauss.html#a51254d8385541e17552e4b180c682a1d">00522</a> <span class="keywordtype">bool</span> <a class="code" href="class_gauss.html#a51254d8385541e17552e4b180c682a1d" title="Main function for reading J-Couplings from the file.">Gauss::read_JCOUPLINGS</a>()
<a name="l00523"></a>00523 {
<a name="l00524"></a>00524         <span class="keywordtype">int</span> number;   <span class="comment">//number of fields in the a line</span>
<a name="l00525"></a>00525         <span class="keywordtype">double</span> value; <span class="comment">//readed value</span>
<a name="l00526"></a>00526         String^ fileline=<span class="keyword">gcnew</span> String(<span class="stringliteral">&quot;&quot;</span>); <span class="comment">//line</span>
<a name="l00527"></a>00527         <span class="keywordtype">int</span> jj=0;
<a name="l00528"></a>00528 
<a name="l00529"></a>00529         array&lt;String^&gt;^numbers = <span class="keyword">nullptr</span>;   <span class="comment">// Matrix of the fields after splitting of a line</span>
<a name="l00530"></a>00530         String^ delimStr = <span class="stringliteral">&quot; ,=&quot;</span>;            <span class="comment">//seperator of fields</span>
<a name="l00531"></a>00531         array&lt;Char&gt;^delimiter = delimStr-&gt;ToCharArray(); <span class="comment">//Conversion to char array     </span>
<a name="l00532"></a>00532 
<a name="l00533"></a>00533         <span class="comment">//Saving the starting index of this interaction for case of multiple frames</span>
<a name="l00534"></a>00534         <span class="keyword">static</span> <span class="keywordtype">int</span> startIndex;
<a name="l00535"></a>00535         <span class="keywordflow">if</span>(!<a class="code" href="class_gauss.html#a219e5b6f9ba9975c3c868cb9a51a06e2" title="Flag for checking if multiple frames is being read for j-couplings.">read_onceJC</a>) startIndex=<a class="code" href="_gauss_8cpp.html#a5cbb61ec3949904f6d01991168849abf">InteractionCollection</a>-&gt;Count;
<a name="l00536"></a>00536 
<a name="l00537"></a>00537 
<a name="l00538"></a>00538         <span class="comment">//Loop over the parts of matrix  </span>
<a name="l00539"></a>00539         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0;k&lt;<a class="code" href="class_gauss.html#aac17f2fb80d5ca0e9794a54479ff6a44" title="Number of Atoms.">AtomCount</a>/5+(int)(<a class="code" href="class_gauss.html#aac17f2fb80d5ca0e9794a54479ff6a44" title="Number of Atoms.">AtomCount</a>%5&gt;0); k++)
<a name="l00540"></a>00540         {
<a name="l00541"></a>00541                 <span class="comment">//        1             2             3             4             5 </span>
<a name="l00542"></a>00542                 fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>() ;
<a name="l00543"></a>00543 
<a name="l00544"></a>00544                 <span class="comment">//Read line with up to 6 columns</span>
<a name="l00545"></a>00545                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="class_gauss.html#aac17f2fb80d5ca0e9794a54479ff6a44" title="Number of Atoms.">AtomCount</a>-5*k; i++)
<a name="l00546"></a>00546                 {
<a name="l00547"></a>00547                         fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>();
<a name="l00548"></a>00548 
<a name="l00549"></a>00549                         <span class="comment">//Sometimes the umber have &quot;D&quot; for double precision, so change it to E</span>
<a name="l00550"></a>00550                         fileline=fileline-&gt;Replace(<span class="charliteral">&#39;D&#39;</span>,<span class="charliteral">&#39;E&#39;</span>);
<a name="l00551"></a>00551 
<a name="l00552"></a>00552                         <span class="comment">//If line number &gt;4th line the fields are 6 else line number +2</span>
<a name="l00553"></a>00553                         <span class="keywordflow">if</span>((i+2) &lt; 6) number=i+2; <span class="keywordflow">else</span> number=6;
<a name="l00554"></a>00554 
<a name="l00555"></a>00555                         <span class="comment">//Split the line to a number of fields</span>
<a name="l00556"></a>00556                         numbers = <span class="keyword">nullptr</span>;
<a name="l00557"></a>00557                         numbers=fileline-&gt;Split(delimiter,StringSplitOptions::RemoveEmptyEntries );
<a name="l00558"></a>00558 
<a name="l00559"></a>00559                         <span class="comment">//Check if the numebr fields is correct</span>
<a name="l00560"></a>00560                         <span class="keywordflow">if</span>(number!=numbers-&gt;Length) 
<a name="l00561"></a>00561                         {
<a name="l00562"></a>00562                                 <span class="keywordflow">throw</span> <span class="keyword">gcnew</span> Exception(<span class="stringliteral">&quot;Problem in Reading Total Couplings&quot;</span>
<a name="l00563"></a>00563                                         +<span class="stringliteral">&quot;. Problem in Reading File in Line: &quot;</span>+<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8d12e89896c32976b9c28899370b3835">getLineStop</a>()+<span class="stringliteral">&quot;.&quot;</span>) ;
<a name="l00564"></a>00564                         };
<a name="l00565"></a>00565 
<a name="l00566"></a>00566                         <span class="comment">//      4  0.601661D+00  0.182273D+01  0.147429D+03  0.385007D+12</span>
<a name="l00567"></a>00567                         <span class="comment">//Loop over the fields in line</span>
<a name="l00568"></a>00568                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=1; j&lt;number-((int)(i&lt;5)); j++)
<a name="l00569"></a>00569                         {
<a name="l00570"></a>00570 
<a name="l00571"></a>00571                                 <span class="comment">//Try to read elements and save in the matrix</span>
<a name="l00572"></a>00572                                 <span class="keywordflow">if</span> (!Double::TryParse(numbers[j], value )) 
<a name="l00573"></a>00573                                         <span class="keywordflow">throw</span> <span class="keyword">gcnew</span> Exception(<span class="stringliteral">&quot;Problem in Reading J-Couplings matrix elements in Line &quot;</span>+
<a name="l00574"></a>00574                                         <a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a56538396531460cfa299d12a89421c97" title="Function that returns the last line that was read.">LineCount</a>+<span class="stringliteral">&quot;. The format of fields(double) is incorrect.&quot;</span>);
<a name="l00575"></a>00575 
<a name="l00576"></a>00576                                 <span class="comment">//Set the matrix</span><a class="code" href="class_spinach_g_u_i_1_1_matrix3x3.html"></a>
<a name="l00577"></a>00577 <a class="code" href="class_spinach_g_u_i_1_1_matrix3x3.html">				::Matrix3x3</a> ^Matrix=gcnew ::Matrix3x3();
<a name="l00578"></a>00578                                 Matrix[0]=value; Matrix[4]=value; Matrix[8]=value;
<a name="l00579"></a>00579                                 Matrix[1]=0.0; Matrix[2]=0.0; Matrix[3]=0.0; 
<a name="l00580"></a>00580                                 Matrix[5]=0.0; Matrix[6]=0.0; Matrix[7]=0.0;
<a name="l00581"></a>00581 
<a name="l00582"></a>00582                                 <span class="comment">//Try to create new Interaction</span>
<a name="l00583"></a>00583                                 <a class="code" href="class_tensor.html">Tensor</a>^ nInteraction;
<a name="l00584"></a>00584                                 <span class="keywordflow">try</span>{
<a name="l00585"></a>00585                                         nInteraction=<span class="keyword">gcnew</span> <a class="code" href="class_tensor.html">Tensor</a>((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>[i+5*k+1],
<a name="l00586"></a>00586                                                 (<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>[j+5*k],
<a name="l00587"></a>00587                                                 <a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8eada7dd200d6a013dee8d3ce94d259065f">InteractionKind::Jcoupling</a>, 
<a name="l00588"></a>00588                                                 Matrix);
<a name="l00589"></a>00589                                         nInteraction-&gt;<a class="code" href="class_interaction.html#af0b4df61d751c1ddffbfa70843e0c7db" title="Property unit for giving or setting the unit of the interaction.">unit</a>=<a class="code" href="class_units.html#aa52706faabc35b525a484ad1bbd9747a">Units::Hz</a>;
<a name="l00590"></a>00590                                         nInteraction-&gt;<a class="code" href="class_tensor.html#a297aa3cd96e646ffaed3d4547e23ebcb" title="Property matrix3x3 for giving or setting the matrix of the tensor of the interaction.">Frame</a>=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a16ab6e7e7d34bd4bb7d0d32b59f6770a" title="Main function for opening and reading file.">SystemModel</a>-&gt;<a class="code" href="class_model.html#adc069c415325e10c5c452421d0578564" title="The collection of reference frames in the model.">RefFrameCollection</a>[1];
<a name="l00591"></a>00591                                 }<span class="comment">//Throws when an invalid interaction is tried to create.</span>
<a name="l00592"></a>00592                                 <span class="keywordflow">catch</span>(Exception ^ e)  
<a name="l00593"></a>00593                                 { 
<a name="l00594"></a>00594                                         <span class="keywordflow">throw</span> <span class="keyword">gcnew</span> Exception(<span class="stringliteral">&quot;Problem in Reading J-Couplings:&quot;</span>+e-&gt;Message
<a name="l00595"></a>00595                                                 +<span class="stringliteral">&quot;. Problem in Reading File in Line:&quot;</span>+<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8d12e89896c32976b9c28899370b3835">getLineStop</a>()+<span class="stringliteral">&quot; .&quot;</span>);
<a name="l00596"></a>00596                                 };
<a name="l00597"></a>00597 
<a name="l00598"></a>00598                                 <span class="comment">//If this is the first time reading this section(read_once==false)</span>
<a name="l00599"></a>00599                                 <span class="comment">// just add it in the system else replace the previous frame value(if exists)</span>
<a name="l00600"></a>00600                                 <span class="keywordflow">if</span>(<a class="code" href="class_gauss.html#a219e5b6f9ba9975c3c868cb9a51a06e2" title="Flag for checking if multiple frames is being read for j-couplings.">read_onceJC</a>) 
<a name="l00601"></a>00601                                         <span class="keywordflow">try</span>{<a class="code" href="_gauss_8cpp.html#a5cbb61ec3949904f6d01991168849abf">InteractionCollection</a>[startIndex+jj]=nInteraction; jj++;}
<a name="l00602"></a>00602                                 <span class="keywordflow">catch</span>(String ^ e)  {<span class="keywordflow">throw</span> <span class="keyword">gcnew</span> Exception(<span class="stringliteral">&quot;Problem in Elements: &quot;</span>+e);}
<a name="l00603"></a>00603                                 <span class="keywordflow">else</span> <a class="code" href="_gauss_8cpp.html#a5cbb61ec3949904f6d01991168849abf">InteractionCollection</a>-&gt;Add(nInteraction);
<a name="l00604"></a>00604                         };
<a name="l00605"></a>00605 
<a name="l00606"></a>00606                 };
<a name="l00607"></a>00607 
<a name="l00608"></a>00608         };
<a name="l00609"></a>00609 
<a name="l00610"></a>00610         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00611"></a>00611 }
<a name="l00612"></a>00612 <span class="comment"></span>
<a name="l00613"></a>00613 <span class="comment">/**</span>
<a name="l00614"></a>00614 <span class="comment">* @brief Main function for reading Chemical shieldings from the file</span>
<a name="l00615"></a>00615 <span class="comment">* @return Returns false if the format does not seem to be correct.</span>
<a name="l00616"></a>00616 <span class="comment">*/</span>
<a name="l00617"></a><a class="code" href="class_gauss.html#abb6fdfc6fe30b908a02d551dee52ed7a">00617</a> <span class="keywordtype">bool</span> <a class="code" href="class_gauss.html#abb6fdfc6fe30b908a02d551dee52ed7a" title="Main function for reading Chemical shieldings from the file.">Gauss::read_CSTENSOR</a>()
<a name="l00618"></a>00618 {
<a name="l00619"></a>00619         String^ fileline=<span class="keyword">gcnew</span> String(<span class="stringliteral">&quot;&quot;</span>); <span class="comment">//line</span>
<a name="l00620"></a>00620         <span class="keywordtype">int</span> ii=1;
<a name="l00621"></a>00621 
<a name="l00622"></a>00622         <span class="comment">//Saving the starting index of this interaction for case of multiple frames</span>
<a name="l00623"></a>00623         <span class="keyword">static</span> <span class="keywordtype">int</span> startIndex;
<a name="l00624"></a>00624         <span class="keywordflow">if</span>(!<a class="code" href="class_gauss.html#afde4fd23393bd06351acbeaa60a4b189" title="Flag for checking if multiple frames is being read for Chemical shifts.">read_onceCS</a>) startIndex=<a class="code" href="_gauss_8cpp.html#a5cbb61ec3949904f6d01991168849abf">InteractionCollection</a>-&gt;Count;
<a name="l00625"></a>00625 
<a name="l00626"></a>00626         <span class="comment">//Convert to Shifts</span>
<a name="l00627"></a>00627         <a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a45651fc765aa371f37367c5cab143296" title="Flag to show if the convertion from chemical shielding to shift will be used.">ToShift</a>=<span class="keyword">true</span>;
<a name="l00628"></a>00628 
<a name="l00629"></a>00629         <span class="comment">//Loop over all atoms</span>
<a name="l00630"></a>00630         <span class="keywordflow">for each</span>(<span class="keywordtype">int</span> i <span class="keywordflow">in</span> <a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>-&gt;Keys)
<a name="l00631"></a>00631         {
<a name="l00632"></a>00632                 <span class="comment">// 1  C    Isotropic =    57.9607   Anisotropy =   128.1526</span>
<a name="l00633"></a>00633                 fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>();
<a name="l00634"></a>00634 
<a name="l00635"></a>00635                 <span class="comment">//Reading interaction matrix and creating interaction</span>
<a name="l00636"></a>00636                 <span class="comment">//  XX=   124.2135   YX=    17.8802   ZX=   -52.5149</span>
<a name="l00637"></a>00637                 <span class="comment">//  XY=    16.8895   YY=    49.5584   ZY=    50.7000</span>
<a name="l00638"></a>00638                 <span class="comment">//  XZ=   -52.1651   YZ=    56.3286   ZZ=     0.1103</span>
<a name="l00639"></a>00639                 fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>();
<a name="l00640"></a>00640                 <span class="comment">//Number of Fields: 6, XYZ index: 1,3,5</span>
<a name="l00641"></a>00641                 <a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a76380877005a119942daf7995d4a65a0" title="Reads three lines, split them to a number of fields which must be equal to FieldsNumber (for each lin...">ExtractInteractionMatrix3x3</a>(fileline, <span class="stringliteral">&quot;Chemical Shielding&quot;</span>, 
<a name="l00642"></a>00642                         (<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>[i], (<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>[i], 1.0,
<a name="l00643"></a>00643                         <a class="code" href="class_gauss.html#afde4fd23393bd06351acbeaa60a4b189" title="Flag for checking if multiple frames is being read for Chemical shifts.">read_onceCS</a>, startIndex, ii, 6, 1, 3, 5, 
<a name="l00644"></a>00644                         <a class="code" href="class_units.html#a13d0ca3953991e746670edb678bf1194">Units::ppm</a>, <a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8ea4933d15638dc23396e7cb8ed2d9c205f">InteractionKind::CShielding</a>, 
<a name="l00645"></a>00645                         <a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a16ab6e7e7d34bd4bb7d0d32b59f6770a" title="Main function for opening and reading file.">SystemModel</a>-&gt;<a class="code" href="class_model.html#adc069c415325e10c5c452421d0578564" title="The collection of reference frames in the model.">RefFrameCollection</a>[1], 
<a name="l00646"></a>00646                         <a class="code" href="_gauss_8cpp.html#a5cbb61ec3949904f6d01991168849abf">InteractionCollection</a>);
<a name="l00647"></a>00647 
<a name="l00648"></a>00648                 <span class="comment">//Dummy</span>
<a name="l00649"></a>00649                 <span class="comment">//Eigenvalues:   -50.5935    81.0799   143.3958</span>
<a name="l00650"></a>00650                 fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>() ;
<a name="l00651"></a>00651         };   
<a name="l00652"></a>00652         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00653"></a>00653 }
<a name="l00654"></a>00654 <span class="comment"></span>
<a name="l00655"></a>00655 <span class="comment">/**</span>
<a name="l00656"></a>00656 <span class="comment">* @brief Main function for reading Anisotropic eigenvalues and DCMs and save them as spin </span>
<a name="l00657"></a>00657 <span class="comment">* rotation couplings in order to create hyperfine interactions. Actually we create the </span>
<a name="l00658"></a>00658 <span class="comment">* interaction matrix from them.</span>
<a name="l00659"></a>00659 <span class="comment">* @return Returns false if the format does not seem to be correct.</span>
<a name="l00660"></a>00660 <span class="comment">*/</span>
<a name="l00661"></a><a class="code" href="class_gauss.html#a261475e940fc2879d05409c2104a3db2">00661</a> <span class="keywordtype">bool</span> <a class="code" href="class_gauss.html#a261475e940fc2879d05409c2104a3db2" title="Main function for reading Anisotropic eigenvalues and DCMs and save them as spin rotation couplings i...">Gauss::read_ANISCOUPLINGS</a>()
<a name="l00662"></a>00662 {
<a name="l00663"></a>00663         <span class="keywordtype">int</span> number=8;   <span class="comment">//number of fields in the a line</span>
<a name="l00664"></a>00664         String^ fileline=<span class="keyword">gcnew</span> String(<span class="stringliteral">&quot;&quot;</span>); <span class="comment">//line</span>
<a name="l00665"></a>00665         array&lt;String^&gt;^numbers = <span class="keyword">nullptr</span>;   <span class="comment">// Matrix of the fields after splitting of a line</span>
<a name="l00666"></a>00666         String^ delimStr = <span class="stringliteral">&quot; ,=&quot;</span>;            <span class="comment">//seperator of fields</span>
<a name="l00667"></a>00667         array&lt;Char&gt;^delimiter = delimStr-&gt;ToCharArray(); <span class="comment">//Conversion to char array     </span>
<a name="l00668"></a>00668 
<a name="l00669"></a>00669         <span class="comment">//Saving the starting index of this interaction for case of multiple frames</span>
<a name="l00670"></a>00670         <span class="keywordflow">if</span>(!<a class="code" href="class_gauss.html#af44bf9c137f8841bf717ecd5e3763faf" title="Flag for checking if multiple frames is being read for anisotropic factors.">read_onceANI</a>) <a class="code" href="class_gauss.html#ae9525a0e7176234d866bfdde07977f79" title="Start index for anisotropic couplings.">startIndexANIS</a>=<a class="code" href="_gauss_8cpp.html#a5cbb61ec3949904f6d01991168849abf">InteractionCollection</a>-&gt;Count;
<a name="l00671"></a>00671 
<a name="l00672"></a>00672         <span class="comment">// ---------------------------------------------------------------------------------</span>
<a name="l00673"></a>00673         <span class="comment">//</span>
<a name="l00674"></a>00674         <span class="comment">//    Atom             a.u.   MegaHertz   Gauss  10(-4) cm-1        Axes</span>
<a name="l00675"></a>00675         <span class="comment">//</span>
<a name="l00676"></a>00676         fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>() ;
<a name="l00677"></a>00677         fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>() ;
<a name="l00678"></a>00678         fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>() ;
<a name="l00679"></a>00679 
<a name="l00680"></a>00680         <span class="comment">//Loop over all atoms excepts electrons</span>
<a name="l00681"></a>00681         <span class="keywordflow">for each</span>(<span class="keywordtype">int</span> i <span class="keywordflow">in</span> <a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>-&gt;Keys) 
<a name="l00682"></a>00682                 <span class="keywordflow">if</span>(((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>[i])-&gt;isotope-&gt;Element!=<span class="stringliteral">&quot;e&quot;</span>)
<a name="l00683"></a>00683                 {
<a name="l00684"></a>00684                         <span class="keywordtype">double</span> *eigen_Anis_Couplings=<span class="keyword">new</span> <span class="keywordtype">double</span>[9]; <span class="comment">//eigen values</span><a class="code" href="class_spinach_g_u_i_1_1_matrix3x3.html"></a>
<a name="l00685"></a>00685 <a class="code" href="class_spinach_g_u_i_1_1_matrix3x3.html">			::Matrix3x3</a> ^ eigenvec_Anis_Couplings=gcnew ::Matrix3x3(); <span class="comment">//dcm</span>
<a name="l00686"></a>00686                         <span class="keywordtype">double</span> x,y,z,k;
<a name="l00687"></a>00687 
<a name="l00688"></a>00688                         <span class="comment">// &lt;Empty line&gt;</span>
<a name="l00689"></a>00689                         fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>();
<a name="l00690"></a>00690 
<a name="l00691"></a>00691                         <span class="comment">//          Baa    -0.2281   -30.604   -10.920   -10.209  0.0000 -0.4863  0.8738</span>
<a name="l00692"></a>00692                         fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>();
<a name="l00693"></a>00693 
<a name="l00694"></a>00694                         <span class="comment">//Split the line to a number of fields</span>
<a name="l00695"></a>00695                         numbers = <span class="keyword">nullptr</span>;
<a name="l00696"></a>00696                         numbers=fileline-&gt;Split(delimiter,StringSplitOptions::RemoveEmptyEntries );
<a name="l00697"></a>00697 
<a name="l00698"></a>00698                         <span class="comment">//Try to read elements and save in the matrix</span>
<a name="l00699"></a>00699                         <span class="comment">// use &amp; not &amp;&amp; to avoid short circuit</span>
<a name="l00700"></a>00700                         <span class="keywordflow">if</span> (number!=numbers-&gt;Length &amp; 
<a name="l00701"></a>00701                                 !Double::TryParse(numbers[3], x) ||
<a name="l00702"></a>00702                                 !Double::TryParse(numbers[5], y) ||
<a name="l00703"></a>00703                                 !Double::TryParse(numbers[6], z) ||
<a name="l00704"></a>00704                                 !Double::TryParse(numbers[7], k))
<a name="l00705"></a>00705                                 <span class="keywordflow">throw</span> <span class="keyword">gcnew</span> Exception(<span class="stringliteral">&quot;Problem in Reading Anisotropic Couplings in Line &quot;</span>+<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a56538396531460cfa299d12a89421c97" title="Function that returns the last line that was read.">LineCount</a>+<span class="stringliteral">&quot;. &quot;</span> +
<a name="l00706"></a>00706                                 <span class="stringliteral">&quot;Either the number of fields in the line is incorrect or &quot;</span>+
<a name="l00707"></a>00707                                 <span class="stringliteral">&quot;the format of fields(double) is incorrect.&quot;</span>);
<a name="l00708"></a>00708                         <span class="keywordflow">else</span> {
<a name="l00709"></a>00709                                 eigen_Anis_Couplings[1]=eigen_Anis_Couplings[2]=0.0f;
<a name="l00710"></a>00710                                 eigen_Anis_Couplings[0]=x;
<a name="l00711"></a>00711                                 eigenvec_Anis_Couplings[0]=y;
<a name="l00712"></a>00712                                 eigenvec_Anis_Couplings[1]=z;
<a name="l00713"></a>00713                                 eigenvec_Anis_Couplings[2]=k;
<a name="l00714"></a>00714                         };
<a name="l00715"></a>00715 
<a name="l00716"></a>00716                         <span class="comment">// 1 C(13)  Bbb    -0.2215   -29.718   -10.604    -9.913  0.0000  0.8738  0.4863</span>
<a name="l00717"></a>00717                         fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>();
<a name="l00718"></a>00718 
<a name="l00719"></a>00719                         <span class="comment">//Split the line to a number of fields</span>
<a name="l00720"></a>00720                         numbers = <span class="keyword">nullptr</span>;
<a name="l00721"></a>00721                         numbers=fileline-&gt;Split(delimiter,StringSplitOptions::RemoveEmptyEntries );
<a name="l00722"></a>00722 
<a name="l00723"></a>00723                         <span class="comment">//Try to read elements and save in the matrix</span>
<a name="l00724"></a>00724                         <span class="comment">// use &amp; not &amp;&amp; to avoid short circuit</span>
<a name="l00725"></a>00725                         <span class="keywordflow">if</span> ((number+2)!=numbers-&gt;Length &amp; 
<a name="l00726"></a>00726                                 !Double::TryParse(numbers[5], x) ||
<a name="l00727"></a>00727                                 !Double::TryParse(numbers[7], y) ||
<a name="l00728"></a>00728                                 !Double::TryParse(numbers[8], z) ||
<a name="l00729"></a>00729                                 !Double::TryParse(numbers[9], k))
<a name="l00730"></a>00730                                 <span class="keywordflow">throw</span> <span class="keyword">gcnew</span> Exception(<span class="stringliteral">&quot;Problem in Reading Anisotropic Couplings in Line &quot;</span>+<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a56538396531460cfa299d12a89421c97" title="Function that returns the last line that was read.">LineCount</a>+<span class="stringliteral">&quot;. &quot;</span> +
<a name="l00731"></a>00731                                 <span class="stringliteral">&quot;Either the number of fields in the line is incorrect or &quot;</span>+
<a name="l00732"></a>00732                                 <span class="stringliteral">&quot;the format of fields(double) is incorrect.&quot;</span>);
<a name="l00733"></a>00733                         <span class="keywordflow">else</span> {
<a name="l00734"></a>00734                                 eigen_Anis_Couplings[3]=eigen_Anis_Couplings[5]=0.0f;
<a name="l00735"></a>00735                                 eigen_Anis_Couplings[4]=x;
<a name="l00736"></a>00736                                 eigenvec_Anis_Couplings[3]=y;
<a name="l00737"></a>00737                                 eigenvec_Anis_Couplings[4]=z;
<a name="l00738"></a>00738                                 eigenvec_Anis_Couplings[5]=k;
<a name="l00739"></a>00739                         };
<a name="l00740"></a>00740 
<a name="l00741"></a>00741                         <span class="comment">//          Bcc     0.4495    60.322    21.524    20.121  1.0000  0.0000  0.0000</span>
<a name="l00742"></a>00742                         fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>();
<a name="l00743"></a>00743 
<a name="l00744"></a>00744                         <span class="comment">//Split the line to a number of fields</span>
<a name="l00745"></a>00745                         numbers = <span class="keyword">nullptr</span>;
<a name="l00746"></a>00746                         numbers=fileline-&gt;Split(delimiter,StringSplitOptions::RemoveEmptyEntries );
<a name="l00747"></a>00747 
<a name="l00748"></a>00748                         <span class="comment">//Try to read elements and save in the matrix</span>
<a name="l00749"></a>00749                         <span class="comment">// use &amp; not &amp;&amp; to avoid short circuit</span>
<a name="l00750"></a>00750                         <span class="keywordflow">if</span> (number!=numbers-&gt;Length &amp; 
<a name="l00751"></a>00751                                 !Double::TryParse(numbers[3], x) ||
<a name="l00752"></a>00752                                 !Double::TryParse(numbers[5], y) ||
<a name="l00753"></a>00753                                 !Double::TryParse(numbers[6], z) ||
<a name="l00754"></a>00754                                 !Double::TryParse(numbers[7], k))
<a name="l00755"></a>00755                                 <span class="keywordflow">throw</span> <span class="keyword">gcnew</span> Exception(<span class="stringliteral">&quot;Problem in Reading Anisotropic Couplings in Line &quot;</span>+<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a56538396531460cfa299d12a89421c97" title="Function that returns the last line that was read.">LineCount</a>+<span class="stringliteral">&quot;. &quot;</span> +
<a name="l00756"></a>00756                                 <span class="stringliteral">&quot;Either the number of fields in the line is incorrect or &quot;</span>+
<a name="l00757"></a>00757                                 <span class="stringliteral">&quot;the format of fields(double) is incorrect.&quot;</span>);
<a name="l00758"></a>00758                         <span class="keywordflow">else</span> {
<a name="l00759"></a>00759                                 eigen_Anis_Couplings[6]=eigen_Anis_Couplings[7]=0.0f;
<a name="l00760"></a>00760                                 eigen_Anis_Couplings[8]=x;
<a name="l00761"></a>00761                                 eigenvec_Anis_Couplings[6]=y;
<a name="l00762"></a>00762                                 eigenvec_Anis_Couplings[7]=z;
<a name="l00763"></a>00763                                 eigenvec_Anis_Couplings[8]=k;
<a name="l00764"></a>00764                         };
<a name="l00765"></a>00765 
<a name="l00766"></a>00766                         <span class="comment">//Generate Tensor from eigenvectors and eigen values</span>
<a name="l00767"></a>00767                         Matrix3d result,eigenVectors,eigenValues;
<a name="l00768"></a>00768                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;9;j++) 
<a name="l00769"></a>00769                         {
<a name="l00770"></a>00770                                 eigenVectors(j)=eigenvec_Anis_Couplings[j];
<a name="l00771"></a>00771                                 eigenValues(j)=eigen_Anis_Couplings[j];
<a name="l00772"></a>00772                         };
<a name="l00773"></a>00773 
<a name="l00774"></a>00774                         <span class="comment">//Make the calculation</span>
<a name="l00775"></a>00775                         result= (eigenVectors*eigenValues)*eigenVectors.transpose();
<a name="l00776"></a>00776 
<a name="l00777"></a>00777                         <span class="comment">//Transfer to the matrix</span>
<a name="l00778"></a>00778                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;9;j++) eigenvec_Anis_Couplings[j]=result(j);
<a name="l00779"></a>00779 
<a name="l00780"></a>00780 
<a name="l00781"></a>00781                         <span class="comment">//Try tocreate temporary spirotation then convert to HFC</span>
<a name="l00782"></a>00782                         <a class="code" href="class_tensor.html">Tensor</a>^ nInteraction;
<a name="l00783"></a>00783                         <span class="keywordflow">try</span>{
<a name="l00784"></a>00784                                 nInteraction=<span class="keyword">gcnew</span> <a class="code" href="class_tensor.html">Tensor</a>((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>[i], 
<a name="l00785"></a>00785                                         (<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>[i], 
<a name="l00786"></a>00786                                         <a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8ea01b2976fe0597f878c70ed5188fd133e">InteractionKind::spinrotation</a>, 
<a name="l00787"></a>00787                                         eigenvec_Anis_Couplings);
<a name="l00788"></a>00788                         }
<a name="l00789"></a>00789                         <span class="keywordflow">catch</span>(Exception ^ e) 
<a name="l00790"></a>00790                         {
<a name="l00791"></a>00791                                 <span class="keywordflow">throw</span> <span class="keyword">gcnew</span> Exception(<span class="stringliteral">&quot;Problem in Reading Hyperfine: &quot;</span>+e-&gt;Message
<a name="l00792"></a>00792                                         +<span class="stringliteral">&quot;. Problem in Reading File in Line:&quot;</span>+<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8d12e89896c32976b9c28899370b3835">getLineStop</a>()+<span class="stringliteral">&quot; .&quot;</span>);
<a name="l00793"></a>00793                         };
<a name="l00794"></a>00794 
<a name="l00795"></a>00795                         <span class="comment">//If this is the first time reading this section(read_once==false)</span>
<a name="l00796"></a>00796                         <span class="comment">// just add it in the system else replace the previous frame value(if exists)</span>
<a name="l00797"></a>00797                         <span class="keywordflow">if</span>(<a class="code" href="class_gauss.html#af44bf9c137f8841bf717ecd5e3763faf" title="Flag for checking if multiple frames is being read for anisotropic factors.">read_onceANI</a>)
<a name="l00798"></a>00798                                 <span class="keywordflow">try</span>{<a class="code" href="_gauss_8cpp.html#a5cbb61ec3949904f6d01991168849abf">InteractionCollection</a>[i+<a class="code" href="class_gauss.html#ae9525a0e7176234d866bfdde07977f79" title="Start index for anisotropic couplings.">startIndexANIS</a>]=nInteraction;}
<a name="l00799"></a>00799                         <span class="keywordflow">catch</span>(String ^ e)  {<span class="keywordflow">throw</span> <span class="keyword">gcnew</span> Exception(<span class="stringliteral">&quot;Problem in Elements: &quot;</span>+e);}
<a name="l00800"></a>00800                         <span class="keywordflow">else</span> <a class="code" href="_gauss_8cpp.html#a5cbb61ec3949904f6d01991168849abf">InteractionCollection</a>-&gt;Add(nInteraction);          
<a name="l00801"></a>00801                 };
<a name="l00802"></a>00802 
<a name="l00803"></a>00803                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00804"></a>00804 }
<a name="l00805"></a>00805 <span class="comment"></span>
<a name="l00806"></a>00806 <span class="comment">/**</span>
<a name="l00807"></a>00807 <span class="comment">* @brief Main function for reading G-tesnor from the file</span>
<a name="l00808"></a>00808 <span class="comment">* @return Returns false if the format does not seem to be correct.</span>
<a name="l00809"></a>00809 <span class="comment">*/</span>
<a name="l00810"></a><a class="code" href="class_gauss.html#ac0da12c4d6300fc6d2ece76efc78bb6d">00810</a> <span class="keywordtype">bool</span> <a class="code" href="class_gauss.html#ac0da12c4d6300fc6d2ece76efc78bb6d" title="Main function for reading G-tesnor from the file.">Gauss::read_GTENSOR</a>()
<a name="l00811"></a>00811 {
<a name="l00812"></a>00812         String^ fileline=<span class="keyword">gcnew</span> String(<span class="stringliteral">&quot;&quot;</span>); <span class="comment">//line</span>
<a name="l00813"></a>00813         <span class="keywordtype">int</span> ii=1;
<a name="l00814"></a>00814 
<a name="l00815"></a>00815         <span class="comment">//Saving the starting index of this interaction and electron for case of multiple frames</span>
<a name="l00816"></a>00816         <span class="keyword">static</span> <span class="keywordtype">int</span> startIndex;
<a name="l00817"></a>00817         <span class="keyword">static</span> <span class="keywordtype">int</span> ElectronstartIndex;
<a name="l00818"></a>00818         <span class="keywordflow">if</span>(!<a class="code" href="class_gauss.html#a763752bd14a2b1fcaab01c4d86fd9ddb" title="Flag for checking if multiple frames is being read for g-tesnors.">read_onceGT</a>) 
<a name="l00819"></a>00819         {
<a name="l00820"></a>00820                 startIndex=<a class="code" href="_gauss_8cpp.html#a5cbb61ec3949904f6d01991168849abf">InteractionCollection</a>-&gt;Count;
<a name="l00821"></a>00821                 ElectronstartIndex=<a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>-&gt;Count;
<a name="l00822"></a>00822         }
<a name="l00823"></a>00823 
<a name="l00824"></a>00824         <span class="comment">//Create electron</span>
<a name="l00825"></a>00825         <a class="code" href="class_atom.html">Atom</a>^ nAtom=<span class="keyword">gcnew</span> <a class="code" href="class_atom.html">Atom</a>();
<a name="l00826"></a>00826         nAtom-&gt;<a class="code" href="class_atom.html#a14a6785b5d26d50fe23d617c95b2585d" title="Property isotope of the atom.">isotope</a>=<a class="code" href="class_isotopes.html#a5d8772910912cbc6667f066a2a8ef531" title="Function for finding the isotope when one of the element, atom number or mass is given.">Isotopes::FindIsotope</a>(<span class="stringliteral">&quot;e&quot;</span>,0, 0); <span class="comment">//Electron mass=0</span>
<a name="l00827"></a>00827         nAtom-&gt;<a class="code" href="class_atom.html#a9adaaa1c67caa251c7c3f9b5753cfced" title="Property x coordinate position of the atom.">X</a>=0.0f;
<a name="l00828"></a>00828         nAtom-&gt;<a class="code" href="class_atom.html#ad121a01910fb0f6511a963de4d89460d" title="Property y coordinate position of the atom.">Y</a>=0.0f;
<a name="l00829"></a>00829         nAtom-&gt;<a class="code" href="class_atom.html#aa0c17b25aa4c710115c74b173c756a9b" title="Property z coordinate position of the atom.">Z</a>=0.0f;
<a name="l00830"></a>00830 
<a name="l00831"></a>00831         <span class="comment">//If this is the first time reading this section(read_once==false)</span>
<a name="l00832"></a>00832         <span class="comment">// just add it in the system else replace the previous frame value(if exists)</span>
<a name="l00833"></a>00833         <span class="keywordflow">if</span>(<a class="code" href="class_gauss.html#a763752bd14a2b1fcaab01c4d86fd9ddb" title="Flag for checking if multiple frames is being read for g-tesnors.">read_onceGT</a>) <a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>[ElectronstartIndex+1]=nAtom;
<a name="l00834"></a>00834         <span class="keywordflow">else</span> <a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>-&gt;Add(nAtom);
<a name="l00835"></a>00835 
<a name="l00836"></a>00836         <span class="comment">//nAtom-&gt;ID=AtomCollection-&gt;Count;</span>
<a name="l00837"></a>00837 
<a name="l00838"></a>00838         <span class="comment">//Reading interaction matrix and creating interaction</span>
<a name="l00839"></a>00839         <span class="comment">//  XX= 124.2135  YX=    17.8802   ZX=-52.5149</span>
<a name="l00840"></a>00840         <span class="comment">//  XY= 16.8895   YY=    49.5584   ZY= 50.7000</span>
<a name="l00841"></a>00841         <span class="comment">//  XZ=-52.1651   YZ=    56.3286   ZZ=  0.1103</span>
<a name="l00842"></a>00842         fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>();
<a name="l00843"></a>00843         
<a name="l00844"></a>00844         <span class="comment">//Number of Fields: 6, XYZ index: 1,3,5</span>
<a name="l00845"></a>00845         <a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a76380877005a119942daf7995d4a65a0" title="Reads three lines, split them to a number of fields which must be equal to FieldsNumber (for each lin...">ExtractInteractionMatrix3x3</a>(fileline, <span class="stringliteral">&quot;G-tesnor&quot;</span>, 
<a name="l00846"></a>00846                 nAtom, nAtom, 1.0,
<a name="l00847"></a>00847                 <a class="code" href="class_gauss.html#a763752bd14a2b1fcaab01c4d86fd9ddb" title="Flag for checking if multiple frames is being read for g-tesnors.">read_onceGT</a>, startIndex, ii, 6, 1, 3, 5, 
<a name="l00848"></a>00848                 <a class="code" href="class_units.html#aefde252771ce6c48781414a0ea4aee78">Units::Mi_b</a>, <a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8ea002c54e14f8b8cc5a33e76e39d67a6a0">InteractionKind::GTensor</a>, 
<a name="l00849"></a>00849                 <a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a16ab6e7e7d34bd4bb7d0d32b59f6770a" title="Main function for opening and reading file.">SystemModel</a>-&gt;<a class="code" href="class_model.html#adc069c415325e10c5c452421d0578564" title="The collection of reference frames in the model.">RefFrameCollection</a>[1], 
<a name="l00850"></a>00850                 <a class="code" href="_gauss_8cpp.html#a5cbb61ec3949904f6d01991168849abf">InteractionCollection</a>);
<a name="l00851"></a>00851 
<a name="l00852"></a>00852         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00853"></a>00853 }
<a name="l00854"></a>00854 <span class="comment"></span>
<a name="l00855"></a>00855 <span class="comment">/**</span>
<a name="l00856"></a>00856 <span class="comment">* @brief Main function for reading Quadrupolar interactions from the file</span>
<a name="l00857"></a>00857 <span class="comment">* @return Returns false if the format does not seem to be correct.</span>
<a name="l00858"></a>00858 <span class="comment">*/</span>
<a name="l00859"></a><a class="code" href="class_gauss.html#ac86ddd5a0b87e15d6d80acba29b302e7">00859</a> <span class="keywordtype">bool</span> <a class="code" href="class_gauss.html#ac86ddd5a0b87e15d6d80acba29b302e7" title="Main function for reading Quadrupolar interactions from the file.">Gauss::read_QUADCOUPLINGS</a>()
<a name="l00860"></a>00860 {
<a name="l00861"></a>00861         <span class="keywordtype">int</span> number;   <span class="comment">//number of fields in the a line</span>
<a name="l00862"></a>00862         array&lt;String^&gt;^numbers = <span class="keyword">nullptr</span>;   <span class="comment">// Matrix of the fields after splitting of a line</span>
<a name="l00863"></a>00863         String^ delimStr = <span class="stringliteral">&quot; ,=&quot;</span>;            <span class="comment">//seperator of fields</span>
<a name="l00864"></a>00864         array&lt;Char&gt;^delimiter = delimStr-&gt;ToCharArray(); <span class="comment">//Conversion to char array     </span>
<a name="l00865"></a>00865 
<a name="l00866"></a>00866         String^ fileline=<span class="keyword">gcnew</span> String(<span class="stringliteral">&quot;&quot;</span>); <span class="comment">//line</span>
<a name="l00867"></a>00867         <span class="keywordtype">int</span> ii=1;
<a name="l00868"></a>00868 
<a name="l00869"></a>00869         <span class="comment">//Saving the starting index of this interaction for case of multiple frames</span>
<a name="l00870"></a>00870         <span class="keyword">static</span> <span class="keywordtype">int</span> startIndex;
<a name="l00871"></a>00871         <span class="keywordflow">if</span>(!<a class="code" href="class_gauss.html#a000d482185a05fc4d4bb9e5e05672263" title="Flag for checking if multiple frames is being read for quadropolar couplings.">read_onceQC</a>) startIndex=<a class="code" href="_gauss_8cpp.html#a5cbb61ec3949904f6d01991168849abf">InteractionCollection</a>-&gt;Count;
<a name="l00872"></a>00872 
<a name="l00873"></a>00873         <span class="comment">//Loop over all atoms</span>
<a name="l00874"></a>00874         <span class="keywordflow">for each</span>(<span class="keywordtype">int</span> i <span class="keywordflow">in</span> <a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>-&gt;Keys)
<a name="l00875"></a>00875         {
<a name="l00876"></a>00876                 <span class="comment">//    1  C(12) </span>
<a name="l00877"></a>00877                 fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>();
<a name="l00878"></a>00878 
<a name="l00879"></a>00879                 <span class="comment">//Split the line</span>
<a name="l00880"></a>00880            numbers=fileline-&gt;Split(delimiter,StringSplitOptions::RemoveEmptyEntries );
<a name="l00881"></a>00881            
<a name="l00882"></a>00882            <span class="comment">//check if all the atoms have quadropolar and save atom ID, use &amp; for avoiding short circuit</span>
<a name="l00883"></a>00883            <span class="keywordtype">int</span> AtomID;
<a name="l00884"></a>00884            <span class="keywordflow">if</span>(numbers-&gt;Length!=2 &amp; !Int32::TryParse(numbers[0], AtomID)) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00885"></a>00885 
<a name="l00886"></a>00886                 <span class="comment">//For Quadrupolar interactions, try to find proper isotope</span>
<a name="l00887"></a>00887                 <span class="keywordflow">try</span>{
<a name="l00888"></a>00888                         <span class="keywordflow">if</span>(((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>[AtomID])-&gt;isotope-&gt;Spin&lt;=0.5f) 
<a name="l00889"></a>00889                                 ((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>[AtomID])-&gt;isotope=
<a name="l00890"></a>00890                                 <a class="code" href="class_isotopes.html#abff033099a91306b05b48ea0c0a59108" title="Function for finding the isotope of the lement but with higher spin.">Isotopes::FindIsotopeWithHigherSpin</a>(((<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>[i])-&gt;isotope);
<a name="l00891"></a>00891 
<a name="l00892"></a>00892                         <span class="comment">//Reading interaction matrix and creating interaction</span>
<a name="l00893"></a>00893                         <span class="comment">//aa=     0.0000   ba=     0.0000   ca=     0.0000</span>
<a name="l00894"></a>00894                         <span class="comment">//ab=     0.0000   bb=     0.0000   cb=     0.0000</span>
<a name="l00895"></a>00895                         <span class="comment">//ac=     0.0000   bc=     0.0000   cc=     0.0000</span>
<a name="l00896"></a>00896                         fileline=<a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a8afde8ccb9846c0fb14c340ae6a0afe7" title="Reads a line from the stream ReadingFile keeping track which line reads.">ReadLine</a>();
<a name="l00897"></a>00897                         <span class="comment">//Number of Fields: 6, XYZ index: 1,3,5</span>
<a name="l00898"></a>00898                         <a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a76380877005a119942daf7995d4a65a0" title="Reads three lines, split them to a number of fields which must be equal to FieldsNumber (for each lin...">ExtractInteractionMatrix3x3</a>(fileline, <span class="stringliteral">&quot;Quadrupolar Interaction&quot;</span>, 
<a name="l00899"></a>00899                                 (<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>[AtomID], (<a class="code" href="class_atom.html">Atom</a>^)<a class="code" href="_gauss_8cpp.html#a2d177689e21e2dec50129e23e6d83df9">AtomCollection</a>[AtomID], 1.0,
<a name="l00900"></a>00900                                 <a class="code" href="class_gauss.html#a000d482185a05fc4d4bb9e5e05672263" title="Flag for checking if multiple frames is being read for quadropolar couplings.">read_onceQC</a>, startIndex, ii, 6, 1, 3, 5, 
<a name="l00901"></a>00901                                 <a class="code" href="class_units.html#a0dae09a04eea7c37f558e74dfe99f09b">Units::MHz</a>, <a class="code" href="_model_8h.html#a0c402bd678cea44c9d1fdaf49d6f6b8eac17339440287fe2fd6774ac931c67eb7">InteractionKind::Quadrupolar</a>, 
<a name="l00902"></a>00902                                 <a class="code" href="class_spinach_g_u_i_1_1_i_o_spin_system.html#a16ab6e7e7d34bd4bb7d0d32b59f6770a" title="Main function for opening and reading file.">SystemModel</a>-&gt;<a class="code" href="class_model.html#adc069c415325e10c5c452421d0578564" title="The collection of reference frames in the model.">RefFrameCollection</a>[1], 
<a name="l00903"></a>00903                                 <a class="code" href="_gauss_8cpp.html#a5cbb61ec3949904f6d01991168849abf">InteractionCollection</a>);
<a name="l00904"></a>00904                 }<span class="comment">//In case we can not find isotope with  spin&gt;0.5</span>
<a name="l00905"></a>00905                 <span class="keywordflow">catch</span> (String^ e) {<span class="comment">/*Continue*/</span>};
<a name="l00906"></a>00906         };   
<a name="l00907"></a>00907         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00908"></a>00908 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Sat Apr 25 2015 18:33:57 for Spinach GUI by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
